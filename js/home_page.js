
(function(){var root=this;var previousUnderscore=root._;var ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype;var push=ArrayProto.push,slice=ArrayProto.slice,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty;var nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind,nativeCreate=Object.create;var Ctor=function(){};var _=function(obj){if(obj instanceof _)return obj;if(!(this instanceof _))return new _(obj);this._wrapped=obj};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=_}exports._=_}else{root._=_}_.VERSION="1.8.3";var optimizeCb=function(func,context,argCount){if(context===void 0)return func;switch(argCount==null?3:argCount){case 1:return function(value){return func.call(context,value)};case 2:return function(value,other){return func.call(context,value,other)};case 3:return function(value,index,collection){return func.call(context,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(context,accumulator,value,index,collection)}}return function(){return func.apply(context,arguments)}};var cb=function(value,context,argCount){if(value==null)return _.identity;if(_.isFunction(value))return optimizeCb(value,context,argCount);if(_.isObject(value))return _.matcher(value);return _.property(value)};_.iteratee=function(value,context){return cb(value,context,Infinity)};var createAssigner=function(keysFunc,undefinedOnly){return function(obj){var length=arguments.length;if(length<2||obj==null)return obj;for(var index=1;index<length;index++){var source=arguments[index],keys=keysFunc(source),l=keys.length;for(var i=0;i<l;i++){var key=keys[i];if(!undefinedOnly||obj[key]===void 0)obj[key]=source[key]}}return obj}};var baseCreate=function(prototype){if(!_.isObject(prototype))return{};if(nativeCreate)return nativeCreate(prototype);Ctor.prototype=prototype;var result=new Ctor;Ctor.prototype=null;return result};var property=function(key){return function(obj){return obj==null?void 0:obj[key]}};var MAX_ARRAY_INDEX=Math.pow(2,53)-1;var getLength=property("length");var isArrayLike=function(collection){var length=getLength(collection);return typeof length=="number"&&length>=0&&length<=MAX_ARRAY_INDEX};_.each=_.forEach=function(obj,iteratee,context){iteratee=optimizeCb(iteratee,context);var i,length;if(isArrayLike(obj)){for(i=0,length=obj.length;i<length;i++){iteratee(obj[i],i,obj)}}else{var keys=_.keys(obj);for(i=0,length=keys.length;i<length;i++){iteratee(obj[keys[i]],keys[i],obj)}}return obj};_.map=_.collect=function(obj,iteratee,context){iteratee=cb(iteratee,context);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,results=Array(length);for(var index=0;index<length;index++){var currentKey=keys?keys[index]:index;results[index]=iteratee(obj[currentKey],currentKey,obj)}return results};function createReduce(dir){function iterator(obj,iteratee,memo,keys,index,length){for(;index>=0&&index<length;index+=dir){var currentKey=keys?keys[index]:index;memo=iteratee(memo,obj[currentKey],currentKey,obj)}return memo}return function(obj,iteratee,memo,context){iteratee=optimizeCb(iteratee,context,4);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,index=dir>0?0:length-1;if(arguments.length<3){memo=obj[keys?keys[index]:index];index+=dir}return iterator(obj,iteratee,memo,keys,index,length)}}_.reduce=_.foldl=_.inject=createReduce(1);_.reduceRight=_.foldr=createReduce(-1);_.find=_.detect=function(obj,predicate,context){var key;if(isArrayLike(obj)){key=_.findIndex(obj,predicate,context)}else{key=_.findKey(obj,predicate,context)}if(key!==void 0&&key!==-1)return obj[key]};_.filter=_.select=function(obj,predicate,context){var results=[];predicate=cb(predicate,context);_.each(obj,function(value,index,list){if(predicate(value,index,list))results.push(value)});return results};_.reject=function(obj,predicate,context){return _.filter(obj,_.negate(cb(predicate)),context)};_.every=_.all=function(obj,predicate,context){predicate=cb(predicate,context);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length;for(var index=0;index<length;index++){var currentKey=keys?keys[index]:index;if(!predicate(obj[currentKey],currentKey,obj))return false}return true};_.some=_.any=function(obj,predicate,context){predicate=cb(predicate,context);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length;for(var index=0;index<length;index++){var currentKey=keys?keys[index]:index;if(predicate(obj[currentKey],currentKey,obj))return true}return false};_.contains=_.includes=_.include=function(obj,item,fromIndex,guard){if(!isArrayLike(obj))obj=_.values(obj);if(typeof fromIndex!="number"||guard)fromIndex=0;return _.indexOf(obj,item,fromIndex)>=0};_.invoke=function(obj,method){var args=slice.call(arguments,2);var isFunc=_.isFunction(method);return _.map(obj,function(value){var func=isFunc?method:value[method];return func==null?func:func.apply(value,args)})};_.pluck=function(obj,key){return _.map(obj,_.property(key))};_.where=function(obj,attrs){return _.filter(obj,_.matcher(attrs))};_.findWhere=function(obj,attrs){return _.find(obj,_.matcher(attrs))};_.max=function(obj,iteratee,context){var result=-Infinity,lastComputed=-Infinity,value,computed;if(iteratee==null&&obj!=null){obj=isArrayLike(obj)?obj:_.values(obj);for(var i=0,length=obj.length;i<length;i++){value=obj[i];if(value>result){result=value}}}else{iteratee=cb(iteratee,context);_.each(obj,function(value,index,list){computed=iteratee(value,index,list);if(computed>lastComputed||computed===-Infinity&&result===-Infinity){result=value;lastComputed=computed}})}return result};_.min=function(obj,iteratee,context){var result=Infinity,lastComputed=Infinity,value,computed;if(iteratee==null&&obj!=null){obj=isArrayLike(obj)?obj:_.values(obj);for(var i=0,length=obj.length;i<length;i++){value=obj[i];if(value<result){result=value}}}else{iteratee=cb(iteratee,context);_.each(obj,function(value,index,list){computed=iteratee(value,index,list);if(computed<lastComputed||computed===Infinity&&result===Infinity){result=value;lastComputed=computed}})}return result};_.shuffle=function(obj){var set=isArrayLike(obj)?obj:_.values(obj);var length=set.length;var shuffled=Array(length);for(var index=0,rand;index<length;index++){rand=_.random(0,index);if(rand!==index)shuffled[index]=shuffled[rand];shuffled[rand]=set[index]}return shuffled};_.sample=function(obj,n,guard){if(n==null||guard){if(!isArrayLike(obj))obj=_.values(obj);return obj[_.random(obj.length-1)]}return _.shuffle(obj).slice(0,Math.max(0,n))};_.sortBy=function(obj,iteratee,context){iteratee=cb(iteratee,context);return _.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iteratee(value,index,list)}}).sort(function(left,right){var a=left.criteria;var b=right.criteria;if(a!==b){if(a>b||a===void 0)return 1;if(a<b||b===void 0)return-1}return left.index-right.index}),"value")};var group=function(behavior){return function(obj,iteratee,context){var result={};iteratee=cb(iteratee,context);_.each(obj,function(value,index){var key=iteratee(value,index,obj);behavior(result,value,key)});return result}};_.groupBy=group(function(result,value,key){if(_.has(result,key))result[key].push(value);else result[key]=[value]});_.indexBy=group(function(result,value,key){result[key]=value});_.countBy=group(function(result,value,key){if(_.has(result,key))result[key]++;else result[key]=1});_.toArray=function(obj){if(!obj)return[];if(_.isArray(obj))return slice.call(obj);if(isArrayLike(obj))return _.map(obj,_.identity);return _.values(obj)};_.size=function(obj){if(obj==null)return 0;return isArrayLike(obj)?obj.length:_.keys(obj).length};_.partition=function(obj,predicate,context){predicate=cb(predicate,context);var pass=[],fail=[];_.each(obj,function(value,key,obj){(predicate(value,key,obj)?pass:fail).push(value)});return[pass,fail]};_.first=_.head=_.take=function(array,n,guard){if(array==null)return void 0;if(n==null||guard)return array[0];return _.initial(array,array.length-n)};_.initial=function(array,n,guard){return slice.call(array,0,Math.max(0,array.length-(n==null||guard?1:n)))};_.last=function(array,n,guard){if(array==null)return void 0;if(n==null||guard)return array[array.length-1];return _.rest(array,Math.max(0,array.length-n))};_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,n==null||guard?1:n)};_.compact=function(array){return _.filter(array,_.identity)};var flatten=function(input,shallow,strict,startIndex){var output=[],idx=0;for(var i=startIndex||0,length=getLength(input);i<length;i++){var value=input[i];if(isArrayLike(value)&&(_.isArray(value)||_.isArguments(value))){if(!shallow)value=flatten(value,shallow,strict);var j=0,len=value.length;output.length+=len;while(j<len){output[idx++]=value[j++]}}else if(!strict){output[idx++]=value}}return output};_.flatten=function(array,shallow){return flatten(array,shallow,false)};_.without=function(array){return _.difference(array,slice.call(arguments,1))};_.uniq=_.unique=function(array,isSorted,iteratee,context){if(!_.isBoolean(isSorted)){context=iteratee;iteratee=isSorted;isSorted=false}if(iteratee!=null)iteratee=cb(iteratee,context);var result=[];var seen=[];for(var i=0,length=getLength(array);i<length;i++){var value=array[i],computed=iteratee?iteratee(value,i,array):value;if(isSorted){if(!i||seen!==computed)result.push(value);seen=computed}else if(iteratee){if(!_.contains(seen,computed)){seen.push(computed);result.push(value)}}else if(!_.contains(result,value)){result.push(value)}}return result};_.union=function(){return _.uniq(flatten(arguments,true,true))};_.intersection=function(array){var result=[];var argsLength=arguments.length;for(var i=0,length=getLength(array);i<length;i++){var item=array[i];if(_.contains(result,item))continue;for(var j=1;j<argsLength;j++){if(!_.contains(arguments[j],item))break}if(j===argsLength)result.push(item)}return result};_.difference=function(array){var rest=flatten(arguments,true,true,1);return _.filter(array,function(value){return!_.contains(rest,value)})};_.zip=function(){return _.unzip(arguments)};_.unzip=function(array){var length=array&&_.max(array,getLength).length||0;var result=Array(length);for(var index=0;index<length;index++){result[index]=_.pluck(array,index)}return result};_.object=function(list,values){var result={};for(var i=0,length=getLength(list);i<length;i++){if(values){result[list[i]]=values[i]}else{result[list[i][0]]=list[i][1]}}return result};function createPredicateIndexFinder(dir){return function(array,predicate,context){predicate=cb(predicate,context);var length=getLength(array);var index=dir>0?0:length-1;for(;index>=0&&index<length;index+=dir){if(predicate(array[index],index,array))return index}return-1}}_.findIndex=createPredicateIndexFinder(1);_.findLastIndex=createPredicateIndexFinder(-1);_.sortedIndex=function(array,obj,iteratee,context){iteratee=cb(iteratee,context,1);var value=iteratee(obj);var low=0,high=getLength(array);while(low<high){var mid=Math.floor((low+high)/2);if(iteratee(array[mid])<value)low=mid+1;else high=mid}return low};function createIndexFinder(dir,predicateFind,sortedIndex){return function(array,item,idx){var i=0,length=getLength(array);if(typeof idx=="number"){if(dir>0){i=idx>=0?idx:Math.max(idx+length,i)}else{length=idx>=0?Math.min(idx+1,length):idx+length+1}}else if(sortedIndex&&idx&&length){idx=sortedIndex(array,item);return array[idx]===item?idx:-1}if(item!==item){idx=predicateFind(slice.call(array,i,length),_.isNaN);return idx>=0?idx+i:-1}for(idx=dir>0?i:length-1;idx>=0&&idx<length;idx+=dir){if(array[idx]===item)return idx}return-1}}_.indexOf=createIndexFinder(1,_.findIndex,_.sortedIndex);_.lastIndexOf=createIndexFinder(-1,_.findLastIndex);_.range=function(start,stop,step){if(stop==null){stop=start||0;start=0}step=step||1;var length=Math.max(Math.ceil((stop-start)/step),0);var range=Array(length);for(var idx=0;idx<length;idx++,start+=step){range[idx]=start}return range};var executeBound=function(sourceFunc,boundFunc,context,callingContext,args){if(!(callingContext instanceof boundFunc))return sourceFunc.apply(context,args);var self=baseCreate(sourceFunc.prototype);var result=sourceFunc.apply(self,args);if(_.isObject(result))return result;return self};_.bind=function(func,context){if(nativeBind&&func.bind===nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError("Bind must be called on a function");var args=slice.call(arguments,2);var bound=function(){return executeBound(func,bound,context,this,args.concat(slice.call(arguments)))};return bound};_.partial=function(func){var boundArgs=slice.call(arguments,1);var bound=function(){var position=0,length=boundArgs.length;var args=Array(length);for(var i=0;i<length;i++){args[i]=boundArgs[i]===_?arguments[position++]:boundArgs[i]}while(position<arguments.length)args.push(arguments[position++]);return executeBound(func,bound,this,this,args)};return bound};_.bindAll=function(obj){var i,length=arguments.length,key;if(length<=1)throw new Error("bindAll must be passed function names");for(i=1;i<length;i++){key=arguments[i];obj[key]=_.bind(obj[key],obj)}return obj};_.memoize=function(func,hasher){var memoize=function(key){var cache=memoize.cache;var address=""+(hasher?hasher.apply(this,arguments):key);if(!_.has(cache,address))cache[address]=func.apply(this,arguments);return cache[address]};memoize.cache={};return memoize};_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)};_.defer=_.partial(_.delay,_,1);_.throttle=function(func,wait,options){var context,args,result;var timeout=null;var previous=0;if(!options)options={};var later=function(){previous=options.leading===false?0:_.now();timeout=null;result=func.apply(context,args);if(!timeout)context=args=null};return function(){var now=_.now();if(!previous&&options.leading===false)previous=now;var remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0||remaining>wait){if(timeout){clearTimeout(timeout);timeout=null}previous=now;result=func.apply(context,args);if(!timeout)context=args=null}else if(!timeout&&options.trailing!==false){timeout=setTimeout(later,remaining)}return result}};_.debounce=function(func,wait,immediate){var timeout,args,context,timestamp,result;var later=function(){var last=_.now()-timestamp;if(last<wait&&last>=0){timeout=setTimeout(later,wait-last)}else{timeout=null;if(!immediate){result=func.apply(context,args);if(!timeout)context=args=null}}};return function(){context=this;args=arguments;timestamp=_.now();var callNow=immediate&&!timeout;if(!timeout)timeout=setTimeout(later,wait);if(callNow){result=func.apply(context,args);context=args=null}return result}};_.wrap=function(func,wrapper){return _.partial(wrapper,func)};_.negate=function(predicate){return function(){return!predicate.apply(this,arguments)}};_.compose=function(){var args=arguments;var start=args.length-1;return function(){var i=start;var result=args[start].apply(this,arguments);while(i--)result=args[i].call(this,result);return result}};_.after=function(times,func){return function(){if(--times<1){return func.apply(this,arguments)}}};_.before=function(times,func){var memo;return function(){if(--times>0){memo=func.apply(this,arguments)}if(times<=1)func=null;return memo}};_.once=_.partial(_.before,2);var hasEnumBug=!{toString:null}.propertyIsEnumerable("toString");var nonEnumerableProps=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];function collectNonEnumProps(obj,keys){var nonEnumIdx=nonEnumerableProps.length;var constructor=obj.constructor;var proto=_.isFunction(constructor)&&constructor.prototype||ObjProto;var prop="constructor";if(_.has(obj,prop)&&!_.contains(keys,prop))keys.push(prop);while(nonEnumIdx--){prop=nonEnumerableProps[nonEnumIdx];if(prop in obj&&obj[prop]!==proto[prop]&&!_.contains(keys,prop)){keys.push(prop)}}}_.keys=function(obj){if(!_.isObject(obj))return[];if(nativeKeys)return nativeKeys(obj);var keys=[];for(var key in obj)if(_.has(obj,key))keys.push(key);if(hasEnumBug)collectNonEnumProps(obj,keys);return keys};_.allKeys=function(obj){if(!_.isObject(obj))return[];var keys=[];for(var key in obj)keys.push(key);if(hasEnumBug)collectNonEnumProps(obj,keys);return keys};_.values=function(obj){var keys=_.keys(obj);var length=keys.length;var values=Array(length);for(var i=0;i<length;i++){values[i]=obj[keys[i]]}return values};_.mapObject=function(obj,iteratee,context){iteratee=cb(iteratee,context);var keys=_.keys(obj),length=keys.length,results={},currentKey;for(var index=0;index<length;index++){currentKey=keys[index];results[currentKey]=iteratee(obj[currentKey],currentKey,obj)}return results};_.pairs=function(obj){var keys=_.keys(obj);var length=keys.length;var pairs=Array(length);for(var i=0;i<length;i++){pairs[i]=[keys[i],obj[keys[i]]]}return pairs};_.invert=function(obj){var result={};var keys=_.keys(obj);for(var i=0,length=keys.length;i<length;i++){result[obj[keys[i]]]=keys[i]}return result};_.functions=_.methods=function(obj){var names=[];for(var key in obj){if(_.isFunction(obj[key]))names.push(key)}return names.sort()};_.extend=createAssigner(_.allKeys);_.extendOwn=_.assign=createAssigner(_.keys);_.findKey=function(obj,predicate,context){predicate=cb(predicate,context);var keys=_.keys(obj),key;for(var i=0,length=keys.length;i<length;i++){key=keys[i];if(predicate(obj[key],key,obj))return key}};_.pick=function(object,oiteratee,context){var result={},obj=object,iteratee,keys;if(obj==null)return result;if(_.isFunction(oiteratee)){keys=_.allKeys(obj);iteratee=optimizeCb(oiteratee,context)}else{keys=flatten(arguments,false,false,1);iteratee=function(value,key,obj){return key in obj};obj=Object(obj)}for(var i=0,length=keys.length;i<length;i++){var key=keys[i];var value=obj[key];if(iteratee(value,key,obj))result[key]=value}return result};_.omit=function(obj,iteratee,context){if(_.isFunction(iteratee)){iteratee=_.negate(iteratee)}else{var keys=_.map(flatten(arguments,false,false,1),String);iteratee=function(value,key){return!_.contains(keys,key)}}return _.pick(obj,iteratee,context)};_.defaults=createAssigner(_.allKeys,true);_.create=function(prototype,props){var result=baseCreate(prototype);if(props)_.extendOwn(result,props);return result};_.clone=function(obj){if(!_.isObject(obj))return obj;return _.isArray(obj)?obj.slice():_.extend({},obj)};_.tap=function(obj,interceptor){interceptor(obj);return obj};_.isMatch=function(object,attrs){var keys=_.keys(attrs),length=keys.length;if(object==null)return!length;var obj=Object(object);for(var i=0;i<length;i++){var key=keys[i];if(attrs[key]!==obj[key]||!(key in obj))return false}return true};var eq=function(a,b,aStack,bStack){if(a===b)return a!==0||1/a===1/b;if(a==null||b==null)return a===b;if(a instanceof _)a=a._wrapped;if(b instanceof _)b=b._wrapped;var className=toString.call(a);if(className!==toString.call(b))return false;switch(className){case"[object RegExp]":case"[object String]":return""+a===""+b;case"[object Number]":if(+a!==+a)return+b!==+b;return+a===0?1/+a===1/b:+a===+b;case"[object Date]":case"[object Boolean]":return+a===+b}var areArrays=className==="[object Array]";if(!areArrays){if(typeof a!="object"||typeof b!="object")return false;var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor)&&("constructor"in a&&"constructor"in b)){return false}}aStack=aStack||[];bStack=bStack||[];var length=aStack.length;while(length--){if(aStack[length]===a)return bStack[length]===b}aStack.push(a);bStack.push(b);if(areArrays){length=a.length;if(length!==b.length)return false;while(length--){if(!eq(a[length],b[length],aStack,bStack))return false}}else{var keys=_.keys(a),key;length=keys.length;if(_.keys(b).length!==length)return false;while(length--){key=keys[length];if(!(_.has(b,key)&&eq(a[key],b[key],aStack,bStack)))return false}}aStack.pop();bStack.pop();return true};_.isEqual=function(a,b){return eq(a,b)};_.isEmpty=function(obj){if(obj==null)return true;if(isArrayLike(obj)&&(_.isArray(obj)||_.isString(obj)||_.isArguments(obj)))return obj.length===0;return _.keys(obj).length===0};_.isElement=function(obj){return!!(obj&&obj.nodeType===1)};_.isArray=nativeIsArray||function(obj){return toString.call(obj)==="[object Array]"};_.isObject=function(obj){var type=typeof obj;return type==="function"||type==="object"&&!!obj};_.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(name){_["is"+name]=function(obj){return toString.call(obj)==="[object "+name+"]"}});if(!_.isArguments(arguments)){_.isArguments=function(obj){return _.has(obj,"callee")}}if(typeof/./!="function"&&typeof Int8Array!="object"){_.isFunction=function(obj){return typeof obj=="function"||false}}_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj))};_.isNaN=function(obj){return _.isNumber(obj)&&obj!==+obj};_.isBoolean=function(obj){return obj===true||obj===false||toString.call(obj)==="[object Boolean]"};_.isNull=function(obj){return obj===null};_.isUndefined=function(obj){return obj===void 0};_.has=function(obj,key){return obj!=null&&hasOwnProperty.call(obj,key)};_.noConflict=function(){root._=previousUnderscore;return this};_.identity=function(value){return value};_.constant=function(value){return function(){return value}};_.noop=function(){};_.property=property;_.propertyOf=function(obj){return obj==null?function(){}:function(key){return obj[key]}};_.matcher=_.matches=function(attrs){attrs=_.extendOwn({},attrs);return function(obj){return _.isMatch(obj,attrs)}};_.times=function(n,iteratee,context){var accum=Array(Math.max(0,n));iteratee=optimizeCb(iteratee,context,1);for(var i=0;i<n;i++)accum[i]=iteratee(i);return accum};_.random=function(min,max){if(max==null){max=min;min=0}return min+Math.floor(Math.random()*(max-min+1))};_.now=Date.now||function(){return(new Date).getTime()};var escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};var unescapeMap=_.invert(escapeMap);var createEscaper=function(map){var escaper=function(match){return map[match]};var source="(?:"+_.keys(map).join("|")+")";var testRegexp=RegExp(source);var replaceRegexp=RegExp(source,"g");return function(string){string=string==null?"":""+string;return testRegexp.test(string)?string.replace(replaceRegexp,escaper):string}};_.escape=createEscaper(escapeMap);_.unescape=createEscaper(unescapeMap);_.result=function(object,property,fallback){var value=object==null?void 0:object[property];if(value===void 0){value=fallback}return _.isFunction(value)?value.call(object):value};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id};_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/;var escapes={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"};var escaper=/\\|'|\r|\n|\u2028|\u2029/g;var escapeChar=function(match){return"\\"+escapes[match]};_.template=function(text,settings,oldSettings){if(!settings&&oldSettings)settings=oldSettings;settings=_.defaults({},settings,_.templateSettings);var matcher=RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g");var index=0;var source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){source+=text.slice(index,offset).replace(escaper,escapeChar);index=offset+match.length;if(escape){source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'"}else if(interpolate){source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'"}else if(evaluate){source+="';\n"+evaluate+"\n__p+='"}return match});source+="';\n";if(!settings.variable)source="with(obj||{}){\n"+source+"}\n";source="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";try{var render=new Function(settings.variable||"obj","_",source)}catch(e){e.source=source;throw e}var template=function(data){return render.call(this,data,_)};var argument=settings.variable||"obj";template.source="function("+argument+"){\n"+source+"}";return template};_.chain=function(obj){var instance=_(obj);instance._chain=true;return instance};var result=function(instance,obj){return instance._chain?_(obj).chain():obj};_.mixin=function(obj){_.each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];push.apply(args,arguments);return result(this,func.apply(_,args))}})};_.mixin(_);_.each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;method.apply(obj,arguments);if((name==="shift"||name==="splice")&&obj.length===0)delete obj[0];return result(this,obj)}});_.each(["concat","join","slice"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result(this,method.apply(this._wrapped,arguments))}});_.prototype.value=function(){return this._wrapped};_.prototype.valueOf=_.prototype.toJSON=_.prototype.value;_.prototype.toString=function(){return""+this._wrapped};if(typeof define==="function"&&define.amd){define("underscore",[],function(){return _})}}).call(this);
define('backbone',["underscore"],function(_){var root=this;var previousBackbone=root.Backbone;var slice=Array.prototype.slice;var splice=Array.prototype.splice;var Backbone;if(typeof exports!=="undefined"){Backbone=exports}else{Backbone=root.Backbone={}}Backbone.VERSION="0.9.2";Backbone.setDomLibrary=function(lib){$=lib};Backbone.noConflict=function(){root.Backbone=previousBackbone;return Backbone};Backbone.emulateHTTP=false;Backbone.emulateJSON=false;var eventSplitter=/\s+/;var Events=Backbone.Events={on:function(events,callback,context){var calls,event,node,tail,list;if(!callback)return this;events=events.split(eventSplitter);calls=this._callbacks||(this._callbacks={});while(event=events.shift()){list=calls[event];node=list?list.tail:{};node.next=tail={};node.context=context;node.callback=callback;calls[event]={tail:tail,next:list?list.next:node}}return this},off:function(events,callback,context){var event,calls,node,tail,cb,ctx;if(!(calls=this._callbacks))return;if(!(events||callback||context)){delete this._callbacks;return this}events=events?events.split(eventSplitter):_.keys(calls);while(event=events.shift()){node=calls[event];delete calls[event];if(!node||!(callback||context))continue;tail=node.tail;while((node=node.next)!==tail){cb=node.callback;ctx=node.context;if(callback&&cb!==callback||context&&ctx!==context){this.on(event,cb,ctx)}}}return this},trigger:function(events){var event,node,calls,tail,args,all,rest;if(!(calls=this._callbacks))return this;all=calls.all;events=events.split(eventSplitter);rest=slice.call(arguments,1);while(event=events.shift()){if(node=calls[event]){tail=node.tail;while((node=node.next)!==tail){node.callback.apply(node.context||this,rest)}}if(node=all){tail=node.tail;args=[event].concat(rest);while((node=node.next)!==tail){node.callback.apply(node.context||this,args)}}}return this}};Events.bind=Events.on;Events.unbind=Events.off;var Model=Backbone.Model=function(attributes,options){var defaults;attributes||(attributes={});if(options&&options.parse)attributes=this.parse(attributes);if(defaults=getValue(this,"defaults")){attributes=_.extend({},defaults,attributes)}if(options&&options.collection)this.collection=options.collection;this.attributes={};this._escapedAttributes={};this.cid=_.uniqueId("c");this.changed={};this._silent={};this._pending={};this.set(attributes,{silent:true});this.changed={};this._silent={};this._pending={};this._previousAttributes=_.clone(this.attributes);this.initialize.apply(this,arguments)};_.extend(Model.prototype,Events,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(options){return _.clone(this.attributes)},get:function(attr){return this.attributes[attr]},escape:function(attr){var html;if(html=this._escapedAttributes[attr])return html;var val=this.get(attr);return this._escapedAttributes[attr]=_.escape(val==null?"":""+val)},has:function(attr){return this.get(attr)!=null},set:function(key,value,options){var attrs,attr,val;if(_.isObject(key)||key==null){attrs=key;options=value}else{attrs={};attrs[key]=value}options||(options={});if(!attrs)return this;if(attrs instanceof Model)attrs=attrs.attributes;if(options.unset)for(attr in attrs)attrs[attr]=void 0;if(!this._validate(attrs,options))return false;if(this.idAttribute in attrs)this.id=attrs[this.idAttribute];var changes=options.changes={};var now=this.attributes;var escaped=this._escapedAttributes;var prev=this._previousAttributes||{};for(attr in attrs){val=attrs[attr];if(!_.isEqual(now[attr],val)||options.unset&&_.has(now,attr)){delete escaped[attr];(options.silent?this._silent:changes)[attr]=true}options.unset?delete now[attr]:now[attr]=val;if(!_.isEqual(prev[attr],val)||_.has(now,attr)!=_.has(prev,attr)){this.changed[attr]=val;if(!options.silent)this._pending[attr]=true}else{delete this.changed[attr];delete this._pending[attr]}}if(!options.silent)this.change(options);return this},unset:function(attr,options){(options||(options={})).unset=true;return this.set(attr,null,options)},clear:function(options){(options||(options={})).unset=true;return this.set(_.clone(this.attributes),options)},fetch:function(options){options=options?_.clone(options):{};var model=this;var success=options.success;options.success=function(resp,status,xhr){if(!model.set(model.parse(resp,xhr),options))return false;if(success)success(model,resp)};options.error=Backbone.wrapError(options.error,model,options);return(this.sync||Backbone.sync).call(this,"read",this,options)},save:function(key,value,options){var attrs,current;if(_.isObject(key)||key==null){attrs=key;options=value}else{attrs={};attrs[key]=value}options=options?_.clone(options):{};if(options.wait){if(!this._validate(attrs,options))return false;current=_.clone(this.attributes)}var silentOptions=_.extend({},options,{silent:true});if(attrs&&!this.set(attrs,options.wait?silentOptions:options)){return false}var model=this;var success=options.success;options.success=function(resp,status,xhr){var serverAttrs=model.parse(resp,xhr);if(options.wait){delete options.wait;serverAttrs=_.extend(attrs||{},serverAttrs)}if(!model.set(serverAttrs,options))return false;if(success){success(model,resp)}else{model.trigger("sync",model,resp,options)}};options.error=Backbone.wrapError(options.error,model,options);var method=this.isNew()?"create":"update";var xhr=(this.sync||Backbone.sync).call(this,method,this,options);if(options.wait)this.set(current,silentOptions);return xhr},destroy:function(options){options=options?_.clone(options):{};var model=this;var success=options.success;var triggerDestroy=function(){model.trigger("destroy",model,model.collection,options)};if(this.isNew()){triggerDestroy();return false}options.success=function(resp){if(options.wait)triggerDestroy();if(success){success(model,resp)}else{model.trigger("sync",model,resp,options)}};options.error=Backbone.wrapError(options.error,model,options);var xhr=(this.sync||Backbone.sync).call(this,"delete",this,options);if(!options.wait)triggerDestroy();return xhr},url:function(){var base=getValue(this,"urlRoot")||getValue(this.collection,"url")||urlError();if(this.isNew())return base;return base+(base.charAt(base.length-1)=="/"?"":"/")+encodeURIComponent(this.id)},parse:function(resp,xhr){return resp},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},change:function(options){options||(options={});var changing=this._changing;this._changing=true;for(var attr in this._silent)this._pending[attr]=true;var changes=_.extend({},options.changes,this._silent);this._silent={};for(var attr in changes){this.trigger("change:"+attr,this,this.get(attr),options)}if(changing)return this;while(!_.isEmpty(this._pending)){this._pending={};this.trigger("change",this,options);for(var attr in this.changed){if(this._pending[attr]||this._silent[attr])continue;delete this.changed[attr]}this._previousAttributes=_.clone(this.attributes)}this._changing=false;return this},hasChanged:function(attr){if(!arguments.length)return!_.isEmpty(this.changed);return _.has(this.changed,attr)},changedAttributes:function(diff){if(!diff)return this.hasChanged()?_.clone(this.changed):false;var val,changed=false,old=this._previousAttributes;for(var attr in diff){if(_.isEqual(old[attr],val=diff[attr]))continue;(changed||(changed={}))[attr]=val}return changed},previous:function(attr){if(!arguments.length||!this._previousAttributes)return null;return this._previousAttributes[attr]},previousAttributes:function(){return _.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},_validate:function(attrs,options){if(options.silent||!this.validate)return true;attrs=_.extend({},this.attributes,attrs);var error=this.validate(attrs,options);if(!error)return true;if(options&&options.error){options.error(this,error,options)}else{this.trigger("error",this,error,options)}return false}});var Collection=Backbone.Collection=function(models,options){options||(options={});if(options.model)this.model=options.model;if(options.comparator)this.comparator=options.comparator;this._reset();this.initialize.apply(this,arguments);if(models)this.reset(models,{silent:true,parse:options.parse})};_.extend(Collection.prototype,Events,{model:Model,initialize:function(){},toJSON:function(options){return this.map(function(model){return model.toJSON(options)})},add:function(models,options){var i,index,length,model,cid,id,cids={},ids={},dups=[];options||(options={});models=_.isArray(models)?models.slice():[models];for(i=0,length=models.length;i<length;i++){if(!(model=models[i]=this._prepareModel(models[i],options))){throw new Error("Can't add an invalid model to a collection")}cid=model.cid;id=model.id;if(cids[cid]||this._byCid[cid]||id!=null&&(ids[id]||this._byId[id])){dups.push(i);continue}cids[cid]=ids[id]=model}i=dups.length;while(i--){models.splice(dups[i],1)}for(i=0,length=models.length;i<length;i++){(model=models[i]).on("all",this._onModelEvent,this);this._byCid[model.cid]=model;if(model.id!=null)this._byId[model.id]=model}this.length+=length;index=options.at!=null?options.at:this.models.length;splice.apply(this.models,[index,0].concat(models));if(this.comparator)this.sort({silent:true});if(options.silent)return this;for(i=0,length=this.models.length;i<length;i++){if(!cids[(model=this.models[i]).cid])continue;options.index=i;model.trigger("add",model,this,options)}return this},remove:function(models,options){var i,l,index,model;options||(options={});models=_.isArray(models)?models.slice():[models];for(i=0,l=models.length;i<l;i++){model=this.getByCid(models[i])||this.get(models[i]);if(!model)continue;delete this._byId[model.id];delete this._byCid[model.cid];index=this.indexOf(model);this.models.splice(index,1);this.length--;if(!options.silent){options.index=index;model.trigger("remove",model,this,options)}this._removeReference(model)}return this},push:function(model,options){model=this._prepareModel(model,options);this.add(model,options);return model},pop:function(options){var model=this.at(this.length-1);this.remove(model,options);return model},unshift:function(model,options){model=this._prepareModel(model,options);this.add(model,_.extend({at:0},options));return model},shift:function(options){var model=this.at(0);this.remove(model,options);return model},get:function(id){if(id==null)return void 0;return this._byId[id.id!=null?id.id:id]},getByCid:function(cid){return cid&&this._byCid[cid.cid||cid]},at:function(index){return this.models[index]},where:function(attrs){if(_.isEmpty(attrs))return[];return this.filter(function(model){for(var key in attrs){if(attrs[key]!==model.get(key))return false}return true})},sort:function(options){options||(options={});if(!this.comparator)throw new Error("Cannot sort a set without a comparator");var boundComparator=_.bind(this.comparator,this);if(this.comparator.length==1){this.models=this.sortBy(boundComparator)}else{this.models.sort(boundComparator)}if(!options.silent)this.trigger("reset",this,options);return this},pluck:function(attr){return _.map(this.models,function(model){return model.get(attr)})},reset:function(models,options){models||(models=[]);options||(options={});for(var i=0,l=this.models.length;i<l;i++){this._removeReference(this.models[i])}this._reset();this.add(models,_.extend({silent:true},options));if(!options.silent)this.trigger("reset",this,options);return this},fetch:function(options){options=options?_.clone(options):{};if(options.parse===undefined)options.parse=true;var collection=this;var success=options.success;options.success=function(resp,status,xhr){collection[options.add?"add":"reset"](collection.parse(resp,xhr),options);if(success)success(collection,resp)};options.error=Backbone.wrapError(options.error,collection,options);return(this.sync||Backbone.sync).call(this,"read",this,options)},create:function(model,options){var coll=this;options=options?_.clone(options):{};model=this._prepareModel(model,options);if(!model)return false;if(!options.wait)coll.add(model,options);var success=options.success;options.success=function(nextModel,resp,xhr){if(options.wait)coll.add(nextModel,options);if(success){success(nextModel,resp)}else{nextModel.trigger("sync",model,resp,options)}};model.save(null,options);return model},parse:function(resp,xhr){return resp},chain:function(){return _(this.models).chain()},_reset:function(options){this.length=0;this.models=[];this._byId={};this._byCid={}},_prepareModel:function(model,options){options||(options={});if(!(model instanceof Model)){var attrs=model;options.collection=this;model=new this.model(attrs,options);if(!model._validate(model.attributes,options))model=false}else if(!model.collection){model.collection=this}return model},_removeReference:function(model){if(this==model.collection){delete model.collection}model.off("all",this._onModelEvent,this)},_onModelEvent:function(event,model,collection,options){if((event=="add"||event=="remove")&&collection!=this)return;if(event=="destroy"){this.remove(model,options)}if(model&&event==="change:"+model.idAttribute){delete this._byId[model.previous(model.idAttribute)];this._byId[model.id]=model}this.trigger.apply(this,arguments)}});var methods=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];_.each(methods,function(method){Collection.prototype[method]=function(){return _[method].apply(_,[this.models].concat(_.toArray(arguments)))}});var Router=Backbone.Router=function(options){options||(options={});if(options.routes)this.routes=options.routes;this._bindRoutes();this.initialize.apply(this,arguments)};var namedParam=/:\w+/g;var splatParam=/\*\w+/g;var escapeRegExp=/[-[\]{}()+?.,\\^$|#\s]/g;_.extend(Router.prototype,Events,{initialize:function(){},route:function(route,name,callback){Backbone.history||(Backbone.history=new History);if(!_.isRegExp(route))route=this._routeToRegExp(route);if(!callback)callback=this[name];Backbone.history.route(route,_.bind(function(fragment){var args=this._extractParameters(route,fragment);callback&&callback.apply(this,args);this.trigger.apply(this,["route:"+name].concat(args));Backbone.history.trigger("route",this,name,args)},this));return this},navigate:function(fragment,options){Backbone.history.navigate(fragment,options)},_bindRoutes:function(){if(!this.routes)return;var routes=[];for(var route in this.routes){routes.unshift([route,this.routes[route]])}for(var i=0,l=routes.length;i<l;i++){this.route(routes[i][0],routes[i][1],this[routes[i][1]])}},_routeToRegExp:function(route){route=route.replace(escapeRegExp,"\\$&").replace(namedParam,"([^/]+)").replace(splatParam,"(.*?)");return new RegExp("^"+route+"$")},_extractParameters:function(route,fragment){return route.exec(fragment).slice(1)}});var History=Backbone.History=function(){this.handlers=[];_.bindAll(this,"checkUrl")};var routeStripper=/^[#\/]/;var isExplorer=/msie [\w.]+/;History.started=false;_.extend(History.prototype,Events,{interval:50,getHash:function(windowOverride){var loc=windowOverride?windowOverride.location:window.location;var match=loc.href.match(/#(.*)$/);return match?match[1]:""},getFragment:function(fragment,forcePushState){if(fragment==null){if(this._hasPushState||forcePushState){fragment=window.location.pathname;var search=window.location.search;if(search)fragment+=search}else{fragment=this.getHash()}}if(!fragment.indexOf(this.options.root))fragment=fragment.substr(this.options.root.length);return fragment.replace(routeStripper,"")},start:function(options){if(History.started)throw new Error("Backbone.history has already been started");History.started=true;this.options=_.extend({},{root:"/"},this.options,options);this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var fragment=this.getFragment();var docMode=document.documentMode;var oldIE=isExplorer.exec(navigator.userAgent.toLowerCase())&&(!docMode||docMode<=7);if(oldIE){this.iframe=$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;this.navigate(fragment)}if(this._hasPushState){$(window).bind("popstate",this.checkUrl)}else if(this._wantsHashChange&&"onhashchange"in window&&!oldIE){$(window).bind("hashchange",this.checkUrl)}else if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}this.fragment=fragment;var loc=window.location;var atRoot=loc.pathname==this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!atRoot){this.fragment=this.getFragment(null,true);window.location.replace(this.options.root+"#"+this.fragment);return true}else if(this._wantsPushState&&this._hasPushState&&atRoot&&loc.hash){this.fragment=this.getHash().replace(routeStripper,"");window.history.replaceState({},document.title,loc.protocol+"//"+loc.host+this.options.root+this.fragment)}if(!this.options.silent){return this.loadUrl()}},stop:function(){$(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);History.started=false},route:function(route,callback){this.handlers.unshift({route:route,callback:callback})},checkUrl:function(e){var current=this.getFragment();if(current==this.fragment&&this.iframe)current=this.getFragment(this.getHash(this.iframe));if(current==this.fragment)return false;if(this.iframe)this.navigate(current);this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(fragmentOverride){var fragment=this.fragment=this.getFragment(fragmentOverride);var matched=_.any(this.handlers,function(handler){if(handler.route.test(fragment)){handler.callback(fragment);return true}});return matched},navigate:function(fragment,options){if(!History.started)return false;if(!options||options===true)options={trigger:options};var frag=(fragment||"").replace(routeStripper,"");if(this.fragment==frag)return;if(this._hasPushState){if(frag.indexOf(this.options.root)!=0)frag=this.options.root+frag;this.fragment=frag;window.history[options.replace?"replaceState":"pushState"]({},document.title,frag)}else if(this._wantsHashChange){this.fragment=frag;this._updateHash(window.location,frag,options.replace);if(this.iframe&&frag!=this.getFragment(this.getHash(this.iframe))){if(!options.replace)this.iframe.document.open().close();this._updateHash(this.iframe.location,frag,options.replace)}}else{window.location.assign(this.options.root+fragment)}if(options.trigger)this.loadUrl(fragment)},_updateHash:function(location,fragment,replace){if(replace){location.replace(location.toString().replace(/(javascript:|#).*$/,"")+"#"+fragment)}else{location.hash=fragment}}});var View=Backbone.View=function(options){this.cid=_.uniqueId("view");this._configure(options||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()};var delegateEventSplitter=/^(\S+)\s*(.*)$/;var viewOptions=["model","collection","el","id","attributes","className","tagName"];_.extend(View.prototype,Events,{tagName:"div",$:function(selector){return this.$el.find(selector)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();return this},make:function(tagName,attributes,content){var el=document.createElement(tagName);if(attributes)$(el).attr(attributes);if(content!=null)$(el).html(content);return el},setElement:function(element,delegate){if(this.$el)this.undelegateEvents();this.$el=element instanceof $?element:$(element);this.el=this.$el[0];if(delegate!==false)this.delegateEvents();return this},delegateEvents:function(events){if(!(events||(events=getValue(this,"events"))))return;this.undelegateEvents();for(var key in events){var method=events[key];if(!_.isFunction(method))method=this[events[key]];if(!method)throw new Error('Method "'+events[key]+'" does not exist');var match=key.match(delegateEventSplitter);var eventName=match[1],selector=match[2];method=_.bind(method,this);eventName+=".delegateEvents"+this.cid;if(selector===""){this.$el.bind(eventName,method)}else{this.$el.delegate(selector,eventName,method)}}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(options){if(this.options)options=_.extend({},this.options,options);for(var i=0,l=viewOptions.length;i<l;i++){var attr=viewOptions[i];if(options[attr])this[attr]=options[attr]}this.options=options},_ensureElement:function(){if(!this.el){var attrs=getValue(this,"attributes")||{};if(this.id)attrs.id=this.id;if(this.className)attrs["class"]=this.className;this.setElement(this.make(this.tagName,attrs),false)}else{this.setElement(this.el,false)}}});var extend=function(protoProps,classProps){var child=inherits(this,protoProps,classProps);child.extend=this.extend;return child};Model.extend=Collection.extend=Router.extend=View.extend=extend;var methodMap={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};Backbone.sync=function(method,model,options){var type=methodMap[method];options||(options={});var params={type:type,dataType:"json"};if(!options.url){params.url=getValue(model,"url")||urlError()}if(!options.data&&model&&(method=="create"||method=="update")){params.contentType="application/json";params.data=JSON.stringify(model.toJSON())}if(Backbone.emulateJSON){params.contentType="application/x-www-form-urlencoded";params.data=params.data?{model:params.data}:{}}if(Backbone.emulateHTTP){if(type==="PUT"||type==="DELETE"){if(Backbone.emulateJSON)params.data._method=type;params.type="POST";params.beforeSend=function(xhr){xhr.setRequestHeader("X-HTTP-Method-Override",type)}}}if(params.type!=="GET"&&!Backbone.emulateJSON){params.processData=false}return $.ajax(_.extend(params,options))};Backbone.wrapError=function(onError,originalModel,options){return function(model,resp){resp=model===originalModel?resp:model;if(onError){onError(originalModel,resp,options)}else{originalModel.trigger("error",originalModel,resp,options)}}};var ctor=function(){};var inherits=function(parent,protoProps,staticProps){var child;if(protoProps&&protoProps.hasOwnProperty("constructor")){child=protoProps.constructor}else{child=function(){parent.apply(this,arguments)}}_.extend(child,parent);ctor.prototype=parent.prototype;child.prototype=new ctor;if(protoProps)_.extend(child.prototype,protoProps);if(staticProps)_.extend(child,staticProps);child.prototype.constructor=child;child.__super__=parent.prototype;return child};var getValue=function(object,prop){if(!(object&&object[prop]))return null;return _.isFunction(object[prop])?object[prop]():object[prop]};var urlError=function(){throw new Error('A "url" property or function must be specified')};return Backbone});
define('core/url',[],function(){function absURL(path,hostname){var port=location.port;port=port==""||port==80?"":":"+port;if(path.indexOf("/")==0){path=path.substring(1)}if(!hostname){hostname=location.hostname}return location.protocol+"//"+hostname+port+"/"+path}function getURIFragment(name){var regex_string="#"+name+"=([^&#]*)";var regex=new RegExp(regex_string);var result=regex.exec(window.location.hash);if(result==null){return""}else{return decodeURIComponent(result[1])}}function getURLParams(){var queryDict={};location.search.substr(1).split("&").forEach(function(item){key=decodeURIComponent(item.split("=")[0]);val=decodeURIComponent(item.split("=")[1]);queryDict[key]=val});return queryDict}function getURLParam(key){var params=getURLParams();if(key in params){return params[key]}else{return null}}function absExtURL(url){return"http://"+url.replace("http://","")}function wishURL(path){return location.protocol+"//"+path}function contestImageURL(contest_id,size,sequence_id){if(!size){size="medium"}if(!sequence_id){sequence_id=0}return window.lemmings_url+"/"+contest_id+"-"+sequence_id+"-"+size}function resizedContestImageURL(contest_id,width,height,sequence_id,mode){var url=window.location.protocol;url+="//contestimg./api/image/fetch?contest_id=";url+=contest_id;url+="&w=";url+=Math.ceil(width);url+="&h=";url+=Math.ceil(height);if(sequence_id){url+="&s=";url+=sequence_id}if(mode!=null){url+="&m=";url+=mode}return url}return{absURL:absURL,absExtURL:absExtURL,wishURL:wishURL,contestImageURL:contestImageURL,resizedContestImageURL:resizedContestImageURL,getURIFragment:getURIFragment,getURLParams:getURLParams,getURLParam:getURLParam}});
define('lib/jed',["underscore"],function(_){var Jed=function(options){this.defaults={locale_data:{messages:{"":{domain:"messages",lang:"en",plural_forms:"nplurals=2; plural=(n != 1);"}}},domain:"messages"};this.options=_.extend({},this.defaults,options);this.textdomain(this.options.domain);if(options.domain&&!this.options.locale_data[this.options.domain]){throw new Error("Text domain set to non-existent domain: `"+domain+"`")}};Jed.context_delimiter=String.fromCharCode(4);function getPluralFormFunc(plural_form_string){return Jed.PF.compile(plural_form_string||"nplurals=2; plural=(n != 1);")}function Chain(key,i18n){this._key=key;this._i18n=i18n}_.extend(Chain.prototype,{onDomain:function(domain){this._domain=domain;return this},withContext:function(context){this._context=context;return this},ifPlural:function(num,pkey){this._val=num;this._pkey=pkey;return this},fetch:function(sArr){if({}.toString.call(sArr)!="[object Array]"){sArr=[].slice.call(arguments)}return(sArr&&sArr.length?Jed.sprintf:function(x){return x})(this._i18n.dcnpgettext(this._domain,this._context,this._key,this._pkey,this._val),sArr)}});_.extend(Jed.prototype,{translate:function(key){return new Chain(key,this)},textdomain:function(domain){if(!domain){return this._textdomain}this._textdomain=domain},gettext:function(key){return this.dcnpgettext.call(this,undef,undef,key)},dgettext:function(domain,key){return this.dcnpgettext.call(this,domain,undef,key)},dcgettext:function(domain,key){return this.dcnpgettext.call(this,domain,undef,key)},ngettext:function(skey,pkey,val){return this.dcnpgettext.call(this,undef,undef,skey,pkey,val)},dngettext:function(domain,skey,pkey,val){return this.dcnpgettext.call(this,domain,undef,skey,pkey,val)},dcngettext:function(domain,skey,pkey,val){return this.dcnpgettext.call(this,domain,undef,skey,pkey,val)},pgettext:function(context,key){return this.dcnpgettext.call(this,undef,context,key)},dpgettext:function(domain,context,key){return this.dcnpgettext.call(this,domain,context,key)},dcpgettext:function(domain,context,key){return this.dcnpgettext.call(this,domain,context,key)},npgettext:function(context,skey,pkey,val){return this.dcnpgettext.call(this,undef,context,skey,pkey,val)},dnpgettext:function(domain,context,skey,pkey,val){return this.dcnpgettext.call(this,domain,context,skey,pkey,val)},dcnpgettext:function(domain,context,singular_key,plural_key,val){plural_key=plural_key||singular_key;domain=domain||this._textdomain;val=typeof val=="undefined"?1:val;var fallback;if(!this.options){fallback=new Jed;return fallback.dcnpgettext.call(fallback,undefined,undefined,singular_key,plural_key,val)}if(!this.options.locale_data){throw new Error("No locale data provided.")}if(!this.options.locale_data[domain]){throw new Error("Domain `"+domain+"` was not found.")}if(!this.options.locale_data[domain][""]){throw new Error("No locale meta information provided.")}if(!singular_key){throw new Error("No translation key found.")}if(typeof val!="number"){try{val=parseInt(val,10)}catch(e){throw new Error("Error parsing the value.")}if(isNaN(val)){throw new Error("The number that was passed in is not a number.")}}var key=context?context+Jed.context_delimiter+singular_key:singular_key,locale_data=this.options.locale_data,dict=locale_data[domain],pluralForms=dict[""].plural_forms||(locale_data.messages||this.defaults.locale_data.messages)[""].plural_forms,val_idx=getPluralFormFunc(pluralForms)(val)+1,val_list,res;if(!dict){throw new Error("No domain named `"+domain+"` could be found.")}val_list=dict[key];if(!val_list||val_idx>=val_list.length){res=[null,singular_key,plural_key];return res[getPluralFormFunc(pluralForms)(val)+1]}res=val_list[val_idx];if(!res){res=[null,singular_key,plural_key];return res[getPluralFormFunc(pluralForms)(val)+1]}return res}});var sprintf=function(){function get_type(variable){return Object.prototype.toString.call(variable).slice(8,-1).toLowerCase()}function str_repeat(input,multiplier){for(var output=[];multiplier>0;output[--multiplier]=input){}return output.join("")}var str_format=function(){if(!str_format.cache.hasOwnProperty(arguments[0])){str_format.cache[arguments[0]]=str_format.parse(arguments[0])}return str_format.format.call(null,str_format.cache[arguments[0]],arguments)};str_format.format=function(parse_tree,argv){var cursor=1,tree_length=parse_tree.length,node_type="",arg,output=[],i,k,match,pad,pad_character,pad_length;for(i=0;i<tree_length;i++){node_type=get_type(parse_tree[i]);if(node_type==="string"){output.push(parse_tree[i])}else if(node_type==="array"){match=parse_tree[i];if(match[2]){arg=argv[cursor];for(k=0;k<match[2].length;k++){if(!arg.hasOwnProperty(match[2][k])){throw sprintf('[sprintf] property "%s" does not exist',match[2][k])}arg=arg[match[2][k]]}}else if(match[1]){arg=argv[match[1]]}else{arg=argv[cursor++]}if(/[^s]/.test(match[8])&&get_type(arg)!="number"){throw sprintf("[sprintf] expecting number but found %s",get_type(arg))}if(typeof arg=="undefined"||arg===null){arg=""}switch(match[8]){case"b":arg=arg.toString(2);break;case"c":arg=String.fromCharCode(arg);break;case"d":arg=parseInt(arg,10);break;case"e":arg=match[7]?arg.toExponential(match[7]):arg.toExponential();break;case"f":arg=match[7]?parseFloat(arg).toFixed(match[7]):parseFloat(arg);break;case"o":arg=arg.toString(8);break;case"s":arg=(arg=String(arg))&&match[7]?arg.substring(0,match[7]):arg;break;case"u":arg=Math.abs(arg);break;case"x":arg=arg.toString(16);break;case"X":arg=arg.toString(16).toUpperCase();break}arg=/[def]/.test(match[8])&&match[3]&&arg>=0?"+"+arg:arg;pad_character=match[4]?match[4]=="0"?"0":match[4].charAt(1):" ";pad_length=match[6]-String(arg).length;pad=match[6]?str_repeat(pad_character,pad_length):"";output.push(match[5]?arg+pad:pad+arg)}}return output.join("")};str_format.cache={};str_format.parse=function(fmt){var _fmt=fmt,match=[],parse_tree=[],arg_names=0;while(_fmt){if((match=/^[^\x25]+/.exec(_fmt))!==null){parse_tree.push(match[0])}else if((match=/^\x25{2}/.exec(_fmt))!==null){parse_tree.push("%")}else if((match=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(_fmt))!==null){if(match[2]){arg_names|=1;var field_list=[],replacement_field=match[2],field_match=[];if((field_match=/^([a-z_][a-z_\d]*)/i.exec(replacement_field))!==null){field_list.push(field_match[1]);while((replacement_field=replacement_field.substring(field_match[0].length))!==""){if((field_match=/^\.([a-z_][a-z_\d]*)/i.exec(replacement_field))!==null){field_list.push(field_match[1])}else if((field_match=/^\[(\d+)\]/.exec(replacement_field))!==null){field_list.push(field_match[1])}else{throw"[sprintf] huh?"}}}else{throw"[sprintf] huh?"}match[2]=field_list}else{arg_names|=2}if(arg_names===3){throw"[sprintf] mixing positional and named placeholders is not (yet) supported"}parse_tree.push(match)}else{throw"[sprintf] huh?"}_fmt=_fmt.substring(match[0].length)}return parse_tree};return str_format}();var vsprintf=function(fmt,argv){argv.unshift(fmt);return sprintf.apply(null,argv)};Jed.parse_plural=function(plural_forms,n){plural_forms=plural_forms.replace(/n/g,n);return Jed.parse_expression(plural_forms)};Jed.sprintf=function(fmt,args){if({}.toString.call(args)=="[object Array]"){return vsprintf(fmt,[].slice.call(args))}return sprintf.apply(this,[].slice.call(arguments))};Jed.prototype.sprintf=function(){return Jed.sprintf.apply(this,arguments)};Jed.PF={};Jed.PF.parse=function(p){var plural_str=Jed.PF.extractPluralExpr(p);return Jed.PF.parser.parse.call(Jed.PF.parser,plural_str)};Jed.PF.compile=function(p){function imply(val){return val===true?1:val?val:0}var ast=Jed.PF.parse(p);return function(n){return imply(Jed.PF.interpreter(ast)(n))}};Jed.PF.interpreter=function(ast){return function(n){var res;switch(ast.type){case"GROUP":return Jed.PF.interpreter(ast.expr)(n);case"TERNARY":if(Jed.PF.interpreter(ast.expr)(n)){return Jed.PF.interpreter(ast.truthy)(n)}return Jed.PF.interpreter(ast.falsey)(n);case"OR":return Jed.PF.interpreter(ast.left)(n)||Jed.PF.interpreter(ast.right)(n);case"AND":return Jed.PF.interpreter(ast.left)(n)&&Jed.PF.interpreter(ast.right)(n);case"LT":return Jed.PF.interpreter(ast.left)(n)<Jed.PF.interpreter(ast.right)(n);case"GT":return Jed.PF.interpreter(ast.left)(n)>Jed.PF.interpreter(ast.right)(n);case"LTE":return Jed.PF.interpreter(ast.left)(n)<=Jed.PF.interpreter(ast.right)(n);case"GTE":return Jed.PF.interpreter(ast.left)(n)>=Jed.PF.interpreter(ast.right)(n);case"EQ":return Jed.PF.interpreter(ast.left)(n)==Jed.PF.interpreter(ast.right)(n);case"NEQ":return Jed.PF.interpreter(ast.left)(n)!=Jed.PF.interpreter(ast.right)(n);case"MOD":return Jed.PF.interpreter(ast.left)(n)%Jed.PF.interpreter(ast.right)(n);case"VAR":return n;case"NUM":return ast.val;default:throw new Error("Invalid Token found.")}}};Jed.PF.extractPluralExpr=function(p){p=p.replace(/^\s\s*/,"").replace(/\s\s*$/,"");if(!/;\s*$/.test(p)){p=p.concat(";")}var nplurals_re=/nplurals\=(\d+);/,plural_re=/plural\=(.*);/,nplurals_matches=p.match(nplurals_re),res={},plural_matches;if(nplurals_matches.length>1){res.nplurals=nplurals_matches[1]}else{throw new Error("nplurals not found in plural_forms string: "+p)}p=p.replace(nplurals_re,"");plural_matches=p.match(plural_re);if(!(plural_matches&&plural_matches.length>1)){throw new Error("`plural` expression not found: "+p)}return plural_matches[1]};Jed.PF.parser=function(){var parser={trace:function trace(){},yy:{},symbols_:{error:2,expressions:3,e:4,EOF:5,"?":6,":":7,"||":8,"&&":9,"<":10,"<=":11,">":12,">=":13,"!=":14,"==":15,"%":16,"(":17,")":18,n:19,NUMBER:20,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",6:"?",7:":",8:"||",9:"&&",10:"<",11:"<=",12:">",13:">=",14:"!=",15:"==",16:"%",17:"(",18:")",19:"n",20:"NUMBER"},productions_:[0,[3,2],[4,5],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,1],[4,1]],performAction:function anonymous(yytext,yyleng,yylineno,yy,yystate,$$,_$){var $0=$$.length-1;switch(yystate){case 1:return{type:"GROUP",expr:$$[$0-1]};break;case 2:this.$={type:"TERNARY",expr:$$[$0-4],truthy:$$[$0-2],falsey:$$[$0]};break;case 3:this.$={type:"OR",left:$$[$0-2],right:$$[$0]};break;case 4:this.$={type:"AND",left:$$[$0-2],right:$$[$0]};break;case 5:this.$={type:"LT",left:$$[$0-2],right:$$[$0]};break;case 6:this.$={type:"LTE",left:$$[$0-2],right:$$[$0]};break;case 7:this.$={type:"GT",left:$$[$0-2],right:$$[$0]};break;case 8:this.$={type:"GTE",left:$$[$0-2],right:$$[$0]};break;case 9:this.$={type:"NEQ",left:$$[$0-2],right:$$[$0]};break;case 10:this.$={type:"EQ",left:$$[$0-2],right:$$[$0]};break;case 11:this.$={type:"MOD",left:$$[$0-2],right:$$[$0]};break;case 12:this.$={type:"GROUP",expr:$$[$0-1]};break;case 13:this.$={type:"VAR"};break;case 14:this.$={type:"NUM",val:Number(yytext)};break}},table:[{3:1,4:2,17:[1,3],19:[1,4],20:[1,5]},{1:[3]},{5:[1,6],6:[1,7],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16]},{4:17,17:[1,3],19:[1,4],20:[1,5]},{5:[2,13],6:[2,13],7:[2,13],8:[2,13],9:[2,13],10:[2,13],11:[2,13],12:[2,13],13:[2,13],14:[2,13],15:[2,13],16:[2,13],18:[2,13]},{5:[2,14],6:[2,14],7:[2,14],8:[2,14],9:[2,14],10:[2,14],11:[2,14],12:[2,14],13:[2,14],14:[2,14],15:[2,14],16:[2,14],18:[2,14]},{1:[2,1]},{4:18,17:[1,3],19:[1,4],20:[1,5]},{4:19,17:[1,3],19:[1,4],20:[1,5]},{4:20,17:[1,3],19:[1,4],20:[1,5]},{4:21,17:[1,3],19:[1,4],20:[1,5]},{4:22,17:[1,3],19:[1,4],20:[1,5]},{4:23,17:[1,3],19:[1,4],20:[1,5]},{4:24,17:[1,3],19:[1,4],20:[1,5]},{4:25,17:[1,3],19:[1,4],20:[1,5]},{4:26,17:[1,3],19:[1,4],20:[1,5]},{4:27,17:[1,3],19:[1,4],20:[1,5]},{6:[1,7],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[1,28]},{6:[1,7],7:[1,29],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16]},{5:[2,3],6:[2,3],7:[2,3],8:[2,3],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,3]},{5:[2,4],6:[2,4],7:[2,4],8:[2,4],9:[2,4],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,4]},{5:[2,5],6:[2,5],7:[2,5],8:[2,5],9:[2,5],10:[2,5],11:[2,5],12:[2,5],13:[2,5],14:[2,5],15:[2,5],16:[1,16],18:[2,5]},{5:[2,6],6:[2,6],7:[2,6],8:[2,6],9:[2,6],10:[2,6],11:[2,6],12:[2,6],13:[2,6],14:[2,6],15:[2,6],16:[1,16],18:[2,6]},{5:[2,7],6:[2,7],7:[2,7],8:[2,7],9:[2,7],10:[2,7],11:[2,7],12:[2,7],13:[2,7],14:[2,7],15:[2,7],16:[1,16],18:[2,7]},{5:[2,8],6:[2,8],7:[2,8],8:[2,8],9:[2,8],10:[2,8],11:[2,8],12:[2,8],13:[2,8],14:[2,8],15:[2,8],16:[1,16],18:[2,8]},{5:[2,9],6:[2,9],7:[2,9],8:[2,9],9:[2,9],10:[2,9],11:[2,9],12:[2,9],13:[2,9],14:[2,9],15:[2,9],16:[1,16],18:[2,9]},{5:[2,10],6:[2,10],7:[2,10],8:[2,10],9:[2,10],10:[2,10],11:[2,10],12:[2,10],13:[2,10],14:[2,10],15:[2,10],16:[1,16],18:[2,10]},{5:[2,11],6:[2,11],7:[2,11],8:[2,11],9:[2,11],10:[2,11],11:[2,11],12:[2,11],13:[2,11],14:[2,11],15:[2,11],16:[2,11],18:[2,11]},{5:[2,12],6:[2,12],7:[2,12],8:[2,12],9:[2,12],10:[2,12],11:[2,12],12:[2,12],13:[2,12],14:[2,12],15:[2,12],16:[2,12],18:[2,12]},{4:30,17:[1,3],19:[1,4],20:[1,5]},{5:[2,2],6:[1,7],7:[2,2],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,2]}],defaultActions:{6:[2,1]},parseError:function parseError(str,hash){throw new Error(str)},parse:function parse(input){var self=this,stack=[0],vstack=[null],lstack=[],table=this.table,yytext="",yylineno=0,yyleng=0,recovering=0,TERROR=2,EOF=1;this.lexer.setInput(input);this.lexer.yy=this.yy;this.yy.lexer=this.lexer;if(typeof this.lexer.yylloc=="undefined")this.lexer.yylloc={};var yyloc=this.lexer.yylloc;lstack.push(yyloc);if(typeof this.yy.parseError==="function")this.parseError=this.yy.parseError;function popStack(n){stack.length=stack.length-2*n;vstack.length=vstack.length-n;lstack.length=lstack.length-n}function lex(){var token;token=self.lexer.lex()||1;if(typeof token!=="number"){token=self.symbols_[token]||token}return token}var symbol,preErrorSymbol,state,action,a,r,yyval={},p,len,newState,expected;while(true){state=stack[stack.length-1];if(this.defaultActions[state]){action=this.defaultActions[state]}else{if(symbol==null)symbol=lex();action=table[state]&&table[state][symbol]}_handle_error:if(typeof action==="undefined"||!action.length||!action[0]){if(!recovering){expected=[];for(p in table[state])if(this.terminals_[p]&&p>2){expected.push("'"+this.terminals_[p]+"'")}var errStr="";if(this.lexer.showPosition){errStr="Parse error on line "+(yylineno+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+expected.join(", ")+", got '"+this.terminals_[symbol]+"'"}else{errStr="Parse error on line "+(yylineno+1)+": Unexpected "+(symbol==1?"end of input":"'"+(this.terminals_[symbol]||symbol)+"'")}this.parseError(errStr,{text:this.lexer.match,token:this.terminals_[symbol]||symbol,line:this.lexer.yylineno,loc:yyloc,expected:expected})}if(recovering==3){if(symbol==EOF){throw new Error(errStr||"Parsing halted.")}yyleng=this.lexer.yyleng;yytext=this.lexer.yytext;yylineno=this.lexer.yylineno;yyloc=this.lexer.yylloc;symbol=lex()}while(1){if(TERROR.toString()in table[state]){break}if(state==0){throw new Error(errStr||"Parsing halted.")}popStack(1);state=stack[stack.length-1]}preErrorSymbol=symbol;symbol=TERROR;state=stack[stack.length-1];action=table[state]&&table[state][TERROR];recovering=3}if(action[0]instanceof Array&&action.length>1){throw new Error("Parse Error: multiple actions possible at state: "+state+", token: "+symbol)}switch(action[0]){case 1:stack.push(symbol);vstack.push(this.lexer.yytext);lstack.push(this.lexer.yylloc);stack.push(action[1]);symbol=null;if(!preErrorSymbol){yyleng=this.lexer.yyleng;yytext=this.lexer.yytext;yylineno=this.lexer.yylineno;yyloc=this.lexer.yylloc;if(recovering>0)recovering--}else{symbol=preErrorSymbol;preErrorSymbol=null}break;case 2:len=this.productions_[action[1]][1];yyval.$=vstack[vstack.length-len];yyval._$={first_line:lstack[lstack.length-(len||1)].first_line,last_line:lstack[lstack.length-1].last_line,first_column:lstack[lstack.length-(len||1)].first_column,last_column:lstack[lstack.length-1].last_column};r=this.performAction.call(yyval,yytext,yyleng,yylineno,this.yy,action[1],vstack,lstack);if(typeof r!=="undefined"){return r}if(len){stack=stack.slice(0,-1*len*2);vstack=vstack.slice(0,-1*len);lstack=lstack.slice(0,-1*len)}stack.push(this.productions_[action[1]][0]);vstack.push(yyval.$);lstack.push(yyval._$);newState=table[stack[stack.length-2]][stack[stack.length-1]];stack.push(newState);break;case 3:return true}}return true}};var lexer=function(){var lexer={EOF:1,parseError:function parseError(str,hash){if(this.yy.parseError){this.yy.parseError(str,hash)}else{throw new Error(str)}},setInput:function(input){this._input=input;this._more=this._less=this.done=false;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};return this},input:function(){var ch=this._input[0];this.yytext+=ch;this.yyleng++;this.match+=ch;this.matched+=ch;var lines=ch.match(/\n/);if(lines)this.yylineno++;this._input=this._input.slice(1);return ch},unput:function(ch){this._input=ch+this._input;return this},more:function(){this._more=true;return this},pastInput:function(){var past=this.matched.substr(0,this.matched.length-this.match.length);return(past.length>20?"...":"")+past.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var next=this.match;if(next.length<20){next+=this._input.substr(0,20-next.length)}return(next.substr(0,20)+(next.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var pre=this.pastInput();var c=new Array(pre.length+1).join("-");return pre+this.upcomingInput()+"\n"+c+"^"},next:function(){if(this.done){return this.EOF}if(!this._input)this.done=true;var token,match,col,lines;if(!this._more){this.yytext="";this.match=""}var rules=this._currentRules();for(var i=0;i<rules.length;i++){match=this._input.match(this.rules[rules[i]]);if(match){lines=match[0].match(/\n.*/g);if(lines)this.yylineno+=lines.length;this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:lines?lines[lines.length-1].length-1:this.yylloc.last_column+match[0].length};this.yytext+=match[0];this.match+=match[0];this.matches=match;this.yyleng=this.yytext.length;this._more=false;this._input=this._input.slice(match[0].length);this.matched+=match[0];token=this.performAction.call(this,this.yy,this,rules[i],this.conditionStack[this.conditionStack.length-1]);if(token)return token;else return}}if(this._input===""){return this.EOF}else{this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})}},lex:function lex(){var r=this.next();if(typeof r!=="undefined"){return r}else{return this.lex()}},begin:function begin(condition){this.conditionStack.push(condition)},popState:function popState(){return this.conditionStack.pop()},_currentRules:function _currentRules(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function begin(condition){this.begin(condition)}};lexer.performAction=function anonymous(yy,yy_,$avoiding_name_collisions,YY_START){var YYSTATE=YY_START;switch($avoiding_name_collisions){case 0:break;case 1:return 20;break;case 2:return 19;break;case 3:return 8;break;case 4:return 9;break;case 5:return 6;break;case 6:return 7;break;case 7:return 11;break;case 8:return 13;break;case 9:return 10;break;case 10:return 12;break;case 11:return 14;break;case 12:return 15;break;case 13:return 16;break;case 14:return 17;break;case 15:return 18;break;case 16:return 5;break;case 17:return"INVALID";break}};lexer.rules=[/^\s+/,/^[0-9]+(\.[0-9]+)?\b/,/^n\b/,/^\|\|/,/^&&/,/^\?/,/^:/,/^<=/,/^>=/,/^</,/^>/,/^!=/,/^==/,/^%/,/^\(/,/^\)/,/^$/,/^./];lexer.conditions={INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17],inclusive:true}};return lexer}();parser.lexer=lexer;return parser}();return{Jed:Jed}});
define('core/i18n',["lib/jed"],function(jed){var Jed=jed.Jed;var locale=window.locale_info["locale"];var jedi18n=undefined;if(window.locale_info["locale_json"]==undefined){jedi18n=new Jed({})}else{jedi18n=new Jed({domain:"wish",locale_data:window.locale_info["locale_json"]})}function _i18n(str){var _args=Array.prototype.slice.apply(arguments);if(typeof str!=="string"){console.log("You passed in '"+str+"' to i18n, did you mean ni18n?")}var result=jedi18n.translate(str).fetch(_args.slice(1));if(locale=="up"){result=result.toUpperCase()}return result}function _ni18n(num,singular,plural){var _args=Array.prototype.slice.apply(arguments);format_args=_args.slice(3);format_args.splice(0,0,_args[0]);var str=jedi18n.translate(singular).ifPlural(num,plural).fetch(format_args);if(locale=="up"){str=str.toUpperCase()}return str}function _ci18n(context,message){context=context.toUpperCase();var _args=Array.prototype.slice.apply(arguments);if(!context){return _i18n(message)}var result=jedi18n.translate(message).withContext(context).fetch(_args.slice(1));if(locale=="up"){result=result.toUpperCase()}return result}function _cni18n(context,num,singular,plural){context=context.toUpperCase();var _args=Array.prototype.slice.apply(arguments);format_args=_args.slice(4);format_args.splice(0,0,_args[1]);if(!context){return _ni18n(num,singular,plural)}var str=jedi18n.translate(singular).ifPlural(num,plural).withContext(context).fetch(format_args);if(locale=="up"){str=str.toUpperCase()}return str}return{i18n:_i18n,ni18n:_ni18n,ci18n:_ci18n,cni18n:_cni18n,sprintf:Jed.sprintf}});
define('core/string_utils',["core/i18n"],function(i18nModule){var i18n=i18nModule.i18n;function formatPhoneNumber(num){num=num.replace(/\D/g,"");if(num.length==10){return num.replace(/(\d{3})(\d{3})(\d{4})/,"$1-$2-$3")}else if(num.length==11){return num.replace(/(\d{1})(\d{3})(\d{3})(\d{4})/,"($1) $2-$3-$4")}else{return num}}function round(num,fixed){if(typeof fixed==="undefined"||!fixed){return Math.round(parseFloat(num))}return parseFloat(num).toFixed(fixed)}function formatPercentage(num,denom,fixed){if(!fixed)fixed=0;var n=parseFloat(num);var d=parseFloat(denom);if(d==0)return"100%";return(n/d*100).toFixed(fixed)+"%"}function newlineToBr(html_string){return html_string.replace(/\n/g,"<br>")}function validatePhoneNumberComponent(type,num){if(type==="phone_number_country"){if(num!=num.replace(/\D/g,"")){return i18n("")}if(!(1<=num.length&&num.length<=3)){return i18n("")}}else if(type==="phone_number_area"){if(num!=num.replace(/\D/g,"")){return i18n("")}if(!(0<=num.length&&num.length<=3)){return i18n("")}}else if(type==="phone_number_number"){if(num.indexOf("x")>=0){example="<br>Ex. + 1 - 234 - 5678910x1234";num=num.split("x");if(num.length!=2){return i18n("x")+example}if(num[1].length==0){return i18n("")+example}if(num[1]!=num[1].replace(/\D/g,"")){return i18n("")+example}return validatePhoneNumberComponent(type,num[0])}else{if(num!=num.replace(/\D/g,"")){return i18n("")}if(!(6<=num.length&&num.length<=11)){return i18n("")}}}else{return"Unhandled exception, please contact support"}return true}function cleanPhoneNumber(phone_number){if(phone_number[0]!="+"){phone_number="+"+phone_number}while(phone_number.indexOf("+0")>=0){phone_number="+"+phone_number.substring(2,phone_number.length)}return phone_number}function pluralStr(num,singular,plural){if(num==1){return singular}return plural}function isInt(n){return n%1==0}function addCommas(nStr){nStr+="";x=nStr.split(".");x1=x[0];x2=x.length>1?"."+x[1]:"";var rgx=/(\d+)(\d{3})/;while(rgx.test(x1)){x1=x1.replace(rgx,"$1"+","+"$2")}return x1+x2}function getRatio(numerator,denominator,accuracy,is_percent){var x=parseFloat(numerator);var y=parseFloat(denominator);var to_return=0;if(y!=0&&!isNaN(y)){to_return=x*1/y}if(is_percent==true&&to_return>100){to_return=100}return to_return.toFixed(accuracy)}function checkTimeFromNow(time,diff){var today=new Date;var d=new Date(time.substring(6),time.substring(0,2)-1,time.substring(3,5));d.setDate(d.getDate()+diff);return d<today}function formatCurrency(_n,includeDollar,shouldAddCommas,maxNumber,currencyName){var n=parseFloat(_n);if(isNaN(n)){return _n}if(typeof includeDollar==="undefined"){includeDollar=true}if(typeof shouldAddCommas==="undefined"){shouldAddCommas=true}var addPlus=false;if(maxNumber&&!isNaN(maxNumber)){if(n>maxNumber){n=maxNumber;addPlus=true}}var formatted=n.toFixed(2);if(shouldAddCommas){formatted=addCommas(formatted)}if(includeDollar){formatted="$"+formatted}if(addPlus){formatted=formatted+"+"}if(currencyName){formatted=formatted+'<span class="currency-subscript">'+currencyName+"</span>"}return formatted}function validateVolume(str){var volume_format=/^(\d+(\.\d+)?)\s*(ml|l|oz\.?|m\^3|cm\^3|gallon|quart|cup|qt\.?|pt\.?|litre|liter|pint|fl\.?\s?oz\.?)s?$/gi;if(str.match(volume_format))return true;return false}function validateLength(str){var length_format_1=/^(\d+(\.\d+)?)\s*(mm|cm|m|in\.?|inch(es)?|\"|\'|ft\.?|feet)$/gi;var length_format_2=/^(\d+(\.\d+)?)\s*(ft.?|feet|\')\s*(\d+(\.\d+)?)\s*(in\.?|inche(es)?|\")$/gi;if(str.match(length_format_1)||str.match(length_format_2))return true;return false}function validateArea(str){var area_format_1=/^(\d+(\.\d+)?)\s*(mm|cm|m|in\.?|inch(es)?|\"|\'|ft\.?|feet)\s*(\*|x|by)\s*(\d+(\.\d*)?)\s*(mm|cm|m|in\.?|inch(es)?|\"|\'|ft\.?|feet)$/gi;var area_format_2=/^(\d+(\.\d+)?)\s*(mm|cm|m|in\.?|inch(es)?|\"|\'|ft\.?|feet)\s*(\*|x|by)\s*(\d+(\.\d*)?)\s*(mm|cm|m|in\.?|inch(es)?|\"|\'|ft\.?|feet)\s*(\*|x|X|by)\s*(\d+(\.\d*)?)\s*(mm|cm|m|in\.?|inch(es)?|\"|\'|ft\.?|feet)$/gi;if(str.match(area_format_1)||str.match(area_format_2))return true;return false}function validateVoltage(str){var voltage_format=/^(\d+(\.\d+)?)\s*v$/gi;if(str.match(voltage_format))return true;return false}function validateWeight(str){var weight_format=/^(\d+(\.\d+)?)\s*(mg|g|kg|oz\.?|ounce|gram|pound|lb)s?$/gi;if(str.match(weight_format))return true;return false}function validateSize(size_string,valid_size_names){if(_.indexOf(valid_size_names,size_string)!=-1||!isNaN(size_string)){return false}else if(validateWeight(size_string)||validateLength(size_string)||validateVoltage(size_string)||validateArea(size_string)||validateVolume(size_string)){return false}else{return"Invalid size"}}function validateColor(color_string,valid_color_names){var colors=color_string.toLowerCase().replace(/ /g,"").split("&");if(colors.length>2){return"No more than two colors"}var invalid_colors=_.filter(colors,_.bind(function(color){return _.indexOf(valid_color_names,color)==-1},this));if(invalid_colors.length){return"Invalid color"}return false}function validateShippingTime(time_string){var shipping_times=time_string.split("-");if(shipping_times.length==2){var min_shipping_time=shipping_times[0];var max_shipping_time=shipping_times[1];if(isInt(min_shipping_time)&&isInt(max_shipping_time)){min_shipping_time=parseInt(min_shipping_time);max_shipping_time=parseInt(max_shipping_time);if(min_shipping_time>=2&&max_shipping_time>min_shipping_time){return false}}}return"Invalid shipping time"}function containsChineseCharacter(str){var re=/^.*[\u4E00-\u9FA5].*$/;return re.test(str)}function validateEmail(email){var re=/(^[-!#$%&'*+/=?^_`{}|~0-9A-Z]+(\.[-!#$%&'*+/=?^_`{}|~0-9A-Z]+)*|^"([\001-\010\013\014\016-\037!#-\[\]-\177]|\\[\001-011\013\014\016-\177])*")@(?:[A-Z0-9](?:[A-Z0-9-]{0,61}[A-Z0-9])?\.)+[A-Z]{2,10}\.?$/i;return re.test(email)}function validateURL(url){var re=/^.+\..+\/.+$/;return re.test(url)}function validateMinMaxShipTime(ship_time){if(ship_time%1==0){return false}return"Ship time must be a number"}function validatePrice(price){var re=/^\d{0,2}(\.\d{0,2}){0,1}$/;if(price.match(re)){return false}return"Invalid retail price"}function escapeCSS(text){return text.replace(/[!"#$%&'()*+,.\/:;<=>?@[\\\]^`{|}~]/g,"\\\\$&")}function is_ascii(text){for(var i=0;i<text.length;i++){if(text.charCodeAt(i)>=128){return false}}return true}function escape(s){var n=s;n=n.replace(/&/g,"&amp;");n=n.replace(/</g,"&lt;");n=n.replace(/>/g,"&gt;");n=n.replace(/"/g,"&quot;");return n}function diffString(o,n){o=o.replace(/\s+$/,"");n=n.replace(/\s+$/,"");var out=diff(o==""?[]:o.split(/\s+/),n==""?[]:n.split(/\s+/));var str="";var oSpace=o.match(/\s+/g);if(oSpace==null){oSpace=["\n"]}else{oSpace.push("\n")}var nSpace=n.match(/\s+/g);if(nSpace==null){nSpace=["\n"]}else{nSpace.push("\n")}if(out.n.length==0){for(var i=0;i<out.o.length;i++){str+="<del>"+escape(out.o[i])+oSpace[i]+"</del>"}}else{if(out.n[0].text==null){for(n=0;n<out.o.length&&out.o[n].text==null;n++){str+="<del>"+escape(out.o[n])+oSpace[n]+"</del>"}}for(var i=0;i<out.n.length;i++){if(out.n[i].text==null){str+="<ins>"+escape(out.n[i])+nSpace[i]+"</ins>"}else{var pre="";for(n=out.n[i].row+1;n<out.o.length&&out.o[n].text==null;n++){pre+="<del>"+escape(out.o[n])+oSpace[n]+"</del>"}str+=" "+out.n[i].text+nSpace[i]+pre}}}return str}function diff(o,n){var ns=new Object;var os=new Object;for(var i=0;i<n.length;i++){if(ns[n[i]]==null)ns[n[i]]={rows:new Array,o:null};ns[n[i]].rows.push(i)}for(var i=0;i<o.length;i++){if(os[o[i]]==null)os[o[i]]={rows:new Array,n:null};os[o[i]].rows.push(i)}for(var i in ns){if(ns[i].rows.length==1&&typeof os[i]!="undefined"&&os[i].rows.length==1){n[ns[i].rows[0]]={text:n[ns[i].rows[0]],row:os[i].rows[0]};o[os[i].rows[0]]={text:o[os[i].rows[0]],row:ns[i].rows[0]}}}for(var i=0;i<n.length-1;i++){if(n[i].text!=null&&n[i+1].text==null&&n[i].row+1<o.length&&o[n[i].row+1].text==null&&n[i+1]==o[n[i].row+1]){n[i+1]={text:n[i+1],row:n[i].row+1};o[n[i].row+1]={text:o[n[i].row+1],row:i+1}}}for(var i=n.length-1;i>0;i--){if(n[i].text!=null&&n[i-1].text==null&&n[i].row>0&&o[n[i].row-1].text==null&&n[i-1]==o[n[i].row-1]){n[i-1]={text:n[i-1],row:n[i].row-1};o[n[i].row-1]={text:o[n[i].row-1],row:i-1}}}return{o:o,n:n}}return{roundFloat:round,checkTimeFromNow:checkTimeFromNow,getRatio:getRatio,addCommas:addCommas,formatCurrency:formatCurrency,pluralStr:pluralStr,formatPhoneNumber:formatPhoneNumber,newlineToBr:newlineToBr,validatePhoneNumberComponent:validatePhoneNumberComponent,validateSize:validateSize,validateArea:validateArea,validateColor:validateColor,validateShippingTime:validateShippingTime,validateEmail:validateEmail,validateURL:validateURL,validateMinMaxShipTime:validateMinMaxShipTime,containsChineseCharacter:containsChineseCharacter,cleanPhoneNumber:cleanPhoneNumber,validateVolume:validateVolume,validateWeight:validateWeight,validateLength:validateLength,validateVoltage:validateVoltage,formatPercentage:formatPercentage,validatePrice:validatePrice,escapeCSS:escapeCSS,is_ascii:is_ascii,diffString:diffString}});
define('core/template',["underscore","core/url","core/string_utils","core/i18n"],function(_,url,string,i18nModule){var GlobalTplContext={wishURL:url.wishURL,absURL:url.absURL,absExtURL:url.absExtURL,contestImageURL:url.contestImageURL,resizedContestImageURL:url.resizedContestImageURL,formatCurrency:string.formatCurrency,pluralStr:string.pluralStr,formatPhoneNumber:string.formatPhoneNumber,newlineToBr:string.newlineToBr,addCommas:string.addCommas,getRatio:string.getRatio,checkTimeFromNow:string.checkTimeFromNow,formatPercentage:string.formatPercentage,roundFloat:string.roundFloat,_:_};_.extend(GlobalTplContext,i18nModule);if(typeof window.staticUrl!==undefined){GlobalTplContext["staticUrl"]=window.staticUrl}function buildTemplate(tpl){if(typeof tpl=="string"){tpl=_.template(tpl)}function renderWrapper(data){data=data?data:{};return tpl(_.extend(data,GlobalTplContext))}return renderWrapper}return{buildTemplate:buildTemplate}});
define('lib/jquery.cookie',[],function(){(function($,document,undefined){var pluses=/\+/g;function raw(s){return s}function decoded(s){return decodeURIComponent(s.replace(pluses," "))}var config=$.cookie=function(key,value,options){if(value!==undefined){options=$.extend({},config.defaults,options);if(value===null){options.expires=-1}if(typeof options.expires==="number"){var days=options.expires,t=options.expires=new Date;t.setDate(t.getDate()+days)}value=config.json?JSON.stringify(value):String(value);return document.cookie=[encodeURIComponent(key),"=",config.raw?value:encodeURIComponent(value),options.expires?"; expires="+options.expires.toUTCString():"",options.path?"; path="+options.path:"",options.domain?"; domain="+options.domain:"",options.secure?"; secure":""].join("")}var decode=config.raw?raw:decoded;var cookies=document.cookie.split("; ");for(var i=0,parts;parts=cookies[i]&&cookies[i].split("=");i++){if(decode(parts.shift())===key){var cookie=decode(parts.join("="));return config.json?JSON.parse(cookie):cookie}}return null};config.defaults={};$.removeCookie=function(key,options){if($.cookie(key)!==null){$.cookie(key,null,options);return true}return false}})(jQuery,document)});
(function(){var progIds=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],tplSplitRegExp=/^\/\/ ([A-Z0-9_]+) \\\\/im,buildMap={},templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},escapes={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},escaper=/\\|'|\r|\n|\t|\u2028|\u2029/g,template=function(text){var matcher=new RegExp([(templateSettings.escape||noMatch).source,(templateSettings.interpolate||noMatch).source,(templateSettings.evaluate||noMatch).source].join("|")+"|$","g");var index=0;var source="__p+='";text=text.replace(/[ \n\t\r]+/g," ");text.replace(matcher,function(match,escape,interpolate,evaluate,offset){source+=text.slice(index,offset).replace(escaper,function(match){return"\\"+escapes[match]});source+=escape?"'+((__t=("+escape+"))==null?'':_.escape(__t))+'":interpolate?"'+((__t=("+interpolate+"))==null?'':__t)+'":evaluate?"';"+evaluate+" __p+='":"";index=offset+match.length});source+="';";source=source.replace(/[ \t]+/g," ");source="with(obj||{}){"+source+"}";source="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};"+source+"return __p;";return source};define('tpl',[],function(){var tpl;var get,fs;if(typeof window!=="undefined"&&window.navigator&&window.document){get=function(url,callback){var xhr=tpl.createXhr();xhr.open("GET",url,true);xhr.onreadystatechange=function(evt){if(xhr.readyState===4){callback(xhr.responseText)}};xhr.send(null)}}else if(typeof process!=="undefined"&&process.versions&&!!process.versions.node){fs=require.nodeRequire("fs");get=function(url,callback){callback(fs.readFileSync(url,"utf8"))}}return tpl={version:"0.24.0",jsEscape:function(content){return content.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g," ").replace(/[\t]/g," ").replace(/[\r]/g," ")},createXhr:function(){var xhr,i,progId;if(typeof XMLHttpRequest!=="undefined"){return new XMLHttpRequest}else{for(i=0;i<3;i++){progId=progIds[i];try{xhr=new ActiveXObject(progId)}catch(e){}if(xhr){progIds=[progId];break}}}if(!xhr){throw new Error("require.getXhr(): XMLHttpRequest not available")}return xhr},get:get,load:function(name,req,onLoad,config){var filePrefix="../../templates/js/";if(config.locale){filePrefix="../../templates/build-js-"+config.locale+"/"}var fileName=filePrefix+name;var url="nameToUrl"in req?req.nameToUrl(fileName,".html"):req.toUrl(fileName+".html");var tplBegin=url.indexOf(filePrefix);url=config.baseUrl+filePrefix+name+".html";if(buildMap.hasOwnProperty(name)){return onLoad(buildMap[name])}tpl.get(url,function(content){subtemplates=content.split(tplSplitRegExp);if(subtemplates[0]==""){subtemplates=subtemplates.slice(1)}content_obj={};for(var i=0;i<subtemplates.length;i+=2){content_obj[subtemplates[i]]=template(subtemplates[i+1])}if(config.isBuild){pieces=[];for(tpl_name in content_obj){if(content_obj.hasOwnProperty(tpl_name)){pieces.push('"'+tpl_name+'"'+":function(obj){"+content_obj[tpl_name]+"}")}}ret_content="return {"+pieces.join(",")+"};"}else{ret_content={};for(tpl_name in content_obj){if(content_obj.hasOwnProperty(tpl_name)){try{ret_content[tpl_name]=new Function("obj",content_obj[tpl_name])}catch(e){console.log("Exception compiling "+tpl_name);console.debug("Template output (beautify & syntax check...):");console.debug(content_obj[tpl_name]);throw e}}}}buildMap[name]=ret_content;onLoad(ret_content)})},write:function(pluginName,moduleName,write){if(moduleName in buildMap){var content=tpl.jsEscape(buildMap[moduleName]);write("define('"+pluginName+"!"+moduleName+"', function() {"+content.replace(/(\\')/g,"'").replace(/(\\\\)/g,"\\")+"});\n")}}};return function(){}})})();
define('tpl!modal', function() {return {"alert_modal":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class="modal hide fade"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button> <h3>'+((__t=(title))==null?'':_.escape(__t))+'</h3> </div> <div class="modal-body"> <div class="alert alert-'+((__t=(type))==null?'':_.escape(__t))+'"> <strong> '; _.each(message.split('\n'), function(msg) { __p+=' <p>'+((__t=(msg))==null?'':_.escape(__t))+'</p> '; }); __p+=' </strong> </div> </div> <div class="modal-footer"> <a data-dismiss="modal" class="btn btn-primary" id="'+((__t=(type))==null?'':_.escape(__t))+'-btn">OK</a> </div> </div> ';}return __p;},"info_modal":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class="modal hide fade"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button> <h3>'+((__t=(title))==null?'':_.escape(__t))+'</h3> </div> <div class="modal-body"> '; if (typeof body !== "undefined") { __p+=' '+((__t=(body))==null?'':__t)+' '; } else { __p+=' <div class=""> <strong> '; _.each(message.split('\n'), function(msg) { __p+=' <p>'+((__t=(msg))==null?'':_.escape(__t))+'</p> '; }); __p+=' </strong> </div> '; } __p+=' </div> <div class="modal-footer"> <a data-dismiss="modal" class="btn btn-primary">OK</a> </div> </div> ';}return __p;},"relogin_modal":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class="modal hide fade"> <div class="modal-header" style="background: #f1f1f1"> <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button> <h3 style="text-align: center;">'+((__t=(title))==null?'':_.escape(__t))+'</h3> </div> <div class="modal-body"> <div style="text-align: center; padding: 0px 40px 0px 40px; font-size: 16px; margin-top: 5px;"> <div style="font-size: 14px"> '; _.each(message.split('\n'), function(msg) { __p+=' <p>'+((__t=(msg))==null?'':_.escape(__t))+'</p> '; }); __p+=' </div> <table> <tr> <td valign="middle" style="font-size: 14px; text-align: right; padding-bottom: 10px"> '+((__t=(username_prompt))==null?'':_.escape(__t))+': </td> <td> <input id="username" style="text-align:left; padding: 10px; width: 275px;" type="text" value="'+((__t=(username_txt))==null?'':_.escape(__t))+'" required="true" disabled /> </td> </tr> <tr> <td valign="middle" style="font-size: 14px; text-align: right; padding-bottom: 10px"> '+((__t=(password_prompt))==null?'':_.escape(__t))+': </td> <td> <input id="password" type="password" name="password" style="text-align:left; padding: 10px; width:275px;" required="true" placeholder="'+((__t=(password_txt))==null?'':_.escape(__t))+'" /> </td> </tr> </table> </div> </div> <div class="modal-footer"> <a data-dismiss="modal" class="btn btn-cancel">'+((__t=(cancel_txt))==null?'':_.escape(__t))+'</a> <a class="btn btn-primary" id="relogin-btn" >'+((__t=(relogin_txt))==null?'':_.escape(__t))+'</a> </div> </div> ';}return __p;}};});

define('core/api',["underscore","core/url","lib/jquery.cookie","tpl!modal","core/i18n"],function(_,urlModule,cookie,modals,i18n){var i18n=i18n.i18n;function _handleError(resp,data,xhr,opt,cb,call_data){if(window.debug){if(resp){console.debug("API call error: %s (code %d)",resp.msg,resp.code)}if(data&&data.trace){console.debug(data.trace)}else if(resp.data&&resp.data.trace){console.debug(resp.data.trace)}}if(resp.code==2&&resp.data.session_expired==true){setTimeout(function(){window.location=urlModule.absURL("/login")},3500)}if(resp.code==3&&resp.data.secure_session_expired==true){var uname=resp.data.username;launchReloginModal(uname,call_data)}if(cb){cb(resp,data,xhr,opt)}else{var msg=resp&&resp.msg?resp.msg:i18n("");launchErrorModal(msg)}}function launchErrorModal(message){var modal_el=modals.alert_modal({title:"Error",message:message,type:"error"});var $modal_el=$(modal_el);$modal_el.modal({});$modal_el.on("hidden",function(){$modal_el.remove()});return $modal_el}function launchReloginModal(uname,call_data){var modal_el=modals.relogin_modal({title:i18n(""),message:i18n(",:"),username_txt:uname,password_txt:i18n(""),username_prompt:i18n(""),password_prompt:i18n(""),relogin_txt:i18n(""),cancel_txt:i18n("")});var $modal_el=$(modal_el);var $pwd_box=$modal_el.find("#password");var $relogin_btn=$modal_el.find("#relogin-btn");var $click_btn=$relogin_btn;$modal_el.on("shown",function(){$pwd_box.focus()});$modal_el.modal({});$relogin_btn.on("click",function(){pwd=$pwd_box.val();if(pwd==""){$err_modal=launchErrorModal(i18n(""));$mb=$modal_el.find(".modal-body");$click_btn=$err_modal.find(".btn");$err_modal.find(".modal-body").css({height:$mb.height(),width:$mb.width()});return}call("relogin",{password:pwd},function(){$modal_el.modal("hide");call.apply(this,call_data)},function(){$err_modal=launchErrorModal(i18n(""));$mb=$modal_el.find(".modal-body");$click_btn=$err_modal.find(".btn");$err_modal.find(".modal-body").css({height:$mb.height(),width:$mb.width()})})});$pwd_box.keypress(function(evt){if(evt.keyCode==13){$click_btn.click();if($click_btn!=$relogin_btn){$click_btn=$relogin_btn}}});$modal_el.on("hidden",function(){$modal_el.remove()})}function launchSuccessModal(message){var modal_el=modals.alert_modal({title:"Success",message:message,type:"success"});var $modal_el=$(modal_el);$modal_el.modal({});$modal_el.on("hidden",function(){$modal_el.remove()});return $modal_el}function launchInfoModal(message,title){var modal_el=modals.info_modal({title:title,message:message});var $modal_el=$(modal_el);$modal_el.modal({});$modal_el.on("hidden",function(){$modal_el.remove()})}var makeOriginalXhr=_.bind($.ajaxSettings.xhr,$.ajaxSettings);var newOptions={};function handleOnProgress(evt,options){if(typeof options.progress==="function"){options.progress(options.__jqXHR,evt)}}newOptions.xhr=function(){var s=this;var newXhr=makeOriginalXhr();if(newXhr){newXhr.addEventListener("progress",function(evt){handleOnProgress(evt,s)})}return newXhr};$.ajaxSetup(newOptions);function call(method,params,callback,errorCallback,data,selector){var url=urlModule.absURL("api/"+method);var args=arguments;_.each(params,function(v,k){if(v==null){delete params[k]}});return $.ajax({beforeSend:function(xhr,settings){xhr.setRequestHeader("X-XSRFToken",$.cookie("_xsrf"));return true},type:"POST",url:url,dataType:"json",data:params,success:function(o,xhr,opt){o.additional_data=data;if(callback){callback(o,data,xhr,opt)}},error:function(xhr,opt,data){if(opt=="abort"){return}else{try{resp=jQuery.parseJSON(xhr.responseText)}catch(err){if(xhr.status==504){resp={code:4,msg:"Request Timedout"}}else{resp={code:9,msg:"Unknown Error"}}}_handleError(resp,data,xhr,opt,errorCallback,args)}}})}function file(method,params,callback,progressCallback,errorCallback,data,selector){var url=urlModule.absURL("api/"+method);_.each(params,function(v,k){if(v==null){delete params[k]}});return $.ajax({beforeSend:function(xhr,settings){xhr.setRequestHeader("X-XSRFToken",$.cookie("_xsrf"));return true},progress:function(xhr,progressEvent){if(progressCallback){progressCallback(progressEvent)}},type:"POST",url:url,data:params,processData:false,contentType:false,success:function(o,xhr,opt){if(callback){callback(o,data,xhr,opt)}},error:function(xhr,opt,data){if(opt=="abort"){return}else{try{resp=jQuery.parseJSON(xhr.responseText)}catch(err){if(xhr.status==504){resp={code:4,msg:"Request Timedout"}}else{resp={code:9,msg:"Unknown Error"}}}_handleError(resp,data,xhr,opt,errorCallback,arguments)}}})}return{launchSuccessModal:launchSuccessModal,launchErrorModal:launchErrorModal,launchInfoModal:launchInfoModal,call:call,file:file,_handleError:_handleError}});
define('core/bb',["backbone","core/template","core/api"],function(Backbone,TplModule,api){var BackboneView=Backbone.View.extend({buildTpl:function(tpl){return TplModule.buildTemplate(tpl)}});var BackboneModel=Backbone.Model.extend({readOnlyAttributes:[],sync:function(method,model,_options){var options={};$.extend(true,options,_options);var urlPostfix=method;if(method=="read"){urlPostfix="get"}if(!options.url){options.url=model.urlRoot}options.url+="/"+urlPostfix;var params=model.toJSON();return api.call(options.url,params,options.callback,options.errorCallback,options.data,options.selector)},fetch:function(_options){var options={};$.extend(true,options,_options);var model=this;var callback=options.callback;options.callback=_.bind(function(resp,data,xhr,opt){if(!model.set(model.parse(resp,xhr),options))return false;if(callback)callback(model,resp)},this);return this.sync.call(this,"read",this,options)},save:function(_options){var options={};$.extend(true,options,_options);var model=this;var callback=options.callback;options.callback=_.bind(function(resp,data,xhr,opt){if(!model.set(model.parse(resp,xhr),options))return false;if(callback)callback(model,resp)},this);var method=this.isNew()?"create":"update";return this.sync.call(this,method,this,options)},destroy:function(_options){var options={};$.extend(true,options,_options);var model=this;var triggerDestroy=function(){model.trigger("destroy",model,model.collection,options)};if(this.isNew()){triggerDestroy();return false}var callback=options.callback;options.callback=function(resp){if(options.wait)triggerDestroy();if(callback){callback(model,resp)}else{model.trigger("sync",model,resp,options)}};options.error=Backbone.wrapError(options.error,model,options);var xhr=(this.sync||Backbone.sync).call(this,"delete",this,options);if(!options.wait)triggerDestroy();return xhr},parse:function(resp,xhr){return resp.data},toJSON:function(options){var data={};for(var att in this.attributes){if(!_.contains(this.readOnlyAttributes,att)){if(this.attributes[att]!==null&&typeof this.attributes[att]==="object"){data[att]=JSON.stringify(this.attributes[att])}else{data[att]=this.attributes[att]}}}return data}});var BackboneRouter=Backbone.Router.extend({});var BackboneCollection=Backbone.Collection.extend({});var startHistory=function(){if(Backbone.history){Backbone.history.start()}};return{BackboneView:BackboneView,BackboneModel:BackboneModel,BackboneRouter:BackboneRouter,BackboneCollection:BackboneCollection,startHistory:startHistory}});
define('domReady',[],function(){var isBrowser=typeof window!=="undefined"&&window.document,isPageLoaded=!isBrowser,doc=isBrowser?document:null,readyCalls=[],readyLoaderCalls=[],req=requirejs||require||{},oldResourcesReady=req.resourcesReady,scrollIntervalId;function runCallbacks(callbacks){for(var i=0,callback;callback=callbacks[i];i++){callback(doc)}}function callReady(){var callbacks=readyCalls,loaderCallbacks=readyLoaderCalls;if(isPageLoaded){if(callbacks.length){readyCalls=[];runCallbacks(callbacks)}if(req.resourcesDone&&loaderCallbacks.length){readyLoaderCalls=[];runCallbacks(loaderCallbacks)}}}if("resourcesReady"in req){req.resourcesReady=function(isReady){if(oldResourcesReady){oldResourcesReady(isReady)}if(isReady){callReady()}}}function pageLoaded(){if(!isPageLoaded){isPageLoaded=true;if(scrollIntervalId){clearInterval(scrollIntervalId)}callReady()}}if(isBrowser){if(document.addEventListener){document.addEventListener("DOMContentLoaded",pageLoaded,false);window.addEventListener("load",pageLoaded,false)}else if(window.attachEvent){window.attachEvent("onload",pageLoaded);if(self===self.top){scrollIntervalId=setInterval(function(){try{if(document.body){document.documentElement.doScroll("left");pageLoaded()}}catch(e){}},30)}}if(document.readyState==="complete"){pageLoaded()}}function domReady(callback){if(isPageLoaded){callback(doc)}else{readyCalls.push(callback)}return domReady}domReady.withResources=function(callback){if(isPageLoaded&&req.resourcesDone){callback(doc)}else{readyLoaderCalls.push(callback)}return domReady};domReady.version="1.0.0";domReady.load=function(name,req,onLoad,config){if(config.isBuild){onLoad(null)}else{domReady(onLoad)}};return domReady});
define('tpl!modals/base_modal', function() {return {"base_modal":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class="modal hide fade" id="'+((__t=(modal_id))==null?'':_.escape(__t))+'"> <div class="modal-header"> <h3>'+((__t=(modal_header))==null?'':_.escape(__t))+'</h3> </div> <div class=\'modal-body\'></div> <div class="modal-footer"> <a data-dismiss="modal" class="btn">Close</a> </div> </div> ';}return __p;}};});

define('view/modal/BaseModal',["core/bb","tpl!modals/base_modal"],function(bb,modal_tpl){var BaseModalView=bb.BackboneView.extend({setView:function(options){this.view=$(modal_tpl.base_modal({modal_id:options.id,modal_header:options.header}));this.view.find(".modal-body").html(options.body);return this.view},launchModal:function(el,options){var $modal_el=$(el);if(!options)options={};$modal_el.on("hidden",_.bind(function(){this.trigger("hidden")},this));if($(".modal-backdrop")){$modal_el.on("shown",function(e){var $t=$(e.target);if($t.hasClass("modal")){$t2=$t.data("modal");$t2.$backdrop.css("z-index",1047)}}).on("hidden",function(e){var $t=$(e.target);if($t.hasClass("modal")){$("body").addClass("modal-open")}}).on("focusin",function(e){e.stopPropagation()})}$modal_el.modal(options);$modal_el.on("hidden",function(){$modal_el.remove()});this.setElement($modal_el)},apiError:function(resp){this.$(".modal-footer").html("<button "+'class="btn btn-primary" data-dismiss="modal">Ok</button>');this.$(".modal-body").html('<div class="alert alert-error">'+"<strong>"+resp.msg+"</strong>"+"</div>")},apiSuccess:function(msg){this.$(".modal-footer").html("<button "+'class="btn btn-primary" data-dismiss="modal">Ok</button>');this.$(".modal-body").html('<div class="alert alert-success"><strong>'+msg+"</strong></div>")},closeModal:function(){$(this.el).modal("hide")}});return BaseModalView});
define('tpl!modals/onboarding_checklist', function() {return {"modal":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div id="onboarding-checklist-modal" class="modal hide fade"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button> <h3>'+((__t=(modal_title))==null?'':_.escape(__t))+'</h3> </div> <div class="modal-body"> </div> <div class="modal-footer"> <a class="btn btn-primary" href="'+((__t=(absURL('/')))==null?'':_.escape(__t))+'">'+((__t=(i18n("")))==null?'':_.escape(__t))+'</a> <button data-dismiss="modal" type="button" class="btn">'+((__t=(i18n("")))==null?'':_.escape(__t))+'</button> </div> </div> ';}return __p;}};});

define('tpl!new_onboarding', function() {return {"contact_info":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class="onboarding-form"> <div class="title"> '+((__t=(i18n("")))==null?'':_.escape(__t))+' </div> <form> <div class="row-fluid"> <div class="span6 control-group"> <label class="control-label" for="first_name">'+((__t=(i18n("")))==null?'':_.escape(__t))+'</label> <div class="controls input-append"> <input type="text" class="form-control" value="'+((__t=(fields.first_name))==null?'':_.escape(__t))+'" id="first_name" placeholder="'+((__t=(i18n("")))==null?'':_.escape(__t))+'" required/> <span class="add-on"><i class="icon icon-pencil"></i></span> </div> </div> <div class="span6 control-group"> <label class="control-label" for="last_name">'+((__t=(i18n("")))==null?'':_.escape(__t))+'</label> <div class="controls input-append"> <input type="text" class="form-control" value="'+((__t=(fields.last_name))==null?'':_.escape(__t))+'" id="last_name" placeholder="'+((__t=(i18n("")))==null?'':_.escape(__t))+'" required/> <span class="add-on"><i class="icon icon-pencil"></i></span> </div> </div> </div> <div class="row-fluid"> <div class="span12 control-group"> <label class="control-label" for="street_address1"> '+((__t=(i18n("")))==null?'':_.escape(__t))+' </label> <div class="controls input-append"> <input type="text" class="form-control" value="'+((__t=(fields.street_address1))==null?'':_.escape(__t))+'" id="street_address1" placeholder="'+((__t=(i18n("")))==null?'':_.escape(__t))+'" required/> <span class="add-on"><i class="icon icon-pencil"></i></span> </div> </div> </div> <div class="row-fluid"> <div class="span12 control-group"> <div class="controls input-append"> <input type="text" class="form-control" value="'+((__t=(fields.street_address2))==null?'':_.escape(__t))+'" id="street_address2" placeholder="'+((__t=(i18n("2")))==null?'':_.escape(__t))+'"/> <span class="add-on"><i class="icon icon-pencil"></i></span> </div> </div> </div> <div class="row-fluid"> <div class="span6 control-group"> <label class="control-label" for="country_code"> '+((__t=(i18n("")))==null?'':_.escape(__t))+' </label> <div class="controls input-append"> <select id="country_code" class="form-control" required> <option value>'+((__t=(i18n("")))==null?'':_.escape(__t))+'</option> '; _.each(countries, function(country) { __p+=' '; var code = country[0]; __p+=' '; var name = code == "GB" ? "United Kingdom" : country[1]; __p+=' <option '+((__t=(code == fields.country_code ? 'selected' : ''))==null?'':_.escape(__t))+' value="'+((__t=(code))==null?'':_.escape(__t))+'">'+((__t=(name))==null?'':_.escape(__t))+'</option> '; }); __p+=' </select> <span class="add-on"><i class="icon icon-pencil"></i></span> </div> </div> <div class="span6 control-group"> <label class="control-label" for="state"> '+((__t=(i18n("")))==null?'':_.escape(__t))+' </label> <div id="state-container" class="controls input-append"> </div> </div> </div> <div class="row-fluid"> <div class="span6 control-group"> <label class="control-label" for="city"> '+((__t=(i18n("")))==null?'':_.escape(__t))+' </label> <div id="city-container" class="controls input-append"> </div> </div> <div class="span6 control-group"> <label class="control-label" for="zipcode"> '+((__t=(i18n("")))==null?'':_.escape(__t))+' </label> <div class="controls input-append"> <input type="text" class="form-control" value="'+((__t=(fields.zipcode))==null?'':_.escape(__t))+'" id="zipcode" placeholder="'+((__t=(i18n("")))==null?'':_.escape(__t))+'" required/> <span class="add-on"><i class="icon icon-pencil"></i></span> </div> </div> </div> <div class="row-fluid"> <div class="span6 control-group"> <label class="control-label" for="phone_country"> '+((__t=(i18n("")))==null?'':_.escape(__t))+' </label> <div class="controls row-fluid"> <div class="span3"> <input type="text" class="form-control phone-component" value="'+((__t=(fields.phone_number_country))==null?'':_.escape(__t))+'" required id="phone_number_country" placeholder="'+((__t=(i18n("")))==null?'':_.escape(__t))+'"/> </div> <div class="span3"> <input type="text" class="form-control phone-component" value="'+((__t=(fields.phone_number_area))==null?'':_.escape(__t))+'" required id="phone_number_area" placeholder="'+((__t=(i18n("")))==null?'':_.escape(__t))+'"/> </div> <div class="span6 input-append"> <input type="text" class="form-control phone-component" value="'+((__t=(fields.phone_number_number))==null?'':_.escape(__t))+'" required id="phone_number_number" placeholder="'+((__t=(i18n("")))==null?'':_.escape(__t))+'"/> <span class="add-on"><i class="icon icon-pencil"></i></span> </div> </div> <div class="controls row-fluid"> Ex. + 1 - 234 - 5678910 <br/> Ex. + 86 - - 13912345678 <br/> Ex. + 86 - 21 - 65142545 </div> </div> </div> </form> <hr/> <div class="buttons clearfix"> <div class="pull-left"> </div> <div class="pull-right"> <span id="next-btn" class="flat-orange-btn onboarding-btn"> '+((__t=(i18n("")))==null?'':_.escape(__t))+' </span> </div> </div> </div> ';}return __p;},"state_input":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' '; if (state_options) { __p+=' <select id="state" class="form-control" required> <option value="">'+((__t=(i18n("")))==null?'':_.escape(__t))+'</option> '; _.each(state_options, function(state) { __p+=' <option '+((__t=(state == fields.state ? 'selected' : ''))==null?'':_.escape(__t))+' value="'+((__t=(state))==null?'':_.escape(__t))+'">'+((__t=(state))==null?'':_.escape(__t))+'</option> '; }); __p+=' </select> '; } else { __p+=' <input type="text" class="form-control" value="'+((__t=(fields.state))==null?'':_.escape(__t))+'" id="state" placeholder="'+((__t=(i18n("")))==null?'':_.escape(__t))+'" required '+((__t=(state_options === null ? 'disabled' : ''))==null?'':_.escape(__t))+'/> '; } __p+=' <span class="add-on"><i class="icon icon-pencil"></i></span> ';}return __p;},"city_input":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' '; if (city_options) { __p+=' <select id="city" class="form-control" required> <option value>'+((__t=(i18n("")))==null?'':_.escape(__t))+'</option> '; _.each(city_options, function(city) { __p+=' <option '+((__t=(city == fields.city ? 'selected' : ''))==null?'':_.escape(__t))+' value="'+((__t=(city))==null?'':_.escape(__t))+'">'+((__t=(city))==null?'':_.escape(__t))+'</option> '; }); __p+=' </select> '; } else { __p+=' <input type="text" class="form-control" value="'+((__t=(fields.city))==null?'':_.escape(__t))+'" id="city" placeholder="'+((__t=(i18n("")))==null?'':_.escape(__t))+'" required '+((__t=(city_options === null ? 'disabled' : ''))==null?'':_.escape(__t))+'/> '; } __p+=' <span class="add-on"><i class="icon icon-pencil"></i></span> ';}return __p;},"store_info":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class="onboarding-form"> <div class="title"> '+((__t=(i18n("")))==null?'':_.escape(__t))+' </div> <form> <div class="row-fluid"> <div class="span12 control-group"> <label class="control-label" for="store_url"> '+((__t=(i18n("?")))==null?'':_.escape(__t))+' </label> <div class="controls input-prepend input-append"> <select id="store_platform" class="form-control add-on" required data-name="'+((__t=(i18n("")))==null?'':_.escape(__t))+'"> <option value>'+((__t=(i18n("")))==null?'':_.escape(__t))+'</option> '; _.each(store_platforms, function(platform) { __p+=' <option '+((__t=(fields.store_platform == platform[0] ? 'selected' : ''))==null?'':_.escape(__t))+' value="'+((__t=(platform[0]))==null?'':_.escape(__t))+'">'+((__t=(platform[1]))==null?'':_.escape(__t))+'</option> '; }); __p+=' </select> <input type="url" id="store_url" data-name="'+((__t=(i18n("URL")))==null?'':_.escape(__t))+'" class="form-control" value="'+((__t=(fields.store_url))==null?'':_.escape(__t))+'" '+((__t=(fields.store_platform ? '' : 'disabled'))==null?'':_.escape(__t))+' placeholder="'+((__t=(i18n("URL")))==null?'':_.escape(__t))+'" required /> <span class="add-on"><i class="icon icon-pencil"></i></span> </div> </div> </div> <div class="row-fluid"> <div class="span12 control-group"> <label class="control-label" for="annual_gmv"> '+((__t=(i18n("?()")))==null?'':_.escape(__t))+' </label> <div class="controls input-append"> <input type="number" class="form-control" required min="0" step="0.01" value="'+((__t=(fields.annual_gmv))==null?'':_.escape(__t))+'" id="annual_gmv" placeholder="'+((__t=(i18n("")))==null?'':_.escape(__t))+'" data-name="'+((__t=(i18n("")))==null?'':_.escape(__t))+'"/> <span class="add-on"><i class="icon icon-pencil"></i></span> </div> </div> </div> <div class="row-fluid"> <div class="span12 control-group"> <label class="control-label" for="warehouse_location_country"> '+((__t=(i18n("Where is your inventory/warehouse located?")))==null?'':_.escape(__t))+' </label> </div> </div> <div class="row-fluid"> <div class="span6 control-group"> <div class="controls input-append"> <select id="warehouse_location_country" data-name="'+((__t=(i18n("Warehouse/Inventory Country")))==null?'':_.escape(__t))+'" class="form-control" required> <option value>'+((__t=(i18n("")))==null?'':_.escape(__t))+'</option> '; _.each(countries, function(country) { __p+=' '; var code = country[0]; __p+=' '; var name = code == "GB" ? "United Kingdom" : country[1]; __p+=' <option '+((__t=(name == fields.warehouse_location_country ? 'selected' : ''))==null?'':_.escape(__t))+' value="'+((__t=(name))==null?'':_.escape(__t))+'">'+((__t=(name))==null?'':_.escape(__t))+'</option> '; }); __p+=' </select> <span class="add-on"><i class="icon icon-pencil"></i></span> </div> </div> <div class="span6 control-group"> <div class="controls input-append"> <input type="text" data-name="'+((__t=(i18n("Warehouse/Inventory Region")))==null?'':_.escape(__t))+'" class="form-control" value="'+((__t=(fields.warehouse_location_region))==null?'':_.escape(__t))+'" id="warehouse_location_region" placeholder="'+((__t=(i18n("//")))==null?'':_.escape(__t))+'"/> <span class="add-on"><i class="icon icon-pencil"></i></span> </div> </div> </div> <div class="row-fluid"> <div class="span12 control-group"> <label class="control-label" for="product_categories"> '+((__t=(i18n("")))==null?'':_.escape(__t))+' </label> <div class="row-fluid"> '; var i = 0; __p+=' '; _.each(product_categories, function(text, key) { __p+=' '; if (i % 3 == 0 && i !== 0) { __p+=' </div> <div class="row-fluid"> '; } __p+=' <div class="span4"> <label class="checkbox-label"> <input type="checkbox" name="product_categories" '; if (fields.product_categories[key]) { __p+=' checked '; } __p+=' class="form-control" value="'+((__t=(key))==null?'':_.escape(__t))+'"/> '+((__t=(text))==null?'':_.escape(__t))+' </label> </div> '; i++; __p+=' '; }); __p+=' </div> </div> </div> </form> <div id="bottom-notice"> '+((__t=(i18n(",")))==null?'':_.escape(__t))+' <a href="'+((__t=(absURL('terms-of-service')))==null?'':_.escape(__t))+'" target="_blank"> '+((__t=(i18n("Wish")))==null?'':_.escape(__t))+' </a> '+((__t=(i18n("")))==null?'':_.escape(__t))+' <a href="'+((__t=(absURL('policy/home')))==null?'':_.escape(__t))+'" target="_blank"> '+((__t=(i18n("")))==null?'':_.escape(__t))+' </a> </div> <hr/> <div class="buttons clearfix"> <div class="pull-left"> <span id="back-btn" class="btn-link text-btn onboarding-btn"> '+((__t=(i18n("")))==null?'':_.escape(__t))+' </span> </div> <div class="pull-right"> <span id="next-btn" class="flat-orange-btn onboarding-btn"> '+((__t=(i18n("")))==null?'':_.escape(__t))+' </span> </div> </div> </div> ';}return __p;},"checklist_view":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class="onboarding-checklist"> '; if (title !== null) { __p+=' <h3 class="title">'+((__t=(title))==null?'':_.escape(__t))+'</h3> '; } __p+=' '; if (subtitle || subtitle === null) { __p+=' <div class="subtitle alert alert-success"> '; if (subtitle === null) { __p+=' '; if (remaining_items.length === 0) { __p+=' '+((__t=(i18n("! !")))==null?'':_.escape(__t))+' '; } else if (remaining_items.length === 1) { __p+=' '+((__t=(i18n("!%1$s !", remaining_items[0].text)))==null?'':_.escape(__t))+' '; } else if (remaining_items.length === 2) { __p+=' '+((__t=(i18n("!")))==null?'':_.escape(__t))+' '; } else { __p+=' '+((__t=(i18n("!")))==null?'':_.escape(__t))+' '; } __p+=' '; } else { __p+=' '+((__t=(subtitle))==null?'':_.escape(__t))+' '; } __p+=' </div> '; } __p+=' <div class="onboarding-checklist-container"></div> '; if (bottom_btn || remaining_items.length === 0) { __p+=' <div class="onboarding-open-store-btn '+((__t=(remaining_items.length ? 'disabled' : ''))==null?'':_.escape(__t))+'"> '+((__t=(btn_text))==null?'':_.escape(__t))+' </div> '; } __p+=' </div> ';}return __p;}};});

define('tpl!checklist', function() {return {"checklist":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class="checklist"> '; _.each(items, function(item, idx) { __p+=' <div class="clearfix checklist-item'+((__t=(item.complete ? ' checklist-item-complete' : ''))==null?'':_.escape(__t))+'" data-idx="'+((__t=(idx))==null?'':_.escape(__t))+'"> <div class="checklist-item-icon pull-left"> <i class="'+((__t=(item.complete ? 'fa fa-check' : ''))==null?'':_.escape(__t))+'"></i> </div> <span class="checklist-item-text pull-left"> '+((__t=(item.text))==null?'':_.escape(__t))+' </span> '; if (item.complete) { __p+=' <span class="checklist-item-btn pull-right"> '+((__t=(item.doneText))==null?'':_.escape(__t))+' </span> '; } else { __p+=' '; if (item.url === null) { __p+=' <span class="checklist-item-btn pull-right"> '+((__t=(item.btnText))==null?'':_.escape(__t))+' </span> '; } else { __p+=' <a href="'+((__t=(item.url))==null?'':_.escape(__t))+'" class="checklist-item-btn pull-right"> '+((__t=(item.btnText))==null?'':_.escape(__t))+' </a> '; } __p+=' '; } __p+=' </div> '; }); __p+=' </div> ';}return __p;}};});

define('view/Checklist',["underscore","core/bb","tpl!checklist","core/i18n"],function(_,bb,tpl,i18nModule){var i18n=i18nModule.i18n;var baseItem={text:"To do item",btnText:i18n(""),complete:false,btnDone:true,doneText:i18n(""),url:null};var ChecklistView=bb.BackboneView.extend({options:{},initialize:function(options){$.extend(true,this.options,options);this.items=_.map(options.items,function(item){var new_item={};$.extend(new_item,baseItem);$.extend(new_item,item);return new_item});this.tpl=this.buildTpl(tpl.checklist)},events:{"click .checklist-item-btn":"itemClicked"},itemClicked:function(evt){var $item=$(evt.currentTarget).closest(".checklist-item");var idx=$item.attr("data-idx");this.trigger("itemClicked",idx)},render:function(){this.$el.html(this.tpl({items:this.items}));return this}});return ChecklistView});
define('view/OnboardingChecklist',["underscore","core/bb","tpl!new_onboarding","core/i18n","core/url","view/Checklist"],function(_,bb,tpl,i18nModule,urlModule,ChecklistView){var i18n=i18nModule.i18n;var absURL=urlModule.absURL;var OnboardingChecklistView=bb.BackboneView.extend({options:{merchant:null,step_dict:null,title:i18n(""),subtitle:null,btn_text:i18n(""),bottom_btn:true},urls:{1:null,2:null,3:absURL("request-confirmation-email"),4:absURL("request-confirmation-by-phone"),5:absURL("payment-settings"),6:absURL("add-products"),7:absURL("merchant/extra-info")},initialize:function(options){$.extend(true,this.options,options);this.merchant=this.options.merchant;this.step_dict=this.options.step_dict;this.tpl=this.buildTpl(tpl.checklist_view);this.completed=this.merchant.new_onboarding_steps_completed},events:{"click .onboarding-open-store-btn":"openStoreClicked"},itemClicked:function(idx){idx++},canOpenStore:function(){return this.merchant.new_onboarding_steps_completed.length===this.merchant.new_onboarding_steps_required.length},openStoreClicked:function(){if(this.canOpenStore()){window.location.href=absURL("brand-authorization/education")}},updateSteps:function(merchant_user){var completed=merchant_user.new_onboarding_steps_completed;var difference=_.difference(completed,this.completed);this.completed=completed;this.merchant=merchant_user;this.render();if(difference.length>0){var selectors=_.map(difference,_.bind(function(step){return'.checklist > .checklist-item[data-idx="'+(step-1)+'"]'},this));var selector=selectors.join(",");var $items=this.$(selector);$items.addClass("updated");window.setTimeout(function(){$items.removeClass("updated")},1e3)}},render:function(){var steps=_.pick(this.step_dict,this.merchant.new_onboarding_steps_required);var items=_.map(steps,_.bind(function(text,idx){var complete=_.contains(this.completed,parseInt(idx));return{text:text,complete:complete,url:this.urls[idx]}},this));var remaining_items=_.filter(items,function(item){return!item.complete});var tplContext={remaining_items:remaining_items};$.extend(tplContext,this.options);this.$el.html(this.tpl(tplContext));var checklist=new ChecklistView({el:this.$el.find(".onboarding-checklist-container"),items:items,title:this.options.title,subtitle:this.options.subtitle,btn_text:this.options.btn_text});checklist.on("itemClicked",_.bind(this.itemClicked,this));checklist.render();if(this.canOpenStore()){this.$(".onboarding-open-store-btn").removeClass("disabled")}return this}});return OnboardingChecklistView});
define('view/modal/OnboardingChecklist',["underscore","view/modal/BaseModal","tpl!modals/onboarding_checklist","core/i18n","view/OnboardingChecklist"],function(_,BaseModalView,tpl,i18nModule,OnboardingChecklistView){var i18n=i18nModule.i18n;var OnboardingChecklistModalView=BaseModalView.extend({options:{modal_title:i18n(""),title:null,bottom_btn:true},initialize:function(options){$.extend(true,this.options,options);this.tpl=this.buildTpl(tpl.modal)},events:{},updateSteps:function(merchant_user){this.checklist.updateSteps(merchant_user)},render:function(){this.modal_el=this.tpl(this.options);this.launchModal(this.modal_el);this.checklist=new OnboardingChecklistView(this.options);this.checklist.setElement(this.$el.find(".modal-body"));this.checklist.render();return this}});return OnboardingChecklistModalView});
define('base_page',["backbone","core/bb","core/api","domReady","lib/jquery.cookie","core/url","view/modal/OnboardingChecklist"],function(Backbone,bb,api,domReady,Cookie,urlModule,OnboardingChecklistModal){var error_logger_initialize=function(){window.onerror=function(errorMsg,url,lineNumber){var currTime=(new Date).getTime();var lastLogTime=$.cookie("last_error_log_time");if(lastLogTime&&currTime-lastLogTime<1e3){return}$.cookie("last_error_log_time",currTime);api.call("log-js-error",{error_msg:errorMsg,url:url,line_number:lineNumber})}};var log_client_pref=function(){if(window.performance&&window.performance.timing&&window.pageParams&&window.pageParams.monitor_key){var perf_data={};for(attribute in window.performance.timing){if(typeof window.performance.timing[attribute]=="number"){perf_data[attribute]=window.performance.timing[attribute]}}perf_data.uid=window.pageParams.monitor_key;api.call("client-perf",perf_data,function(){},function(){})}};var core_page_initialize=function(){var $subnav=$("#sub-header-nav");if($subnav.height()>41){var $page_content=$("#page-content");var top_margin=20+$subnav.height()-41+"px";$page_content.css("margin-top",top_margin)}};var init_onboarding=function(){var merchant=window.pageParams.merchant_user;if(merchant&&merchant.is_new_merchant_lead){var step_dict=window.pageParams.onboarding_step_dict;var modal=new OnboardingChecklistModal({merchant:merchant,step_dict:step_dict});var launch_onboarding_modal=function(){modal.render()};$(".btn-open-onboarding-checklist-modal").click(launch_onboarding_modal);$(document).on("refreshOnboardingChecklist",function(){api.call("merchant-user/get",{},function(resp){modal.render();modal.updateSteps(resp.data.merchant_user)})})}};var core_page_finish=function(){bb.startHistory();error_logger_initialize();log_client_pref();$("#page-content").tooltip({selector:"[rel=tooltip]"});remind_payment_settings();initalize_language_selector();initialize_su();$(window).scroll(function(){if($(window).width()<1024){$(".navbar").css({left:0-$(window).scrollLeft()+"px"})}else{$(".navbar").css({left:"0"})}});init_onboarding()};var initalize_language_selector=function(){$(".lang-sel").on("click",function(evt){var locale=$(evt.currentTarget).attr("data-lang");api.call("change-locale",{locale:locale},function(resp){window.location.reload()})})};var initialize_su=function(){loginAs=function(evt){var $el=$(evt.currentTarget);var bd_client=$el.attr("data-uid");api.call("login-as",{bd_client:bd_client},function(resp){window.location.href=urlModule.absURL("/")})};$(document).on("click",".login-as-button",loginAs)};var remind_payment_settings=function(){if($.cookie("require_payment_info")=="1"&&window.pageParams.current_step===undefined){$("#menu-account").popover({html:true,content:'<div class="info-popover">You have not setup your '+"payment settings, please tell us how you would like "+'to be paid.<br><a class="now">Do it now</a> '+'| <a class="later">Hide</a></div>',placement:"bottom",trigger:"manual"});$("#menu-account").popover("show");$("#menu-account, .info-popover .later").click(function(){$("#menu-account").popover("destroy");document.cookie="require_payment_info=;"+"expires=Thu, 01 Jan 1970 00:00:01 GMT;"});$(".info-popover .now").click(function(){window.location.href="/payment-settings";document.cookie="require_payment_info=;"+"expires=Thu, 01 Jan 1970 00:00:01 GMT;"})}};var on_dom_ready=function(init_function){domReady(function(){core_page_initialize();init_function();core_page_finish()})};return{onDomReady:on_dom_ready}});
Date.CultureInfo={name:"en-US",englishName:"English (United States)",nativeName:"English (United States)",dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbreviatedDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],shortestDayNames:["Su","Mo","Tu","We","Th","Fr","Sa"],firstLetterDayNames:["S","M","T","W","T","F","S"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],abbreviatedMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],amDesignator:"AM",pmDesignator:"PM",firstDayOfWeek:0,twoDigitYearMax:2029,dateElementOrder:"mdy",formatPatterns:{shortDate:"M/d/yyyy",longDate:"dddd, MMMM dd, yyyy",shortTime:"h:mm tt",longTime:"h:mm:ss tt",fullDateTime:"dddd, MMMM dd, yyyy h:mm:ss tt",sortableDateTime:"yyyy-MM-ddTHH:mm:ss",universalSortableDateTime:"yyyy-MM-dd HH:mm:ssZ",rfc1123:"ddd, dd MMM yyyy HH:mm:ss GMT",monthDay:"MMMM dd",yearMonth:"MMMM, yyyy"},regexPatterns:{jan:/^jan(uary)?/i,feb:/^feb(ruary)?/i,mar:/^mar(ch)?/i,apr:/^apr(il)?/i,may:/^may/i,jun:/^jun(e)?/i,jul:/^jul(y)?/i,aug:/^aug(ust)?/i,sep:/^sep(t(ember)?)?/i,oct:/^oct(ober)?/i,nov:/^nov(ember)?/i,dec:/^dec(ember)?/i,sun:/^su(n(day)?)?/i,mon:/^mo(n(day)?)?/i,tue:/^tu(e(s(day)?)?)?/i,wed:/^we(d(nesday)?)?/i,thu:/^th(u(r(s(day)?)?)?)?/i,fri:/^fr(i(day)?)?/i,sat:/^sa(t(urday)?)?/i,future:/^next/i,past:/^last|past|prev(ious)?/i,add:/^(\+|after|from)/i,subtract:/^(\-|before|ago)/i,yesterday:/^yesterday/i,today:/^t(oday)?/i,tomorrow:/^tomorrow/i,now:/^n(ow)?/i,millisecond:/^ms|milli(second)?s?/i,second:/^sec(ond)?s?/i,minute:/^min(ute)?s?/i,hour:/^h(ou)?rs?/i,week:/^w(ee)?k/i,month:/^m(o(nth)?s?)?/i,day:/^d(ays?)?/i,year:/^y((ea)?rs?)?/i,shortMeridian:/^(a|p)/i,longMeridian:/^(a\.?m?\.?|p\.?m?\.?)/i,timezone:/^((e(s|d)t|c(s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\s*(\+|\-)\s*\d\d\d\d?)|gmt)/i,ordinalSuffix:/^\s*(st|nd|rd|th)/i,timeContext:/^\s*(\:|a|p)/i},abbreviatedTimeZoneStandard:{GMT:"-000",EST:"-0400",CST:"-0500",MST:"-0600",PST:"-0700"},abbreviatedTimeZoneDST:{GMT:"-000",EDT:"-0500",CDT:"-0600",MDT:"-0700",PDT:"-0800"}};Date.getMonthNumberFromName=function(name){var n=Date.CultureInfo.monthNames,m=Date.CultureInfo.abbreviatedMonthNames,s=name.toLowerCase();for(var i=0;i<n.length;i++){if(n[i].toLowerCase()==s||m[i].toLowerCase()==s){return i}}return-1};Date.getDayNumberFromName=function(name){var n=Date.CultureInfo.dayNames,m=Date.CultureInfo.abbreviatedDayNames,o=Date.CultureInfo.shortestDayNames,s=name.toLowerCase();for(var i=0;i<n.length;i++){if(n[i].toLowerCase()==s||m[i].toLowerCase()==s){return i}}return-1};Date.isLeapYear=function(year){return year%4===0&&year%100!==0||year%400===0};Date.getDaysInMonth=function(year,month){return[31,Date.isLeapYear(year)?29:28,31,30,31,30,31,31,30,31,30,31][month]};Date.getTimezoneOffset=function(s,dst){return dst||false?Date.CultureInfo.abbreviatedTimeZoneDST[s.toUpperCase()]:Date.CultureInfo.abbreviatedTimeZoneStandard[s.toUpperCase()]};Date.getTimezoneAbbreviation=function(offset,dst){var n=dst||false?Date.CultureInfo.abbreviatedTimeZoneDST:Date.CultureInfo.abbreviatedTimeZoneStandard,p;for(p in n){if(n[p]===offset){return p}}return null};Date.prototype.clone=function(){return new Date(this.getTime())};Date.prototype.compareTo=function(date){if(isNaN(this)){throw new Error(this)}if(date instanceof Date&&!isNaN(date)){return this>date?1:this<date?-1:0}else{throw new TypeError(date)}};Date.prototype.equals=function(date){return this.compareTo(date)===0};Date.prototype.between=function(start,end){var t=this.getTime();return t>=start.getTime()&&t<=end.getTime()};Date.prototype.addMilliseconds=function(value){this.setMilliseconds(this.getMilliseconds()+value);return this};Date.prototype.addSeconds=function(value){return this.addMilliseconds(value*1e3)};Date.prototype.addMinutes=function(value){return this.addMilliseconds(value*6e4)};Date.prototype.addHours=function(value){return this.addMilliseconds(value*36e5)};Date.prototype.addDays=function(value){return this.addMilliseconds(value*864e5)};Date.prototype.addWeeks=function(value){return this.addMilliseconds(value*6048e5)};Date.prototype.addMonths=function(value){var n=this.getDate();this.setDate(1);this.setMonth(this.getMonth()+value);this.setDate(Math.min(n,this.getDaysInMonth()));return this};Date.prototype.addYears=function(value){return this.addMonths(value*12)};Date.prototype.add=function(config){if(typeof config=="number"){this._orient=config;return this}var x=config;if(x.millisecond||x.milliseconds){this.addMilliseconds(x.millisecond||x.milliseconds)}if(x.second||x.seconds){this.addSeconds(x.second||x.seconds)}if(x.minute||x.minutes){this.addMinutes(x.minute||x.minutes)}if(x.hour||x.hours){this.addHours(x.hour||x.hours)}if(x.month||x.months){this.addMonths(x.month||x.months)}if(x.year||x.years){this.addYears(x.year||x.years)}if(x.day||x.days){this.addDays(x.day||x.days)}return this};Date._validate=function(value,min,max,name){if(typeof value!="number"){throw new TypeError(value+" is not a Number.")}else if(value<min||value>max){throw new RangeError(value+" is not a valid value for "+name+".")}return true};Date.validateMillisecond=function(n){return Date._validate(n,0,999,"milliseconds")};Date.validateSecond=function(n){return Date._validate(n,0,59,"seconds")};Date.validateMinute=function(n){return Date._validate(n,0,59,"minutes")};Date.validateHour=function(n){return Date._validate(n,0,23,"hours")};Date.validateDay=function(n,year,month){return Date._validate(n,1,Date.getDaysInMonth(year,month),"days")};Date.validateMonth=function(n){return Date._validate(n,0,11,"months")};Date.validateYear=function(n){return Date._validate(n,1,9999,"seconds")};Date.prototype.set=function(config){var x=config;if(!x.millisecond&&x.millisecond!==0){x.millisecond=-1}if(!x.second&&x.second!==0){x.second=-1}if(!x.minute&&x.minute!==0){x.minute=-1}if(!x.hour&&x.hour!==0){x.hour=-1}if(!x.day&&x.day!==0){x.day=-1}if(!x.month&&x.month!==0){x.month=-1}if(!x.year&&x.year!==0){x.year=-1}if(x.millisecond!=-1&&Date.validateMillisecond(x.millisecond)){this.addMilliseconds(x.millisecond-this.getMilliseconds())}if(x.second!=-1&&Date.validateSecond(x.second)){this.addSeconds(x.second-this.getSeconds())}if(x.minute!=-1&&Date.validateMinute(x.minute)){this.addMinutes(x.minute-this.getMinutes())}if(x.hour!=-1&&Date.validateHour(x.hour)){this.addHours(x.hour-this.getHours())}if(x.month!==-1&&Date.validateMonth(x.month)){this.addMonths(x.month-this.getMonth())}if(x.year!=-1&&Date.validateYear(x.year)){this.addYears(x.year-this.getFullYear())}if(x.day!=-1&&Date.validateDay(x.day,this.getFullYear(),this.getMonth())){this.addDays(x.day-this.getDate())}if(x.timezone){this.setTimezone(x.timezone)}if(x.timezoneOffset){this.setTimezoneOffset(x.timezoneOffset)}return this};Date.prototype.clearTime=function(){this.setHours(0);this.setMinutes(0);this.setSeconds(0);this.setMilliseconds(0);return this};Date.prototype.isLeapYear=function(){var y=this.getFullYear();return y%4===0&&y%100!==0||y%400===0};Date.prototype.isWeekday=function(){return!(this.is().sat()||this.is().sun())};Date.prototype.getDaysInMonth=function(){return Date.getDaysInMonth(this.getFullYear(),this.getMonth())};Date.prototype.moveToFirstDayOfMonth=function(){return this.set({day:1})};Date.prototype.moveToLastDayOfMonth=function(){return this.set({day:this.getDaysInMonth()})};Date.prototype.moveToDayOfWeek=function(day,orient){var diff=(day-this.getDay()+7*(orient||+1))%7;return this.addDays(diff===0?diff+=7*(orient||+1):diff)};Date.prototype.moveToMonth=function(month,orient){var diff=(month-this.getMonth()+12*(orient||+1))%12;return this.addMonths(diff===0?diff+=12*(orient||+1):diff)};Date.prototype.getDayOfYear=function(){return Math.floor((this-new Date(this.getFullYear(),0,1))/864e5)};Date.prototype.getWeekOfYear=function(firstDayOfWeek){var y=this.getFullYear(),m=this.getMonth(),d=this.getDate();var dow=firstDayOfWeek||Date.CultureInfo.firstDayOfWeek;var offset=7+1-new Date(y,0,1).getDay();if(offset==8){offset=1}var daynum=(Date.UTC(y,m,d,0,0,0)-Date.UTC(y,0,1,0,0,0))/864e5+1;var w=Math.floor((daynum-offset+7)/7);if(w===dow){y--;var prevOffset=7+1-new Date(y,0,1).getDay();if(prevOffset==2||prevOffset==8){w=53}else{w=52}}return w};Date.prototype.isDST=function(){console.log("isDST");return this.toString().match(/(E|C|M|P)(S|D)T/)[2]=="D"};Date.prototype.getTimezone=function(){return Date.getTimezoneAbbreviation(this.getUTCOffset,this.isDST())};Date.prototype.setTimezoneOffset=function(s){var here=this.getTimezoneOffset(),there=Number(s)*-6/10;this.addMinutes(there-here);return this};Date.prototype.setTimezone=function(s){return this.setTimezoneOffset(Date.getTimezoneOffset(s))};Date.prototype.getUTCOffset=function(){var n=this.getTimezoneOffset()*-10/6,r;if(n<0){r=(n-1e4).toString();return r[0]+r.substr(2)}else{r=(n+1e4).toString();return"+"+r.substr(1)}};Date.prototype.getDayName=function(abbrev){return abbrev?Date.CultureInfo.abbreviatedDayNames[this.getDay()]:Date.CultureInfo.dayNames[this.getDay()]};Date.prototype.getMonthName=function(abbrev){return abbrev?Date.CultureInfo.abbreviatedMonthNames[this.getMonth()]:Date.CultureInfo.monthNames[this.getMonth()]};Date.prototype._toString=Date.prototype.toString;Date.prototype.toString=function(format){var self=this;var p=function p(s){return s.toString().length==1?"0"+s:s};return format?format.replace(/dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?/g,function(format){switch(format){case"hh":var hours=self.getHours();if(hours>12){hours-=12}else if(hours==0){hours=12}return p(hours);case"h":var hours=self.getHours();if(hours>12){hours-=12}else if(hours==0){hours=12}return hours;case"HH":return p(self.getHours());case"H":return self.getHours();case"mm":return p(self.getMinutes());case"m":return self.getMinutes();case"ss":return p(self.getSeconds());case"s":return self.getSeconds();case"yyyy":return self.getFullYear();case"yy":return self.getFullYear().toString().substring(2,4);case"dddd":return self.getDayName();case"ddd":return self.getDayName(true);case"dd":return p(self.getDate());case"d":return self.getDate().toString();case"MMMM":return self.getMonthName();case"MMM":return self.getMonthName(true);case"MM":return p(self.getMonth()+1);case"M":return self.getMonth()+1;case"t":return self.getHours()<12?Date.CultureInfo.amDesignator.substring(0,1):Date.CultureInfo.pmDesignator.substring(0,1);case"tt":return self.getHours()<12?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator;case"zzz":case"zz":case"z":return""}}):this._toString()};Date.now=function(){return new Date};Date.today=function(){return Date.now().clearTime()};Date.prototype._orient=+1;Date.prototype.next=function(){this._orient=+1;return this};Date.prototype.last=Date.prototype.prev=Date.prototype.previous=function(){this._orient=-1;return this};Date.prototype._is=false;Date.prototype.is=function(){this._is=true;return this};Number.prototype._dateElement="day";Number.prototype.fromNow=function(){var c={};c[this._dateElement]=this;return Date.now().add(c)};Number.prototype.ago=function(){var c={};c[this._dateElement]=this*-1;return Date.now().add(c)};(function(){var $D=Date.prototype,$N=Number.prototype;var dx="sunday monday tuesday wednesday thursday friday saturday".split(/\s/),mx="january february march april may june july august september october november december".split(/\s/),px="Millisecond Second Minute Hour Day Week Month Year".split(/\s/),de;var df=function(n){return function(){if(this._is){this._is=false;return this.getDay()==n}return this.moveToDayOfWeek(n,this._orient)}};for(var i=0;i<dx.length;i++){$D[dx[i]]=$D[dx[i].substring(0,3)]=df(i)}var mf=function(n){return function(){if(this._is){this._is=false;return this.getMonth()===n}return this.moveToMonth(n,this._orient)}};for(var j=0;j<mx.length;j++){$D[mx[j]]=$D[mx[j].substring(0,3)]=mf(j)}var ef=function(j){return function(){if(j.substring(j.length-1)!="s"){j+="s"}return this["add"+j](this._orient)}};var nf=function(n){return function(){this._dateElement=n;return this}};for(var k=0;k<px.length;k++){de=px[k].toLowerCase();$D[de]=$D[de+"s"]=ef(px[k]);$N[de]=$N[de+"s"]=nf(de)}})();Date.prototype.toJSONString=function(){return this.toString("yyyy-MM-ddThh:mm:ssZ")};Date.prototype.toShortDateString=function(){return this.toString(Date.CultureInfo.formatPatterns.shortDatePattern)};Date.prototype.toLongDateString=function(){return this.toString(Date.CultureInfo.formatPatterns.longDatePattern)};Date.prototype.toShortTimeString=function(){return this.toString(Date.CultureInfo.formatPatterns.shortTimePattern)};Date.prototype.toLongTimeString=function(){return this.toString(Date.CultureInfo.formatPatterns.longTimePattern)};Date.prototype.getOrdinal=function(){switch(this.getDate()){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}};(function(){Date.Parsing={Exception:function(s){this.message="Parse error at '"+s.substring(0,10)+" ...'"}};var $P=Date.Parsing;var _=$P.Operators={rtoken:function(r){return function(s){var mx=s.match(r);if(mx){return[mx[0],s.substring(mx[0].length)]}else{throw new $P.Exception(s)}}},token:function(s){return function(s){return _.rtoken(new RegExp("^s*"+s+"s*"))(s)}},stoken:function(s){return _.rtoken(new RegExp("^"+s))},until:function(p){return function(s){var qx=[],rx=null;while(s.length){try{rx=p.call(this,s)}catch(e){qx.push(rx[0]);s=rx[1];continue}break}return[qx,s]}},many:function(p){return function(s){var rx=[],r=null;while(s.length){try{r=p.call(this,s)}catch(e){return[rx,s]}rx.push(r[0]);s=r[1]}return[rx,s]}},optional:function(p){return function(s){var r=null;try{r=p.call(this,s)}catch(e){return[null,s]}return[r[0],r[1]]}},not:function(p){return function(s){try{p.call(this,s)}catch(e){return[null,s]}throw new $P.Exception(s)}},ignore:function(p){return p?function(s){var r=null;r=p.call(this,s);return[null,r[1]]}:null},product:function(){var px=arguments[0],qx=Array.prototype.slice.call(arguments,1),rx=[];for(var i=0;i<px.length;i++){rx.push(_.each(px[i],qx))}return rx},cache:function(rule){var cache={},r=null;return function(s){try{r=cache[s]=cache[s]||rule.call(this,s)}catch(e){r=cache[s]=e}if(r instanceof $P.Exception){throw r}else{return r}}},any:function(){var px=arguments;return function(s){var r=null;for(var i=0;i<px.length;i++){if(px[i]==null){continue}try{r=px[i].call(this,s)}catch(e){r=null}if(r){return r}}throw new $P.Exception(s)}},each:function(){var px=arguments;return function(s){var rx=[],r=null;for(var i=0;i<px.length;i++){if(px[i]==null){continue}try{r=px[i].call(this,s)}catch(e){throw new $P.Exception(s)}rx.push(r[0]);s=r[1]}return[rx,s]}},all:function(){var px=arguments,_=_;return _.each(_.optional(px))},sequence:function(px,d,c){d=d||_.rtoken(/^\s*/);c=c||null;if(px.length==1){return px[0]}return function(s){var r=null,q=null;var rx=[];for(var i=0;i<px.length;i++){try{r=px[i].call(this,s)}catch(e){break}rx.push(r[0]);try{q=d.call(this,r[1])}catch(ex){q=null;break}s=q[1]}if(!r){throw new $P.Exception(s)}if(q){throw new $P.Exception(q[1])}if(c){try{r=c.call(this,r[1])}catch(ey){throw new $P.Exception(r[1])}}return[rx,r?r[1]:s]}},between:function(d1,p,d2){d2=d2||d1;var _fn=_.each(_.ignore(d1),p,_.ignore(d2));return function(s){var rx=_fn.call(this,s);return[[rx[0][0],r[0][2]],rx[1]]}},list:function(p,d,c){d=d||_.rtoken(/^\s*/);c=c||null;return p instanceof Array?_.each(_.product(p.slice(0,-1),_.ignore(d)),p.slice(-1),_.ignore(c)):_.each(_.many(_.each(p,_.ignore(d))),px,_.ignore(c))},set:function(px,d,c){d=d||_.rtoken(/^\s*/);c=c||null;return function(s){var r=null,p=null,q=null,rx=null,best=[[],s],last=false;for(var i=0;i<px.length;i++){q=null;p=null;r=null;last=px.length==1;try{r=px[i].call(this,s)}catch(e){continue}rx=[[r[0]],r[1]];if(r[1].length>0&&!last){try{q=d.call(this,r[1])}catch(ex){last=true}}else{last=true}if(!last&&q[1].length===0){last=true}if(!last){var qx=[];for(var j=0;j<px.length;j++){if(i!=j){qx.push(px[j])}}p=_.set(qx,d).call(this,q[1]);if(p[0].length>0){rx[0]=rx[0].concat(p[0]);rx[1]=p[1]}}if(rx[1].length<best[1].length){best=rx}if(best[1].length===0){break}}if(best[0].length===0){return best}if(c){try{q=c.call(this,best[1])}catch(ey){throw new $P.Exception(best[1])}best[1]=q[1]}return best}},forward:function(gr,fname){return function(s){return gr[fname].call(this,s)}},replace:function(rule,repl){return function(s){var r=rule.call(this,s);return[repl,r[1]]}},process:function(rule,fn){return function(s){var r=rule.call(this,s);return[fn.call(this,r[0]),r[1]]}},min:function(min,rule){return function(s){var rx=rule.call(this,s);if(rx[0].length<min){throw new $P.Exception(s)}return rx}}};var _generator=function(op){return function(){var args=null,rx=[];if(arguments.length>1){args=Array.prototype.slice.call(arguments)}else if(arguments[0]instanceof Array){args=arguments[0]}if(args){for(var i=0,px=args.shift();i<px.length;i++){args.unshift(px[i]);rx.push(op.apply(null,args));args.shift();return rx}}else{return op.apply(null,arguments)}}};var gx="optional not ignore cache".split(/\s/);for(var i=0;i<gx.length;i++){_[gx[i]]=_generator(_[gx[i]])}var _vector=function(op){return function(){if(arguments[0]instanceof Array){return op.apply(null,arguments[0])}else{return op.apply(null,arguments)}}};var vx="each any all".split(/\s/);for(var j=0;j<vx.length;j++){_[vx[j]]=_vector(_[vx[j]])}})();(function(){var flattenAndCompact=function(ax){var rx=[];for(var i=0;i<ax.length;i++){if(ax[i]instanceof Array){rx=rx.concat(flattenAndCompact(ax[i]))}else{if(ax[i]){rx.push(ax[i])}}}return rx};Date.Grammar={};Date.Translator={hour:function(s){return function(){this.hour=Number(s)}},minute:function(s){return function(){this.minute=Number(s)}},second:function(s){return function(){this.second=Number(s)}},meridian:function(s){return function(){this.meridian=s.slice(0,1).toLowerCase()}},timezone:function(s){return function(){var n=s.replace(/[^\d\+\-]/g,"");if(n.length){this.timezoneOffset=Number(n)}else{this.timezone=s.toLowerCase()}}},day:function(x){var s=x[0];return function(){this.day=Number(s.match(/\d+/)[0])}},month:function(s){return function(){this.month=s.length==3?Date.getMonthNumberFromName(s):Number(s)-1}},year:function(s){return function(){var n=Number(s);this.year=s.length>2?n:n+(n+2e3<Date.CultureInfo.twoDigitYearMax?2e3:1900)}},rday:function(s){return function(){switch(s){case"yesterday":this.days=-1;break;case"tomorrow":this.days=1;break;case"today":this.days=0;break;case"now":this.days=0;this.now=true;break}}},finishExact:function(x){x=x instanceof Array?x:[x];var now=new Date;this.year=now.getFullYear();this.month=now.getMonth();this.day=1;this.hour=0;this.minute=0;this.second=0;for(var i=0;i<x.length;i++){if(x[i]){x[i].call(this)}}this.hour=this.meridian=="p"&&this.hour<13?this.hour+12:this.hour;if(this.day>Date.getDaysInMonth(this.year,this.month)){throw new RangeError(this.day+" is not a valid value for days.")}var r=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second);if(this.timezone){r.set({timezone:this.timezone})}else if(this.timezoneOffset){r.set({timezoneOffset:this.timezoneOffset})}return r},finish:function(x){x=x instanceof Array?flattenAndCompact(x):[x];if(x.length===0){return null}for(var i=0;i<x.length;i++){if(typeof x[i]=="function"){x[i].call(this)}}if(this.now){return new Date}var today=Date.today();var method=null;var expression=!!(this.days!=null||this.orient||this.operator);if(expression){var gap,mod,orient;orient=this.orient=="past"||this.operator=="subtract"?-1:1;if(this.weekday){this.unit="day";gap=Date.getDayNumberFromName(this.weekday)-today.getDay();mod=7;this.days=gap?(gap+orient*mod)%mod:orient*mod}if(this.month){this.unit="month";gap=this.month-today.getMonth();mod=12;this.months=gap?(gap+orient*mod)%mod:orient*mod;this.month=null}if(!this.unit){this.unit="day"}if(this[this.unit+"s"]==null||this.operator!=null){if(!this.value){this.value=1}if(this.unit=="week"){this.unit="day";this.value=this.value*7}this[this.unit+"s"]=this.value*orient}return today.add(this)}else{if(this.meridian&&this.hour){this.hour=this.hour<13&&this.meridian=="p"?this.hour+12:this.hour}if(this.weekday&&!this.day){this.day=today.addDays(Date.getDayNumberFromName(this.weekday)-today.getDay()).getDate()}if(this.month&&!this.day){this.day=1}return today.set(this)}}};var _=Date.Parsing.Operators,g=Date.Grammar,t=Date.Translator,_fn;g.datePartDelimiter=_.rtoken(/^([\s\-\.\,\/\x27]+)/);g.timePartDelimiter=_.stoken(":");g.whiteSpace=_.rtoken(/^\s*/);g.generalDelimiter=_.rtoken(/^(([\s\,]|at|on)+)/);var _C={};g.ctoken=function(keys){var fn=_C[keys];if(!fn){var c=Date.CultureInfo.regexPatterns;var kx=keys.split(/\s+/),px=[];for(var i=0;i<kx.length;i++){px.push(_.replace(_.rtoken(c[kx[i]]),kx[i]))}fn=_C[keys]=_.any.apply(null,px)}return fn};g.ctoken2=function(key){return _.rtoken(Date.CultureInfo.regexPatterns[key])};g.h=_.cache(_.process(_.rtoken(/^(0[0-9]|1[0-2]|[1-9])/),t.hour));g.hh=_.cache(_.process(_.rtoken(/^(0[0-9]|1[0-2])/),t.hour));g.H=_.cache(_.process(_.rtoken(/^([0-1][0-9]|2[0-3]|[0-9])/),t.hour));g.HH=_.cache(_.process(_.rtoken(/^([0-1][0-9]|2[0-3])/),t.hour));g.m=_.cache(_.process(_.rtoken(/^([0-5][0-9]|[0-9])/),t.minute));g.mm=_.cache(_.process(_.rtoken(/^[0-5][0-9]/),t.minute));g.s=_.cache(_.process(_.rtoken(/^([0-5][0-9]|[0-9])/),t.second));g.ss=_.cache(_.process(_.rtoken(/^[0-5][0-9]/),t.second));g.hms=_.cache(_.sequence([g.H,g.mm,g.ss],g.timePartDelimiter));g.t=_.cache(_.process(g.ctoken2("shortMeridian"),t.meridian));g.tt=_.cache(_.process(g.ctoken2("longMeridian"),t.meridian));g.z=_.cache(_.process(_.rtoken(/^(\+|\-)?\s*\d\d\d\d?/),t.timezone));g.zz=_.cache(_.process(_.rtoken(/^(\+|\-)\s*\d\d\d\d/),t.timezone));g.zzz=_.cache(_.process(g.ctoken2("timezone"),t.timezone));g.timeSuffix=_.each(_.ignore(g.whiteSpace),_.set([g.tt,g.zzz]));g.time=_.each(_.optional(_.ignore(_.stoken("T"))),g.hms,g.timeSuffix);g.d=_.cache(_.process(_.each(_.rtoken(/^([0-2]\d|3[0-1]|\d)/),_.optional(g.ctoken2("ordinalSuffix"))),t.day));g.dd=_.cache(_.process(_.each(_.rtoken(/^([0-2]\d|3[0-1])/),_.optional(g.ctoken2("ordinalSuffix"))),t.day));g.ddd=g.dddd=_.cache(_.process(g.ctoken("sun mon tue wed thu fri sat"),function(s){return function(){this.weekday=s}}));g.M=_.cache(_.process(_.rtoken(/^(1[0-2]|0\d|\d)/),t.month));g.MM=_.cache(_.process(_.rtoken(/^(1[0-2]|0\d)/),t.month));g.MMM=g.MMMM=_.cache(_.process(g.ctoken("jan feb mar apr may jun jul aug sep oct nov dec"),t.month));g.y=_.cache(_.process(_.rtoken(/^(\d\d?)/),t.year));g.yy=_.cache(_.process(_.rtoken(/^(\d\d)/),t.year));g.yyy=_.cache(_.process(_.rtoken(/^(\d\d?\d?\d?)/),t.year));g.yyyy=_.cache(_.process(_.rtoken(/^(\d\d\d\d)/),t.year));_fn=function(){return _.each(_.any.apply(null,arguments),_.not(g.ctoken2("timeContext")))};g.day=_fn(g.d,g.dd);g.month=_fn(g.M,g.MMM);g.year=_fn(g.yyyy,g.yy);g.orientation=_.process(g.ctoken("past future"),function(s){return function(){this.orient=s}});g.operator=_.process(g.ctoken("add subtract"),function(s){return function(){this.operator=s}});g.rday=_.process(g.ctoken("yesterday tomorrow today now"),t.rday);g.unit=_.process(g.ctoken("minute hour day week month year"),function(s){return function(){this.unit=s}});g.value=_.process(_.rtoken(/^\d\d?(st|nd|rd|th)?/),function(s){return function(){this.value=s.replace(/\D/g,"")}});g.expression=_.set([g.rday,g.operator,g.value,g.unit,g.orientation,g.ddd,g.MMM]);_fn=function(){return _.set(arguments,g.datePartDelimiter)};g.mdy=_fn(g.ddd,g.month,g.day,g.year);g.ymd=_fn(g.ddd,g.year,g.month,g.day);g.dmy=_fn(g.ddd,g.day,g.month,g.year);g.date=function(s){return(g[Date.CultureInfo.dateElementOrder]||g.mdy).call(this,s)};g.format=_.process(_.many(_.any(_.process(_.rtoken(/^(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?)/),function(fmt){if(g[fmt]){return g[fmt]}else{throw Date.Parsing.Exception(fmt)}}),_.process(_.rtoken(/^[^dMyhHmstz]+/),function(s){return _.ignore(_.stoken(s))}))),function(rules){return _.process(_.each.apply(null,rules),t.finishExact)});var _F={};var _get=function(f){return _F[f]=_F[f]||g.format(f)[0]};g.formats=function(fx){if(fx instanceof Array){var rx=[];for(var i=0;i<fx.length;i++){rx.push(_get(fx[i]))}return _.any.apply(null,rx)}else{return _get(fx)}};g._formats=g.formats(["yyyy-MM-ddTHH:mm:ss","ddd, MMM dd, yyyy H:mm:ss tt","ddd MMM d yyyy HH:mm:ss zzz","d"]);g._start=_.process(_.set([g.date,g.time,g.expression],g.generalDelimiter,g.whiteSpace),t.finish);g.start=function(s){try{var r=g._formats.call({},s);if(r[1].length===0){return r}}catch(e){}return g._start.call({},s)}})();Date._parse=Date.parse;Date.parse=function(s){var r=null;if(!s){return null}try{r=Date.Grammar.start.call({},s)}catch(e){return null}return r[1].length===0?r[0]:null};Date.getParseFunction=function(fx){var fn=Date.Grammar.formats(fx);return function(s){var r=null;try{r=fn.call({},s)}catch(e){return null}return r[1].length===0?r[0]:null}};Date.parseExact=function(s,fx){return Date.getParseFunction(fx)(s)};
define("lib/date", function(){});

define('tpl!modals/release_note', function() {return {"release_note":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class="release-note-modal modal hide fade"> <div class="modal-header"> <button type="button" class="show-on-delay disabled close" aria-hidden="true">&times;</button> <h3>'+((__t=(ni18n(release_note['features'].length, "", "")))==null?'':_.escape(__t))+'</h3> </div> <div class="modal-body"> '; _.each(release_note['features'], function(feature) { __p+=' <div class="feature"> <div class="feature-title"> '+((__t=(feature['title']))==null?'':_.escape(__t))+' </div> <div class="feature-body"> '; _.each(feature['body'].split("\n"), function(paragraph) { __p+=' <span>'+((__t=(paragraph))==null?'':_.escape(__t))+'</span><br /> '; }); __p+=' </div> '; if (feature['link']) { __p+=' <a class="btn" href="'+((__t=(feature['link']))==null?'':_.escape(__t))+'" target="_blank"> '+((__t=(i18n("")))==null?'':_.escape(__t))+' </a> '; } __p+=' </div> '; }); __p+=' </div> <div class="modal-footer"> <button disabled class="show-on-delay btn">'+((__t=(i18n("")))==null?'':_.escape(__t))+'</button> </div> </div> ';}return __p;}};});

define('view/modal/ReleaseNotesModal',["underscore","core/bb","core/api","view/modal/BaseModal","tpl!modals/release_note"],function(_,bb,api,BaseModalView,tpl){var ReleaseNotesModalView=BaseModalView.extend({initialize:function(options){this.release=options.release;this.template=this.buildTpl(tpl.release_note)},render:function(){var view_el=this.template({release_note:this.release});view_el=view_el.replace(/\{\{(.*?)\|(.*?)\}\}/g,'<a target="_blank" href="$2">$1</a>');this.launchModal(view_el);window.setTimeout(_.bind(this.showCloseButtons,this),2e3);return this},showCloseButtons:function(){this.$(".show-on-delay").attr("data-dismiss","modal").attr("disabled",null)}});return ReleaseNotesModalView});
define('tpl!modals/announcement_modal', function() {return {"announcement":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class="announcement-modal modal hide fade"> <div class="modal-header"> <button type="button" class="show-on-delay disabled close" aria-hidden="true">&times;</button> <h3>'+((__t=(announcement['title']))==null?'':_.escape(__t))+'</h3> </div> <div class="modal-body"> '; _.each(announcement['message'].split("\n"), function (line) { __p+=' '+((__t=(line))==null?'':_.escape(__t))+'<br> '; }); __p+=' </div> <div class="modal-footer"> <button disabled class="show-on-delay btn">'+((__t=(i18n("")))==null?'':_.escape(__t))+'</button> </div> </div>';}return __p;}};});

define('view/modal/AnnouncementModal',["underscore","core/bb","core/api","view/modal/BaseModal","tpl!modals/announcement_modal"],function(_,bb,api,BaseModalView,tpl){var AnnouncementModalView=BaseModalView.extend({initialize:function(options){this.announcement=options.announcement;this.template=this.buildTpl(tpl.announcement)},render_delay:function(){var view_el=this.template({announcement:this.announcement});this.launchModal(view_el);window.setTimeout(_.bind(this.showCloseButtons,this),2e3);return this},render:function(){var view_el=this.template({announcement:this.announcement});this.launchModal(view_el);window.setTimeout(_.bind(this.showCloseButtons,this),0);return this},showCloseButtons:function(){this.$(".show-on-delay").attr("data-dismiss","modal").attr("disabled",null)}});return AnnouncementModalView});
define('tpl!modals/merchant_extra_info', function() {return {"modal":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class="modal hide fade" id="extra-info-modal"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button> <h3> '; if(merchant_user.missing_extra_info){ __p+=' '+((__t=(i18n("")))==null?'':_.escape(__t))+' '; } else { __p+=' '+((__t=(i18n("")))==null?'':_.escape(__t))+' '; } __p+=' </h3> </div> <div class=\'modal-body\'></div> <div class=\'modal-footer\'> <div class="pull-right"> <button data-dismiss="modal" type="button" class="btn">'+((__t=(i18n("")))==null?'':_.escape(__t))+'</button> <button type="button" class="btn-primary btn btn-save">'+((__t=(i18n("")))==null?'':_.escape(__t))+'</button> </div> </div> </div> ';}return __p;}};});

define('tpl!merchant_extra_info', function() {return {"main":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div id="extra-info-form"> <div class="form-horizontal form-section"> <div class="control-group"> <label class="control-label" for="entity"> '+((__t=(i18n("")))==null?'':_.escape(__t))+' </label> <div class="controls"> <label for="entity-individual"> <input name="entity" id="entity-individual" type="radio" value="1"> '+((__t=(i18n("")))==null?'':_.escape(__t))+' </label> <label for="entity-company"> <input name="entity" id="entity-company" type="radio" value="2"> '+((__t=(i18n("")))==null?'':_.escape(__t))+' </label> </div> </div> <div class="control-group"> <label class="control-label" for="qq_number"> '+((__t=(i18n("QQ ")))==null?'':_.escape(__t))+' <i data-content="'+((__t=(i18n("QQ")))==null?'':_.escape(__t))+'" class="popover-hover icon-question-sign"></i> </label> <div class="controls"> <input type="text" id="qq_number" name="qq_number" class="input-block-level"> </div> </div> <div class="company-details hide"> '; if(!(merchant_user.missing_extra_info)){ __p+=' <div class="control-group"> <label class="control-label" for="annual_gmv"> '+((__t=(i18n(" GMV ")))==null?'':_.escape(__t))+' <i data-content="'+((__t=(i18n("")))==null?'':_.escape(__t))+'" class="popover-hover icon-question-sign"></i> </label> <div class="controls"> <input type="number" id="annual_gmv" class="input-block-level" step="0.01" name="annual_gmv"> </div> </div> '; } __p+=' <div class="control-group"> <label class="control-label" for="business_license"> '+((__t=(i18n("")))==null?'':_.escape(__t))+' <i data-content="'+((__t=(i18n("")))==null?'':_.escape(__t))+'" class="popover-hover icon-question-sign"></i> </label> <div class="controls"> <div name="business_license"></div> </div> </div> <div class="control-group"> <label class="control-label" for="company_name"> '+((__t=(i18n("")))==null?'':_.escape(__t))+' <i data-content="'+((__t=(i18n("")))==null?'':_.escape(__t))+'" class="popover-hover icon-question-sign"></i> </label> <div class="controls"> <input type="text" id="company_name" name="company_name" class="input-block-level"> <div class="text-error"> '+((__t=(i18n("")))==null?'':_.escape(__t))+' </div> </div> </div> <div class="control-group"> <label class="control-label" for="business_license_id"> '+((__t=(i18n("")))==null?'':_.escape(__t))+' <i data-content="'+((__t=(i18n("")))==null?'':_.escape(__t))+'" class="popover-hover icon-question-sign"></i> </label> <div class="controls"> <input type="text" id="business_license_id" name="business_license_id" class="input-block-level"> <div class="text-error"> '+((__t=(i18n("")))==null?'':_.escape(__t))+' </div> </div> </div> <div class="control-group"> <label class="control-label" for="tax_certificate"> '+((__t=(i18n("")))==null?'':_.escape(__t))+' <i data-content="'+((__t=(i18n("")))==null?'':_.escape(__t))+'" class="popover-hover icon-question-sign"></i> </label> <div class="controls"> <div name="tax_certificate"></div> </div> </div> <div class="control-group"> <label class="control-label" for="company_photo_id"> '+((__t=(i18n("")))==null?'':_.escape(__t))+' <i data-content="'+((__t=(i18n("")))==null?'':_.escape(__t))+'" class="popover-hover icon-question-sign"></i> </label> <div class="controls"> <div name="company_photo_id"></div> </div> </div> <div class="control-group"> <label class="control-label" for="representative_name"> '+((__t=(i18n("")))==null?'':_.escape(__t))+' <i data-content="'+((__t=(i18n("")))==null?'':_.escape(__t))+'" class="popover-hover icon-question-sign"></i> </label> <div class="controls"> <input type="text" id="representative_name" name="representative_name" class="input-block-level"> <div class="text-error"> '+((__t=(i18n("")))==null?'':_.escape(__t))+' </div> </div> </div> <div class="control-group"> <label class="control-label" for="representative_id_number"> '+((__t=(i18n("")))==null?'':_.escape(__t))+' <i data-content="'+((__t=(i18n("")))==null?'':_.escape(__t))+'" class="popover-hover icon-question-sign"></i> </label> <div class="controls"> <input type="text" id="representative_id_number" name="representative_id_number" class="input-block-level"> <div class="text-error"> '+((__t=(i18n("")))==null?'':_.escape(__t))+' </div> </div> </div> </div> <div class="individual-details hide"> <div class="control-group"> <label class="control-label" for="individual_photo_id"> '+((__t=(i18n("")))==null?'':_.escape(__t))+' <i data-content="'+((__t=(i18n("")))==null?'':_.escape(__t))+'" class="popover-hover icon-question-sign"></i> </label> <div class="controls"> <div name="individual_photo_id"></div> </div> </div> <div class="control-group"> <label class="control-label" for="individual_name"> '+((__t=(i18n("/")))==null?'':_.escape(__t))+' <i data-content="'+((__t=(i18n("")))==null?'':_.escape(__t))+'" class="popover-hover icon-question-sign"></i> </label> <div class="controls"> <input type="text" id="individual_name" name="individual_name" class="input-block-level"> <div class="text-error"> '+((__t=(i18n("")))==null?'':_.escape(__t))+' </div> </div> </div> <div class="control-group"> <label class="control-label" for="individual_id_number"> '+((__t=(i18n("")))==null?'':_.escape(__t))+' <i data-content="'+((__t=(i18n("")))==null?'':_.escape(__t))+'" class="popover-hover icon-question-sign"></i> </label> <div class="controls"> <input type="text" id="individual_id_number" name="individual_id_number" class="input-block-level"> <div class="text-error"> '+((__t=(i18n("")))==null?'':_.escape(__t))+' </div> </div> </div> </div> </div> </div> ';}return __p;}};});

define('tpl!upload_file', function() {return {"upload_file":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class="file-upload-container"> <div> <a href="#" class="btn fake-file-upload">Select a File</a> <p class="drag-drop-prompt">Or drag a file here</p> <p class="file-display-input no-file-selected">No file selected</p> <span class="loading-spinner hide"></span> </div> <div style="clear:both;"></div> <form class="hide"> <input maxlength="10000000000" class="real-file-upload hide" name="doc-file-upload" type="file" accept=".jpg,.jpeg,.gif,.png,.pdf,.xls,.xlsx,.doc,.docx" /> </form> <div id="add-file-error" class="alert alert-error hide"></div> </div> ';}return __p;},"upload_file_prompt_new_file":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div id="prompt-new-file" class="hide"> <button class="btn add-file">Add Additional Files </button></div> ';}return __p;},"upload_file_dropzone":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div id="file-dropzone" class="dropzone"></div> <div id="add-file-error" class="alert alert-error hide"></div> ';}return __p;}};});

define('core/dom_utils',[],function(){function val(el){return $.trim($(el).hasClass("watermark")?"":$(el).val())}return{val:val}});
(function($){$.fn.ajaxSubmit=function(options){if(!this.length){log("ajaxSubmit: skipping submit process - no element selected");return this}var method,action,url,$form=this;if(typeof options=="function"){options={success:options}}method=this.attr("method");action=this.attr("action");url=typeof action==="string"?$.trim(action):"";url=url||window.location.href||"";if(url){url=(url.match(/^([^#]+)/)||[])[1]}options=$.extend(true,{url:url,success:$.ajaxSettings.success,type:method||"GET",iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},options);var veto={};this.trigger("form-pre-serialize",[this,options,veto]);if(veto.veto){log("ajaxSubmit: submit vetoed via form-pre-serialize trigger");return this}if(options.beforeSerialize&&options.beforeSerialize(this,options)===false){log("ajaxSubmit: submit aborted via beforeSerialize callback");return this}var traditional=options.traditional;if(traditional===undefined){traditional=$.ajaxSettings.traditional}var qx,n,v,a=this.formToArray(options.semantic);if(options.data){options.extraData=options.data;qx=$.param(options.data,traditional)}if(options.beforeSubmit&&options.beforeSubmit(a,this,options)===false){log("ajaxSubmit: submit aborted via beforeSubmit callback");return this}this.trigger("form-submit-validate",[a,this,options,veto]);if(veto.veto){log("ajaxSubmit: submit vetoed via form-submit-validate trigger");return this}var q=$.param(a,traditional);if(qx)q=q?q+"&"+qx:qx;if(options.type.toUpperCase()=="GET"){options.url+=(options.url.indexOf("?")>=0?"&":"?")+q;options.data=null}else{options.data=q}var callbacks=[];if(options.resetForm){callbacks.push(function(){$form.resetForm()})}if(options.clearForm){callbacks.push(function(){$form.clearForm()})}if(!options.dataType&&options.target){var oldSuccess=options.success||function(){};callbacks.push(function(data){var fn=options.replaceTarget?"replaceWith":"html";$(options.target)[fn](data).each(oldSuccess,arguments)})}else if(options.success){callbacks.push(options.success)}options.success=function(data,status,xhr){var context=options.context||options;for(var i=0,max=callbacks.length;i<max;i++){callbacks[i].apply(context,[data,status,xhr||$form,$form])}};var fileInputs=$("input:file",this).length>0;var mp="multipart/form-data";var multipart=$form.attr("enctype")==mp||$form.attr("encoding")==mp;if(options.iframe!==false&&(fileInputs||options.iframe||multipart)){if(options.closeKeepAlive){$.get(options.closeKeepAlive,function(){fileUpload(a)})}else{fileUpload(a)}}else{if($.browser.msie&&method=="get"&&typeof options.type==="undefined"){var ieMeth=$form[0].getAttribute("method");if(typeof ieMeth==="string")options.type=ieMeth}$.ajax(options)}this.trigger("form-submit-notify",[this,options]);return this;function fileUpload(a){var form=$form[0],el,i,s,g,id,$io,io,xhr,sub,n,timedOut,timeoutHandle;var useProp=!!$.fn.prop;if(a){if(useProp){for(i=0;i<a.length;i++){el=$(form[a[i].name]);el.prop("disabled",false)}}else{for(i=0;i<a.length;i++){el=$(form[a[i].name]);el.removeAttr("disabled")}}}if($(":input[name=submit],:input[id=submit]",form).length){alert('Error: Form elements must not have name or id of "submit".');return}s=$.extend(true,{},$.ajaxSettings,options);s.context=s.context||s;id="jqFormIO"+(new Date).getTime();if(s.iframeTarget){$io=$(s.iframeTarget);n=$io.attr("name");if(n==null)$io.attr("name",id);else id=n}else{$io=$('<iframe name="'+id+'" src="'+s.iframeSrc+'" />');$io.css({position:"absolute",top:"-1000px",left:"-1000px"})}io=$io[0];xhr={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(status){var e=status==="timeout"?"timeout":"aborted";log("aborting upload... "+e);this.aborted=1;$io.attr("src",s.iframeSrc);xhr.error=e;s.error&&s.error.call(s.context,xhr,e,status);g&&$.event.trigger("ajaxError",[xhr,s,e]);s.complete&&s.complete.call(s.context,xhr,e)}};g=s.global;if(g&&!$.active++){$.event.trigger("ajaxStart")}if(g){$.event.trigger("ajaxSend",[xhr,s])}if(s.beforeSend&&s.beforeSend.call(s.context,xhr,s)===false){if(s.global){$.active--}return}if(xhr.aborted){return}sub=form.clk;if(sub){n=sub.name;if(n&&!sub.disabled){s.extraData=s.extraData||{};s.extraData[n]=sub.value;if(sub.type=="image"){s.extraData[n+".x"]=form.clk_x;s.extraData[n+".y"]=form.clk_y}}}var CLIENT_TIMEOUT_ABORT=1;var SERVER_ABORT=2;function getDoc(frame){var doc=frame.contentWindow?frame.contentWindow.document:frame.contentDocument?frame.contentDocument:frame.document;return doc}function doSubmit(){var t=$form.attr("target"),a=$form.attr("action");form.setAttribute("target",id);if(!method){form.setAttribute("method","POST")}if(a!=s.url){form.setAttribute("action",s.url)}if(!s.skipEncodingOverride&&(!method||/post/i.test(method))){$form.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"})}if(s.timeout){timeoutHandle=setTimeout(function(){timedOut=true;cb(CLIENT_TIMEOUT_ABORT)},s.timeout)}function checkState(){try{var state=getDoc(io).readyState;log("state = "+state);if(state.toLowerCase()=="uninitialized")setTimeout(checkState,50)}catch(e){log("Server abort: ",e," (",e.name,")");cb(SERVER_ABORT);timeoutHandle&&clearTimeout(timeoutHandle);timeoutHandle=undefined}}var extraInputs=[];try{if(s.extraData){for(var n in s.extraData){extraInputs.push($('<input type="hidden" name="'+n+'" />').attr("value",s.extraData[n]).appendTo(form)[0])}}if(!s.iframeTarget){$io.appendTo("body");io.attachEvent?io.attachEvent("onload",cb):io.addEventListener("load",cb,false)}setTimeout(checkState,15);form.submit()}finally{form.setAttribute("action",a);if(t){form.setAttribute("target",t)}else{$form.removeAttr("target")}$(extraInputs).remove()}}if(s.forceSync){doSubmit()}else{setTimeout(doSubmit,10)}var data,doc,domCheckCount=50,callbackProcessed;function cb(e){if(xhr.aborted||callbackProcessed){return}try{doc=getDoc(io)}catch(ex){log("cannot access response document: ",ex);e=SERVER_ABORT}if(e===CLIENT_TIMEOUT_ABORT&&xhr){xhr.abort("timeout");return}else if(e==SERVER_ABORT&&xhr){xhr.abort("server abort");return}if(!doc||doc.location.href==s.iframeSrc){if(!timedOut)return}io.detachEvent?io.detachEvent("onload",cb):io.removeEventListener("load",cb,false);var status="success",errMsg;try{if(timedOut){throw"timeout"}var isXml=s.dataType=="xml"||doc.XMLDocument||$.isXMLDoc(doc);log("isXml="+isXml);if(!isXml&&window.opera&&(doc.body==null||doc.body.innerHTML=="")){if(--domCheckCount){log("requeing onLoad callback, DOM not available");setTimeout(cb,250);return}}var docRoot=doc.body?doc.body:doc.documentElement;xhr.responseText=docRoot?docRoot.innerHTML:null;xhr.responseXML=doc.XMLDocument?doc.XMLDocument:doc;if(isXml)s.dataType="xml";xhr.getResponseHeader=function(header){var headers={"content-type":s.dataType};return headers[header]};if(docRoot){xhr.status=Number(docRoot.getAttribute("status"))||xhr.status;xhr.statusText=docRoot.getAttribute("statusText")||xhr.statusText}var dt=(s.dataType||"").toLowerCase();var scr=/(json|script|text)/.test(dt);if(scr||s.textarea){var ta=doc.getElementsByTagName("textarea")[0];if(ta){xhr.responseText=ta.value;xhr.status=Number(ta.getAttribute("status"))||xhr.status;xhr.statusText=ta.getAttribute("statusText")||xhr.statusText}else if(scr){var pre=doc.getElementsByTagName("pre")[0];var b=doc.getElementsByTagName("body")[0];if(pre){xhr.responseText=pre.textContent?pre.textContent:pre.innerText}else if(b){xhr.responseText=b.textContent?b.textContent:b.innerText}}}else if(dt=="xml"&&!xhr.responseXML&&xhr.responseText!=null){xhr.responseXML=toXml(xhr.responseText)}try{data=httpData(xhr,dt,s)}catch(e){status="parsererror";xhr.error=errMsg=e||status}}catch(e){log("error caught: ",e);status="error";xhr.error=errMsg=e||status}if(xhr.aborted){log("upload aborted");status=null}if(xhr.status){status=xhr.status>=200&&xhr.status<300||xhr.status===304?"success":"error"}if(status==="success"){s.success&&s.success.call(s.context,data,"success",xhr);g&&$.event.trigger("ajaxSuccess",[xhr,s])}else if(status){if(errMsg==undefined)errMsg=xhr.statusText;s.error&&s.error.call(s.context,xhr,status,errMsg);g&&$.event.trigger("ajaxError",[xhr,s,errMsg])}g&&$.event.trigger("ajaxComplete",[xhr,s]);if(g&&!--$.active){$.event.trigger("ajaxStop")}s.complete&&s.complete.call(s.context,xhr,status);callbackProcessed=true;if(s.timeout)clearTimeout(timeoutHandle);setTimeout(function(){if(!s.iframeTarget)$io.remove();xhr.responseXML=null},100)}var toXml=$.parseXML||function(s,doc){if(window.ActiveXObject){doc=new ActiveXObject("Microsoft.XMLDOM");doc.async="false";doc.loadXML(s)}else{doc=(new DOMParser).parseFromString(s,"text/xml")}return doc&&doc.documentElement&&doc.documentElement.nodeName!="parsererror"?doc:null};var parseJSON=$.parseJSON||function(s){return window["eval"]("("+s+")")};var httpData=function(xhr,type,s){var ct=xhr.getResponseHeader("content-type")||"",xml=type==="xml"||!type&&ct.indexOf("xml")>=0,data=xml?xhr.responseXML:xhr.responseText;if(xml&&data.documentElement.nodeName==="parsererror"){$.error&&$.error("parsererror")}if(s&&s.dataFilter){data=s.dataFilter(data,type)}if(typeof data==="string"){if(type==="json"||!type&&ct.indexOf("json")>=0){data=parseJSON(data)}else if(type==="script"||!type&&ct.indexOf("javascript")>=0){$.globalEval(data)}}return data}}};$.fn.ajaxForm=function(options){if(this.length===0){var o={s:this.selector,c:this.context};if(!$.isReady&&o.s){log("DOM not ready, queuing ajaxForm");$(function(){$(o.s,o.c).ajaxForm(options)});return this}log("terminating; zero elements found by selector"+($.isReady?"":" (DOM not ready)"));return this}return this.ajaxFormUnbind().bind("submit.form-plugin",function(e){if(!e.isDefaultPrevented()){e.preventDefault();$(this).ajaxSubmit(options)}}).bind("click.form-plugin",function(e){var target=e.target;var $el=$(target);if(!$el.is(":submit,input:image")){var t=$el.closest(":submit");if(t.length==0){return}target=t[0]}var form=this;form.clk=target;if(target.type=="image"){if(e.offsetX!=undefined){form.clk_x=e.offsetX;form.clk_y=e.offsetY}else if(typeof $.fn.offset=="function"){var offset=$el.offset();form.clk_x=e.pageX-offset.left;form.clk_y=e.pageY-offset.top}else{form.clk_x=e.pageX-target.offsetLeft;form.clk_y=e.pageY-target.offsetTop}}setTimeout(function(){form.clk=form.clk_x=form.clk_y=null},100)})};$.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")};$.fn.formToArray=function(semantic){var a=[];if(this.length===0){return a}var form=this[0];var els=semantic?form.getElementsByTagName("*"):form.elements;if(!els){return a}var i,j,n,v,el,max,jmax;for(i=0,max=els.length;i<max;i++){el=els[i];n=el.name;if(!n){continue}if(semantic&&form.clk&&el.type=="image"){if(!el.disabled&&form.clk==el){a.push({name:n,value:$(el).val()});a.push({name:n+".x",value:form.clk_x},{name:n+".y",value:form.clk_y})}continue}v=$.fieldValue(el,true);if(v&&v.constructor==Array){for(j=0,jmax=v.length;j<jmax;j++){a.push({name:n,value:v[j]})}}else if(v!==null&&typeof v!="undefined"){a.push({name:n,value:v})}}if(!semantic&&form.clk){var $input=$(form.clk),input=$input[0];n=input.name;if(n&&!input.disabled&&input.type=="image"){a.push({name:n,value:$input.val()});a.push({name:n+".x",value:form.clk_x},{name:n+".y",value:form.clk_y})}}return a};$.fn.formSerialize=function(semantic){return $.param(this.formToArray(semantic))};$.fn.fieldSerialize=function(successful){var a=[];this.each(function(){var n=this.name;if(!n){return}var v=$.fieldValue(this,successful);if(v&&v.constructor==Array){for(var i=0,max=v.length;i<max;i++){a.push({name:n,value:v[i]})}}else if(v!==null&&typeof v!="undefined"){a.push({name:this.name,value:v})}});return $.param(a)};$.fn.fieldValue=function(successful){for(var val=[],i=0,max=this.length;i<max;i++){var el=this[i];var v=$.fieldValue(el,successful);if(v===null||typeof v=="undefined"||v.constructor==Array&&!v.length){continue}v.constructor==Array?$.merge(val,v):val.push(v)}return val};$.fieldValue=function(el,successful){var n=el.name,t=el.type,tag=el.tagName.toLowerCase();if(successful===undefined){successful=true}if(successful&&(!n||el.disabled||t=="reset"||t=="button"||(t=="checkbox"||t=="radio")&&!el.checked||(t=="submit"||t=="image")&&el.form&&el.form.clk!=el||tag=="select"&&el.selectedIndex==-1)){return null}if(tag=="select"){var index=el.selectedIndex;if(index<0){return null}var a=[],ops=el.options;var one=t=="select-one";var max=one?index+1:ops.length;for(var i=one?index:0;i<max;i++){var op=ops[i];if(op.selected){var v=op.value;if(!v){v=op.attributes&&op.attributes["value"]&&!op.attributes["value"].specified?op.text:op.value}if(one){return v}a.push(v)}}return a}return $(el).val()};$.fn.clearForm=function(){return this.each(function(){$("input,select,textarea",this).clearFields()})};$.fn.clearFields=$.fn.clearInputs=function(){var re=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var t=this.type,tag=this.tagName.toLowerCase();if(re.test(t)||tag=="textarea"){this.value=""}else if(t=="checkbox"||t=="radio"){this.checked=false}else if(tag=="select"){this.selectedIndex=-1}})};$.fn.resetForm=function(){return this.each(function(){if(typeof this.reset=="function"||typeof this.reset=="object"&&!this.reset.nodeType){this.reset()}})};$.fn.enable=function(b){if(b===undefined){b=true}return this.each(function(){this.disabled=!b})};$.fn.selected=function(select){if(select===undefined){select=true}return this.each(function(){var t=this.type;if(t=="checkbox"||t=="radio"){this.checked=select}else if(this.tagName.toLowerCase()=="option"){var $sel=$(this).parent("select");if(select&&$sel[0]&&$sel[0].type=="select-one"){$sel.find("option").selected(false)}this.selected=select}})};$.fn.ajaxSubmit.debug=false;function log(){if(!$.fn.ajaxSubmit.debug)return;var msg="[jquery.form] "+Array.prototype.join.call(arguments,"");if(window.console&&window.console.log){window.console.log(msg)}else if(window.opera&&window.opera.postError){window.opera.postError(msg)}}})(jQuery);
define("lib/jquery.form", function(){});

define('core/s3',["core/api","core/i18n","lib/jquery.form"],function(api,i18nModule,_jqueryform){var i18n=i18nModule.i18n;function createCORSRequest(){var xhr;if(typeof XMLHttpRequest!="undefined"){xhr=new XMLHttpRequest}return xhr}function logErrorsToServer(response,status,state,description){api.call("log-manual-upload-image-error",{response:response,status:status,state:state,description:description,url:window.location.href},null)}function validateFile(url,success,failure,verifyURL){if(typeof verifyURL==="undefined")verifyURL="merch-url/image";api.call(verifyURL,{url:url},success,failure)}function checkFileType(file){allowedDocTypes=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"];if(file.type.indexOf("image/")==0){return"image"}else if(allowedDocTypes.indexOf(file.type)>-1){return"doc"}return false}function fallbackServerUpload(form,success,failure,type){if(form==null){failure({msg:i18n("")});return}var url;if(type==="image"){url="/api/upload-tmp-image"}else{url="/api/upload-tmp-file"}form.ajaxForm({url:url,type:"post",dataType:"text",success:success,error:failure});form.submit()}function uploadToS3(form,success,failure,ext,allowDocs,overrideFile){if(typeof allowDocs=="undefined")allowDocs=false;var file;if(form==null){file=overrideFile}else{file=form.find("input.real-file-upload")[0].files[0]}var type=checkFileType(file);if(!type||type==="doc"&&!allowDocs){failure({msg:"Invalid file type"},null);return}var xhr=createCORSRequest();if(xhr==undefined){fallbackServerUpload(form,success,failure,type)}else{var verifyURL;if(type==="image"){verifyURL="merch-url/image"}else{verifyURL="merch-url/file"}api.call("generate-signed-upload-url",{type:file.type,ext:ext,name:file.name},function(resp){var image_url=resp.data.image_url;xhr.addEventListener("load",function(e){if(xhr.readyState!=4){return}if(!(200<=(_ref=xhr.status)&&_ref<300)){failure(resp,xhr);logErrorsToServer(xhr.response,xhr.status,"load","uploadToS3")}else{validateFile(image_url,function(){success(resp,xhr)},function(){failure(resp,xhr)},verifyURL)}},false);xhr.addEventListener("error",function(e){fallbackServerUpload(form,success,failure,type);logErrorsToServer(xhr.response,xhr.status,"error","uploadToS3")},false);xhr.addEventListener("abort",function(e){failure(resp,xhr);logErrorsToServer(xhr.response,xhr.status,"abort","uploadToS3")},false);xhr.open("PUT",resp.data.url,true);xhr.setRequestHeader("Content-Type",file.type);xhr.setRequestHeader("x-amz-acl","public-read");xhr.timeout=12e4;xhr.ontimeout=function(){fallbackServerUpload(form,success,failure,type);logErrorsToServer(xhr.response,xhr.status,"timeout","uploadToS3")};xhr.send(file)},function(resp){failure(resp)})}}function dropzoneUploadFiles(files,dropzone,allowDocs,allowImages){if(typeof allowDocs=="undefined")allowDocs=false;if(typeof allowImages=="undefined")allowImages=true;var file=files[0];var type=checkFileType(file);if(!type){dropzone._errorProcessing(files,"");return}else if(type==="doc"){if(allowDocs){verifyURL="merch-url/file"}else{dropzone._errorProcessing(files,"");return}}else if(type==="image"){if(allowImages){verifyURL="merch-url/image"}else{dropzone._errorProcessing(files,"");return}}api.call("generate-signed-upload-url",{type:file.type,name:file.name},function(resp){var url=resp.data.url;uploadFiles(files,dropzone,url,resp.data.image_url,verifyURL)},function(){dropzone._errorProcessing(files,"");logErrorsToServer("generate url failed","","","dropzoneUploadFiles")})}function uploadFiles(files,dropzone,url,image_url,verifyURL){var file,handleError,headerName,headerValue,headers,i,input,inputName,inputType,key,option,progressObj,response,updateProgress,value,xhr,_i,_j,_k,_l,_len,_len1,_len2,_len3,_m,_ref,_ref1,_ref2,_ref3,_ref4,_ref5,_this=dropzone;xhr=new XMLHttpRequest;for(_i=0,_len=files.length;_i<_len;_i++){file=files[_i];file.xhr=xhr}xhr.open("PUT",url,true);xhr.withCredentials=!!dropzone.options.withCredentials;response=null;handleError=function(){return _this._errorProcessing(files,_this.options.dictResponseError.replace("{{statusCode}}",xhr.status),xhr)};xhr.onload=function(e){var _ref;if(files[0].status=="canceled"){return}if(xhr.readyState!==4){return}response=image_url;if(!(200<=(_ref=xhr.status)&&_ref<300)){logErrorsToServer(xhr.response,xhr.status,"load","uploadFiles");return handleError()}else{validateFile(response,function(){_this._finished(files,response,e)},function(){handleError()},verifyURL)}};xhr.onerror=function(){if(files[0].status=="canceled"){return}logErrorsToServer(xhr.response,xhr.status,"error","uploadFiles");return handleError()};xhr.onabort=function(){if(files[0].status=="canceled"){return}logErrorsToServer(xhr.response,xhr.status,"abort","uploadFiles");return handleError()};progressObj=(_ref=xhr.upload)!=null?_ref:xhr;progressObj.onprogress=updateProgress;headers={Accept:"application/json","Cache-Control":"no-cache","X-Requested-With":"XMLHttpRequest"};if(dropzone.options.headers){extend(headers,dropzone.options.headers)}for(headerName in headers){headerValue=headers[headerName];xhr.setRequestHeader(headerName,headerValue)}xhr.setRequestHeader("Content-Type",file.type);xhr.setRequestHeader("x-amz-acl","public-read");return xhr.send(file)}return{uploadToS3:uploadToS3,dropzoneUploadFiles:dropzoneUploadFiles,logErrorsToServer:logErrorsToServer}});
define('view/UploadFileView',["underscore","core/bb","tpl!upload_file","core/dom_utils","core/s3","core/api","core/i18n"],function(_,bb,tpl,dom_utils,s3,api,i18nModule){var i18n=i18nModule.i18n;var UploadFileView=bb.BackboneView.extend({initialize:function(multi,success,failure,maxFiles,promptNewFile){this.success=success;this.failure=failure;this.$container=$('<div class="upload-file-container"></div>');this.setElement(this.$container);this.multi=multi;this.files=[];this.filesReady=true;this.promptNewFile=promptNewFile;if(maxFiles){this.maxFiles=maxFiles}if(typeof this.success=="undefined"){this.success=function(resp,xhr){}}if(typeof this.failure=="undefined"){this.failure=function(resp,xhr){if(xhr&&"response"in xhr){var message=xhr.response}else if(resp&&"msg"in resp){var message=resp.msg}else{var message="Unknown error"}api.launchErrorModal(message)}}},events:{"click .fake-file-upload":"clickFakeUploadBtn","change .real-file-upload":"updateFileUploadDisplay","dragover .file-upload-container":"fileDragover","dragleave .file-upload-container":"fileDragleave","dragenter .file-upload-container":"fileDragenter","drop .file-upload-container":"fileDrop","click .add-file":"addRow"},addRow:function(){this.$el.find("#prompt-new-file").hide();var $row=$(this.buildTpl(tpl.upload_file)({}));var idx=this.files.length;$row.attr("data-idx",idx);this.files[idx]="";this.$el.find(".upload-file-container").append($row)},addPromptNewFile:function(){var $row=$(this.buildTpl(tpl.upload_file_prompt_new_file)({}));this.$el.find("#prompt-new-file-div").append($row)},fileDragover:function(e){e.preventDefault();e.stopPropagation();$(e.currentTarget).addClass("file-drag")},fileDragleave:function(e){e.preventDefault();e.stopPropagation();$(e.currentTarget).removeClass("file-drag")},fileDragenter:function(e){e.preventDefault();e.stopPropagation()},fileDrop:function(e){e.preventDefault();e.stopPropagation();$el=$(e.currentTarget);$el.removeClass("file-drag");if(e.originalEvent.dataTransfer){if(e.originalEvent.dataTransfer.files.length){e.preventDefault();e.stopPropagation();file=e.originalEvent.dataTransfer.files[0];this.setDisplayState($el.find(".real-file-upload"),"pending",file.name);var idx=$el.attr("data-idx");this.uploadFile(null,file.name,idx,file)}}},setDisplayFile:function(filename){if(this.multi){return false}this.setDisplayState(this.$(".real-file-upload"),"selected",filename);var $display=this.$(".file-display-input");$display.html(filename);$display.addClass("file-selected");$display.removeClass("no-file-selected")},clickFakeUploadBtn:function(evt){evt.preventDefault();var $row=$(evt.currentTarget).closest(".file-upload-container");$row.find("input.real-file-upload").click()},getFiles:function(){returnFiles=[];for(var i=0;i<this.files.length;i++){if(this.files[i]!==""){returnFiles.push(this.files[i])}}if(this.multi===false){return returnFiles.length>0?returnFiles[0]:null}return returnFiles},setDisplayState:function($inputEl,state,displayText){var $row=$inputEl.closest(".file-upload-container");var $display=$row.find(".file-display-input");var $spinner=$row.find(".loading-spinner");$display.removeClass("file-pending");$display.removeClass("no-file-selected");$display.removeClass("file-selected");$spinner.hide();if(state=="selected"){$display.addClass("file-selected")}else if(state=="pending"){$display.addClass("file-pending");$spinner.show()}else if(state=="no-file"){$display.addClass("no-file-selected")}if(typeof displayText!=="undefined"){$display.html(displayText)}},updateFileUploadDisplay:function(evt){var file_path=dom_utils.val(evt.currentTarget);var file_parts=file_path.split("\\");var filename=file_parts[file_parts.length-1];var $row=$(evt.currentTarget).closest(".file-upload-container");var idx=$row.attr("data-idx");this.files[idx]="";this.setDisplayState($(evt.currentTarget),"pending",filename);this.uploadFile($(evt.currentTarget),filename,idx)},uploadFile:function($inputEl,filename,idx,overrideFile){this.filesReady=false;var success=_.bind(function(resp,xhr){var original_resp=resp;if(typeof resp==="string"){resp=$.parseJSON(resp)}if(resp.code!=0){failure(resp,xhr);s3.logErrorsToServer(original_resp,"","","uploadImage");return}if($inputEl===null){var $row=this.$('.file-upload-container[data-idx="'+idx+'"]');$inputEl=$row.find(".real-file-upload")}this.filesReady=true;this.setDisplayState($inputEl,"selected");f={url:resp.data.image_url,original_filename:filename};this.files[idx]=f;if(this.success){this.success(f)}if(this.multi&&(this.maxFiles==null||this.files.length<this.maxFiles)){if(this.promptNewFile==true){this.$el.find("#prompt-new-file").show()}else{this.addRow()}}else{this.$el.find("#prompt-new-file").hide()}},this);var failure=_.bind(function(resp,xhr){var log_data={resp:resp,filename:filename,drag:$inputEl===null,url:window.location.href,files:this.files};if(xhr){log_data.xhr=xhr.message}api.call("log-file-upload-error",{log_data:JSON.stringify(log_data)});this.filesReady=true;var $oldrow=this.$el.find(".file-upload-container:eq("+idx+")");var $row=$(this.buildTpl(tpl.upload_file)({}));$row.attr("data-idx",idx);this.files[idx]="";$oldrow.replaceWith($row);if(resp!=undefined){this.failure(resp,xhr)}},this);if(!filename){var resp={msg:i18n("")};failure(resp,undefined);return}var ext=filename.split(".").pop();if($inputEl!==null){var $form=$inputEl.closest("form");s3.uploadToS3($form,success,failure,ext,true)}else{s3.uploadToS3(null,success,failure,ext,true,overrideFile)}},render:function(){this.$el.html('<div class="upload-file-container">'+'</div><div id="prompt-new-file-div"></div>');this.addRow();if(this.promptNewFile){this.addPromptNewFile()}return this.$el}});return UploadFileView});
define('view/BaseFormView',["core/api","view/UploadFileView","core/i18n","core/bb"],function(api,UploadFileView,i18nModule,bb){var i18n=i18nModule.i18n;var BaseFormView=bb.BackboneView.extend({options:{apiURL:null,baseParams:{},fields:[],successCallback:function(resp){api.launchSuccessModal(resp.msg)},failureCallback:function(resp){api.launchErrorModal(resp.msg)}},baseField:{inputName:null,fileUploader:false,required:true,requiredFunction:null,apiParamName:null,validateCallback:null,getValueFunction:null,initialValue:null,displayName:null,alwaysInclude:false},initialize:function(options){$.extend(true,this.options,options);this.initFields();this.extraParams={}},initFields:function(){_.each(this.options.fields,_.bind(function(_field){var field={};$.extend(true,field,this.baseField);$.extend(true,field,_field);field.selector='[name="'+field.inputName+'"]';var $el=this.$(field.selector);if(!$el.length){throw"Could not find the input element: "+field.inputName}if(field.fileUploader){field.fileUploader=new UploadFileView(false);field.fileUploader.setElement($el);field.fileUploader.render()}if(field.apiParamName===null){field.apiParamName=field.inputName}if(field.displayName===null){var $label=this.$('label[for="'+field.inputName+'"]');if($label.length==1){field.displayName=$label.html().trim()}else{field.displayName=field.inputName}}if(field.initialValue!=null){if(field.fileUploader){field.fileUploader.setDisplayFile(field.initialValue.display_filename);field.required=false}else if($el.is("input")){if($el.is('[type="checkbox"]')){_.each($el,function(chk){if(field.initialValue.indexOf(chk.val()>=0)){$el.attr("checked","checked");$el.trigger("changed")}})}else if($el.is('[type="radio"]')){this.$(field.selector+'[value="'+field.initialValue+'"]').click().trigger("change")}else{$el.val(field.initialValue)}}else{throw"Unrecognized input"}}$.extend(_field,field)},this))},getFieldValue:function(field){if(field.getValueFunction!==null){return field.getValueFunction()}var $el=this.$(field.selector);if(field.fileUploader){var value=field.fileUploader.getFiles();if(value!==null){value=JSON.stringify(value)}return value}else if($el.is("input")){if($el.is('[type="checkbox"]')){value=[];_.each(this.$(field.selector+":checked"),function(chk){value.push(chk.val())});return value}else if($el.is('[type="radio"]')){var selected=this.$(field.selector+":checked");if(selected.length){return selected.val()}else{return null}}else{return $el.val()}}else{throw"Unrecognized input"}},validateField:function(field,value){var required=field.required;if(required&&field.requiredFunction!==null){required=field.requiredFunction()}if(required){if(typeof value==="undefined"||value===""||value===null||value===[]){return{isValid:false,message:field.displayName+" is required",required:required}}}return{isValid:true,message:"",required:required}},getSubmitParams:function(evt){var params=$.extend(true,{},this.baseParams);var errors=[];_.each(this.options.fields,_.bind(function(field){var value=this.getFieldValue(field);var validate=this.validateField(field,value);if(!validate.isValid){errors.push(validate.message)}else{if(validate.required||field.alwaysInclude){if(value!==null){params[field.apiParamName]=value}}}},this));if(errors.length>0){var message="Please correct the following errors:\n"+errors.join("\n");return{success:false,message:message}}else{return{success:true,params:params}}},addParam:function(key,val){this.extraParams[key]=val},joinParams:function(params1,params2){result={};for(var key in params1){result[key]=params1[key]}for(var key in params2){result[key]=params2[key]}return result},submit:function(evt){var getParams=this.getSubmitParams();if(!getParams.success){api.launchErrorModal(getParams.message);return}api.call(this.options.apiURL,this.joinParams(getParams["params"],this.extraParams),_.bind(this.options.successCallback,this),_.bind(this.options.failureCallback,this))}});return BaseFormView});
define('tpl!modals/confirmation_modal', function() {return {"modal":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class="modal confirmation-modal hide fade"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button> <h3>'+((__t=(title))==null?'':_.escape(__t))+'</h3> </div> <div class="modal-body"> <div class=" '; if(use_alert) { __p+=' alert alert-'+((__t=(alert))==null?'':_.escape(__t))+' '; } __p+=' "> '; if(bold_message) { __p+=' <strong> '; } __p+=' '; _.each(message.split("\n"), function(chunk) { __p+=' '+((__t=(chunk))==null?'':_.escape(__t))+'</br> '; }); __p+=' '; if(bold_message) { __p+=' </strong> '; } __p+=' </div> </div> <div class="modal-footer"> '; if (!hide_cancel_text) { __p+=' <a href="#" data-dismiss="modal" class="btn cancel-btn">'+((__t=(cancel_txt))==null?'':_.escape(__t))+'</a> '; } __p+=' <a href="#" data-dismiss="modal" class="btn btn-primary confirm-btn"> '+((__t=(confirm_txt))==null?'':_.escape(__t))+'</a> </div> </div> ';}return __p;}};});

define('view/modal/ConfirmationModal',["view/modal/BaseModal","tpl!modals/confirmation_modal"],function(BaseModalView,tpl){var ConfirmationModal=BaseModalView.extend({initialize:function(title,message,cancel_txt,confirm_txt,alert,hide_cancel_text,bold_message,use_alert){this.title=title;this.message=message;this.cancel_txt=typeof cancel_txt!=="undefined"?cancel_txt:"Cancel";this.confirm_txt=typeof confirm_txt!=="undefined"?confirm_txt:"Confirm";this.alert=typeof alert!=="undefined"?alert:"warning";this.tpl=this.buildTpl(tpl.modal);this.hide_cancel_text=typeof hide_cancel_text!=="undefined"?hide_cancel_text:false;this.bold_message=typeof bold_message!=="undefined"?bold_message:true;if(use_alert!=false){this.use_alert=true}else{this.use_alert=false}},render:function(){var modal_el=this.tpl({title:this.title,message:this.message,confirm_txt:this.confirm_txt,cancel_txt:this.cancel_txt,alert:this.alert,hide_cancel_text:this.hide_cancel_text,bold_message:this.bold_message,use_alert:this.use_alert});this.launchModal(modal_el);return this},events:{"click .confirm-btn":"clickConfirm","click .cancel-btn":"clickCancel"},clickConfirm:function(evt){this.trigger("confirm")},clickCancel:function(evt){this.trigger("cancel")}});return ConfirmationModal});
define('view/MerchantExtraInfoForm',["core/api","core/bb","core/i18n","tpl!merchant_extra_info","view/BaseFormView","view/modal/ConfirmationModal"],function(api,bb,i18nModule,tpl,BaseFormView,ConfirmationModal){var i18n=i18nModule.i18n;var FormView=bb.BackboneView.extend({initialize:function(merchant_user,edit_by_bd,is_pending){this.merchant_user=merchant_user;this.edit_by_bd=edit_by_bd;this.is_pending=is_pending;this.tpl=this.buildTpl(tpl.main);var individualFieldRequiredFunction=_.bind(function(){return this.$('input[name="entity"]:checked').val()=="1"},this);var companyFieldRequiredFunction=_.bind(function(){return this.$('input[name="entity"]:checked').val()=="2"},this);this.fields=[{inputName:"qq_number",required:true,initialValue:merchant_user.qq_group_number},{inputName:"entity",apiParamName:"entity_type",required:true,initialValue:merchant_user.entity_type},{inputName:"company_name",required:true,initialValue:merchant_user.company_name,requiredFunction:companyFieldRequiredFunction,alwaysInclude:false},{inputName:"business_license",fileUploader:true,required:true,initialValue:merchant_user.business_license_dict,requiredFunction:companyFieldRequiredFunction,alwaysInclude:true},{inputName:"business_license_id",required:true,apiParamName:"business_license_id",initialValue:merchant_user.business_license_id,requiredFunction:companyFieldRequiredFunction,alwaysInclude:false},{inputName:"tax_certificate",fileUploader:true,required:true,initialValue:merchant_user.tax_certificate_dict,requiredFunction:companyFieldRequiredFunction,alwaysInclude:true},{inputName:"company_photo_id",fileUploader:true,required:true,apiParamName:"photo_id",initialValue:merchant_user.photo_id_dict,requiredFunction:companyFieldRequiredFunction,alwaysInclude:true},{inputName:"representative_id_number",required:true,apiParamName:"photo_id_number",initialValue:merchant_user.photo_id_number,requiredFunction:companyFieldRequiredFunction,alwaysInclude:false},{inputName:"representative_name",required:true,apiParamName:"individual_name",initialValue:merchant_user.individual_name,requiredFunction:companyFieldRequiredFunction,alwaysInclude:false},{inputName:"individual_name",required:true,initialValue:merchant_user.individual_name,requiredFunction:individualFieldRequiredFunction,alwaysInclude:false},{inputName:"individual_photo_id",fileUploader:true,required:true,apiParamName:"photo_id",initialValue:merchant_user.photo_id_dict,requiredFunction:individualFieldRequiredFunction,alwaysInclude:true},{inputName:"individual_id_number",required:true,apiParamName:"photo_id_number",initialValue:merchant_user.photo_id_number,requiredFunction:individualFieldRequiredFunction,alwaysInclude:false}];if(!this.merchant_user.missing_extra_info){this.fields.push({inputName:"annual_gmv",required:true,initialValue:merchant_user.annual_gmv,requiredFunction:companyFieldRequiredFunction,alwaysInclude:false,displayName:"GMV last year"})}},render:function(){this.$el.html(this.tpl({merchant_user:this.merchant_user}));this.formView=new BaseFormView({fields:this.fields,apiURL:"merchant/edit-extra-info",el:this.$el,successCallback:_.bind(this.successCallback,this)});if(this.edit_by_bd){if(this.is_pending){this.formView.addParam("pending_merchant_id",this.merchant_user.puid)}else{this.formView.addParam("merchant_id",this.merchant_user.id)}}},successCallback:function(){confirmMsg=i18n("");if(this.merchant_user.missing_extra_info){confirmMsg=i18n("Merchant Support,")}var $modal=api.launchSuccessModal(confirmMsg);$modal.on("hidden",_.bind(function(){this.trigger("infoProvided")},this))},events:{'change input[name="entity"]':"entityTypeChanged","mouseenter .popover-hover":"popoverShow","mouseleave .popover-hover":"popoverHide"},popoverShow:function(evt){$(evt.currentTarget).popover("show")},popoverHide:function(evt){$(evt.currentTarget).popover("hide")},entityTypeChanged:function(evt){if(this.$('input[name="entity"]:checked').val()==1){this.$(".company-details").hide();this.$(".individual-details").show();this.$("#extra-info-form").height(400)}else{this.$(".company-details").show();this.$(".individual-details").hide();this.$("#extra-info-form").height(400)}},submit:function(evt){var confirmModal=new ConfirmationModal(i18n(""),i18n(""));confirmModal.on("confirm",_.bind(function(){this.formView.submit()},this));confirmModal.render()}});return FormView});
define('view/modal/MerchantExtraInfoModal',["core/api","view/modal/BaseModal","tpl!modals/merchant_extra_info","view/MerchantExtraInfoForm"],function(api,BaseModalView,tpl,FormView){var MerchantExtraInfoModal=BaseModalView.extend({initialize:function(merchant_user,edit_by_bd,is_pending){edit_by_bd=typeof edit_by_bd!=="undefined"?edit_by_bd:false;is_pending=typeof is_pending!=="undefined"?is_pending:false;this.formView=new FormView(merchant_user,edit_by_bd,is_pending);this.tpl=this.buildTpl(tpl.modal);this.merchant_user=merchant_user},render:function(){this.modal_el=this.tpl({merchant_user:this.merchant_user});this.launchModal(this.modal_el);this.formView.setElement(this.$(".modal-body"));this.formView.render();this.formView.on("infoProvided",_.bind(function(){this.close();this.trigger("infoProvided")},this))},events:{"click .btn-save":"submit"},submit:function(evt){this.formView.submit()},close:function(evt){this.$el.modal("hide")}});return MerchantExtraInfoModal});
(function(){var root=this,previous=root.Chart;var Chart=function(context){var chart=this;this.canvas=context.canvas;this.ctx=context;var width=this.width=context.canvas.width;var height=this.height=context.canvas.height;this.aspectRatio=this.width/this.height;helpers.retinaScale(this);return this};Chart.defaults={global:{animation:true,animationSteps:60,animationEasing:"easeOutQuart",showScale:true,scaleOverride:false,scaleSteps:null,scaleStepWidth:null,scaleStartValue:null,scaleLineColor:"rgba(0,0,0,.1)",scaleLineWidth:1,scaleShowLabels:true,scaleLabel:"<%=value%>",scaleIntegersOnly:true,scaleBeginAtZero:false,scaleFontFamily:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",scaleFontSize:12,scaleFontStyle:"normal",scaleFontColor:"#666",responsive:false,maintainAspectRatio:true,showTooltips:true,tooltipEvents:["mousemove","touchstart","touchmove","mouseout"],tooltipFillColor:"rgba(0,0,0,0.8)",tooltipFontFamily:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",tooltipFontSize:14,tooltipFontStyle:"normal",tooltipFontColor:"#fff",tooltipTitleFontFamily:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",tooltipTitleFontSize:14,tooltipTitleFontStyle:"bold",tooltipTitleFontColor:"#fff",tooltipYPadding:6,tooltipXPadding:6,tooltipCaretSize:8,tooltipCornerRadius:6,tooltipXOffset:10,tooltipTemplate:"<%if (label){%><%=label%>: <%}%><%= value %>",multiTooltipTemplate:"<%= value %>",multiTooltipKeyBackground:"#fff",onAnimationProgress:function(){},onAnimationComplete:function(){}}};Chart.types={};var helpers=Chart.helpers={};var each=helpers.each=function(loopable,callback,self){var additionalArgs=Array.prototype.slice.call(arguments,3);if(loopable){if(loopable.length===+loopable.length){var i;for(i=0;i<loopable.length;i++){callback.apply(self,[loopable[i],i].concat(additionalArgs))}}else{for(var item in loopable){callback.apply(self,[loopable[item],item].concat(additionalArgs))}}}},clone=helpers.clone=function(obj){var objClone={};each(obj,function(value,key){if(obj.hasOwnProperty(key))objClone[key]=value});return objClone},extend=helpers.extend=function(base){each(Array.prototype.slice.call(arguments,1),function(extensionObject){each(extensionObject,function(value,key){if(extensionObject.hasOwnProperty(key))base[key]=value})});return base},merge=helpers.merge=function(base,master){var args=Array.prototype.slice.call(arguments,0);args.unshift({});return extend.apply(null,args)},indexOf=helpers.indexOf=function(arrayToSearch,item){if(Array.prototype.indexOf){return arrayToSearch.indexOf(item)}else{for(var i=0;i<arrayToSearch.length;i++){if(arrayToSearch[i]===item)return i}return-1}},where=helpers.where=function(collection,filterCallback){var filtered=[];helpers.each(collection,function(item){if(filterCallback(item)){filtered.push(item)}});return filtered},findNextWhere=helpers.findNextWhere=function(arrayToSearch,filterCallback,startIndex){if(!startIndex){startIndex=-1}for(var i=startIndex+1;i<arrayToSearch.length;i++){var currentItem=arrayToSearch[i];if(filterCallback(currentItem)){return currentItem}}},findPreviousWhere=helpers.findPreviousWhere=function(arrayToSearch,filterCallback,startIndex){if(!startIndex){startIndex=arrayToSearch.length}for(var i=startIndex-1;i>=0;i--){var currentItem=arrayToSearch[i];if(filterCallback(currentItem)){return currentItem}}},inherits=helpers.inherits=function(extensions){var parent=this;var ChartElement=extensions&&extensions.hasOwnProperty("constructor")?extensions.constructor:function(){return parent.apply(this,arguments)};var Surrogate=function(){this.constructor=ChartElement};Surrogate.prototype=parent.prototype;ChartElement.prototype=new Surrogate;ChartElement.extend=inherits;if(extensions)extend(ChartElement.prototype,extensions);ChartElement.__super__=parent.prototype;return ChartElement},noop=helpers.noop=function(){},uid=helpers.uid=function(){var id=0;return function(){return"chart-"+id++}}(),warn=helpers.warn=function(str){if(window.console&&typeof window.console.warn=="function")console.warn(str)},amd=helpers.amd=typeof define=="function"&&define.amd,isNumber=helpers.isNumber=function(n){return!isNaN(parseFloat(n))&&isFinite(n)},max=helpers.max=function(array){return Math.max.apply(Math,array)},min=helpers.min=function(array){return Math.min.apply(Math,array)},cap=helpers.cap=function(valueToCap,maxValue,minValue){if(isNumber(maxValue)){if(valueToCap>maxValue){return maxValue}}else if(isNumber(minValue)){if(valueToCap<minValue){return minValue}}return valueToCap},getDecimalPlaces=helpers.getDecimalPlaces=function(num){if(num%1!==0&&isNumber(num)){return num.toString().split(".")[1].length}else{return 0}},toRadians=helpers.radians=function(degrees){return degrees*(Math.PI/180)},getAngleFromPoint=helpers.getAngleFromPoint=function(centrePoint,anglePoint){var distanceFromXCenter=anglePoint.x-centrePoint.x,distanceFromYCenter=anglePoint.y-centrePoint.y,radialDistanceFromCenter=Math.sqrt(distanceFromXCenter*distanceFromXCenter+distanceFromYCenter*distanceFromYCenter);var angle=Math.PI*2+Math.atan2(distanceFromYCenter,distanceFromXCenter);if(distanceFromXCenter<0&&distanceFromYCenter<0){angle+=Math.PI*2}return{angle:angle,distance:radialDistanceFromCenter}},aliasPixel=helpers.aliasPixel=function(pixelWidth){return pixelWidth%2===0?0:.5},splineCurve=helpers.splineCurve=function(FirstPoint,MiddlePoint,AfterPoint,t){var d01=Math.sqrt(Math.pow(MiddlePoint.x-FirstPoint.x,2)+Math.pow(MiddlePoint.y-FirstPoint.y,2)),d12=Math.sqrt(Math.pow(AfterPoint.x-MiddlePoint.x,2)+Math.pow(AfterPoint.y-MiddlePoint.y,2)),fa=t*d01/(d01+d12),fb=t*d12/(d01+d12);return{inner:{x:MiddlePoint.x-fa*(AfterPoint.x-FirstPoint.x),y:MiddlePoint.y-fa*(AfterPoint.y-FirstPoint.y)},outer:{x:MiddlePoint.x+fb*(AfterPoint.x-FirstPoint.x),y:MiddlePoint.y+fb*(AfterPoint.y-FirstPoint.y)}}},calculateOrderOfMagnitude=helpers.calculateOrderOfMagnitude=function(val){return Math.floor(Math.log(val)/Math.LN10)},calculateScaleRange=helpers.calculateScaleRange=function(valuesArray,drawingSize,textSize,startFromZero,integersOnly){var minSteps=2,maxSteps=Math.floor(drawingSize/(textSize*1.5)),skipFitting=minSteps>=maxSteps;var maxValue=max(valuesArray),minValue=min(valuesArray);var difValue=maxValue-minValue;maxValue+=difValue/15;minValue-=difValue/15;if(maxValue===minValue){maxValue+=.5;if(minValue>=.5&&!startFromZero){minValue-=.5}else{maxValue+=.5}}var valueRange=Math.abs(maxValue-minValue),rangeOrderOfMagnitude=calculateOrderOfMagnitude(valueRange),graphMax=Math.ceil(maxValue/(1*Math.pow(10,rangeOrderOfMagnitude)))*Math.pow(10,rangeOrderOfMagnitude),graphMin=startFromZero?0:Math.floor(minValue/(1*Math.pow(10,rangeOrderOfMagnitude)))*Math.pow(10,rangeOrderOfMagnitude),graphRange=graphMax-graphMin,stepValue=Math.pow(10,rangeOrderOfMagnitude),numberOfSteps=Math.round(graphRange/stepValue);while((numberOfSteps>maxSteps||numberOfSteps*2<maxSteps)&&!skipFitting){if(numberOfSteps>maxSteps){stepValue*=2;numberOfSteps=Math.round(graphRange/stepValue);if(numberOfSteps%1!==0){skipFitting=true}}else{if(integersOnly&&rangeOrderOfMagnitude>=0){if(stepValue/2%1===0){stepValue/=2;numberOfSteps=Math.round(graphRange/stepValue)}else{break}}else{stepValue/=2;numberOfSteps=Math.round(graphRange/stepValue)}}}if(skipFitting){numberOfSteps=minSteps;stepValue=graphRange/numberOfSteps}return{steps:numberOfSteps,stepValue:stepValue,min:graphMin,max:graphMin+numberOfSteps*stepValue}},template=helpers.template=function(templateString,valuesObject){if(templateString instanceof Function){return templateString(valuesObject)}var cache={};function tmpl(str,data){var fn=!/\W/.test(str)?cache[str]=cache[str]:new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};"+"with(obj){p.push('"+str.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return data?fn(data):fn}return tmpl(templateString,valuesObject)},generateLabels=helpers.generateLabels=function(templateString,numberOfSteps,graphMin,stepValue){var labelsArray=new Array(numberOfSteps);if(labelTemplateString){each(labelsArray,function(val,index){labelsArray[index]=template(templateString,{value:graphMin+stepValue*(index+1)})})}return labelsArray},easingEffects=helpers.easingEffects={linear:function(t){return t},easeInQuad:function(t){return t*t},easeOutQuad:function(t){return-1*t*(t-2)},easeInOutQuad:function(t){if((t/=1/2)<1)return 1/2*t*t;return-1/2*(--t*(t-2)-1)},easeInCubic:function(t){return t*t*t},easeOutCubic:function(t){return 1*((t=t/1-1)*t*t+1)},easeInOutCubic:function(t){if((t/=1/2)<1)return 1/2*t*t*t;return 1/2*((t-=2)*t*t+2)},easeInQuart:function(t){return t*t*t*t},easeOutQuart:function(t){return-1*((t=t/1-1)*t*t*t-1)},easeInOutQuart:function(t){if((t/=1/2)<1)return 1/2*t*t*t*t;return-1/2*((t-=2)*t*t*t-2)},easeInQuint:function(t){return 1*(t/=1)*t*t*t*t},easeOutQuint:function(t){return 1*((t=t/1-1)*t*t*t*t+1)},easeInOutQuint:function(t){if((t/=1/2)<1)return 1/2*t*t*t*t*t;return 1/2*((t-=2)*t*t*t*t+2)},easeInSine:function(t){return-1*Math.cos(t/1*(Math.PI/2))+1},easeOutSine:function(t){return 1*Math.sin(t/1*(Math.PI/2))},easeInOutSine:function(t){return-1/2*(Math.cos(Math.PI*t/1)-1)},easeInExpo:function(t){return t===0?1:1*Math.pow(2,10*(t/1-1))},easeOutExpo:function(t){return t===1?1:1*(-Math.pow(2,-10*t/1)+1)},easeInOutExpo:function(t){if(t===0)return 0;if(t===1)return 1;if((t/=1/2)<1)return 1/2*Math.pow(2,10*(t-1));return 1/2*(-Math.pow(2,-10*--t)+2)},easeInCirc:function(t){if(t>=1)return t;return-1*(Math.sqrt(1-(t/=1)*t)-1)},easeOutCirc:function(t){return 1*Math.sqrt(1-(t=t/1-1)*t)},easeInOutCirc:function(t){if((t/=1/2)<1)return-1/2*(Math.sqrt(1-t*t)-1);return 1/2*(Math.sqrt(1-(t-=2)*t)+1)},easeInElastic:function(t){var s=1.70158;var p=0;var a=1;if(t===0)return 0;if((t/=1)==1)return 1;if(!p)p=1*.3;if(a<Math.abs(1)){a=1;s=p/4}else s=p/(2*Math.PI)*Math.asin(1/a);return-(a*Math.pow(2,10*(t-=1))*Math.sin((t*1-s)*(2*Math.PI)/p))},easeOutElastic:function(t){var s=1.70158;var p=0;var a=1;if(t===0)return 0;if((t/=1)==1)return 1;if(!p)p=1*.3;if(a<Math.abs(1)){a=1;s=p/4}else s=p/(2*Math.PI)*Math.asin(1/a);return a*Math.pow(2,-10*t)*Math.sin((t*1-s)*(2*Math.PI)/p)+1},easeInOutElastic:function(t){var s=1.70158;var p=0;var a=1;if(t===0)return 0;if((t/=1/2)==2)return 1;if(!p)p=1*(.3*1.5);if(a<Math.abs(1)){a=1;s=p/4}else s=p/(2*Math.PI)*Math.asin(1/a);if(t<1)return-.5*(a*Math.pow(2,10*(t-=1))*Math.sin((t*1-s)*(2*Math.PI)/p));return a*Math.pow(2,-10*(t-=1))*Math.sin((t*1-s)*(2*Math.PI)/p)*.5+1},easeInBack:function(t){var s=1.70158;return 1*(t/=1)*t*((s+1)*t-s)},easeOutBack:function(t){var s=1.70158;return 1*((t=t/1-1)*t*((s+1)*t+s)+1)},easeInOutBack:function(t){var s=1.70158;if((t/=1/2)<1)return 1/2*(t*t*(((s*=1.525)+1)*t-s));return 1/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)},easeInBounce:function(t){return 1-easingEffects.easeOutBounce(1-t)},easeOutBounce:function(t){if((t/=1)<1/2.75){return 1*(7.5625*t*t)}else if(t<2/2.75){return 1*(7.5625*(t-=1.5/2.75)*t+.75)}else if(t<2.5/2.75){return 1*(7.5625*(t-=2.25/2.75)*t+.9375)}else{return 1*(7.5625*(t-=2.625/2.75)*t+.984375)}},easeInOutBounce:function(t){if(t<1/2)return easingEffects.easeInBounce(t*2)*.5;return easingEffects.easeOutBounce(t*2-1)*.5+1*.5}},requestAnimFrame=helpers.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){return window.setTimeout(callback,1e3/60)}}(),cancelAnimFrame=helpers.cancelAnimFrame=function(){return window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||function(callback){return window.clearTimeout(callback,1e3/60)}}(),animationLoop=helpers.animationLoop=function(callback,totalSteps,easingString,onProgress,onComplete,chartInstance){var currentStep=0,easingFunction=easingEffects[easingString]||easingEffects.linear;var animationFrame=function(){currentStep++;var stepDecimal=currentStep/totalSteps;var easeDecimal=easingFunction(stepDecimal);callback.call(chartInstance,easeDecimal,stepDecimal,currentStep);onProgress.call(chartInstance,easeDecimal,stepDecimal);if(currentStep<totalSteps){chartInstance.animationFrame=requestAnimFrame(animationFrame)}else{onComplete.apply(chartInstance)}};requestAnimFrame(animationFrame)},getRelativePosition=helpers.getRelativePosition=function(evt){var mouseX,mouseY;var e=evt.originalEvent||evt,canvas=evt.currentTarget||evt.srcElement,boundingRect=canvas.getBoundingClientRect();if(e.touches){mouseX=e.touches[0].clientX-boundingRect.left;mouseY=e.touches[0].clientY-boundingRect.top}else{mouseX=e.clientX-boundingRect.left;mouseY=e.clientY-boundingRect.top}return{x:mouseX,y:mouseY}},addEvent=helpers.addEvent=function(node,eventType,method){if(node.addEventListener){node.addEventListener(eventType,method)}else if(node.attachEvent){node.attachEvent("on"+eventType,method)}else{node["on"+eventType]=method}},removeEvent=helpers.removeEvent=function(node,eventType,handler){if(node.removeEventListener){node.removeEventListener(eventType,handler,false)}else if(node.detachEvent){node.detachEvent("on"+eventType,handler)}else{node["on"+eventType]=noop}},bindEvents=helpers.bindEvents=function(chartInstance,arrayOfEvents,handler){if(!chartInstance.events)chartInstance.events={};each(arrayOfEvents,function(eventName){chartInstance.events[eventName]=function(){handler.apply(chartInstance,arguments)};addEvent(chartInstance.chart.canvas,eventName,chartInstance.events[eventName])})},unbindEvents=helpers.unbindEvents=function(chartInstance,arrayOfEvents){each(arrayOfEvents,function(handler,eventName){removeEvent(chartInstance.chart.canvas,eventName,handler)})},getMaximumWidth=helpers.getMaximumWidth=function(domNode){var container=domNode.parentNode;return container.clientWidth},getMaximumHeight=helpers.getMaximumHeight=function(domNode){var container=domNode.parentNode;return container.clientHeight},getMaximumSize=helpers.getMaximumSize=helpers.getMaximumWidth,retinaScale=helpers.retinaScale=function(chart){var ctx=chart.ctx,width=chart.canvas.width,height=chart.canvas.height;if(window.devicePixelRatio){ctx.canvas.style.width=width+"px";ctx.canvas.style.height=height+"px";ctx.canvas.height=height*window.devicePixelRatio;ctx.canvas.width=width*window.devicePixelRatio;ctx.scale(window.devicePixelRatio,window.devicePixelRatio)}},clear=helpers.clear=function(chart){chart.ctx.clearRect(0,0,chart.width,chart.height)},fontString=helpers.fontString=function(pixelSize,fontStyle,fontFamily){return fontStyle+" "+pixelSize+"px "+fontFamily},longestText=helpers.longestText=function(ctx,font,arrayOfStrings){ctx.font=font;var longest=0;each(arrayOfStrings,function(string){var textWidth=ctx.measureText(string).width;longest=textWidth>longest?textWidth:longest});return longest},drawRoundedRectangle=helpers.drawRoundedRectangle=function(ctx,x,y,width,height,radius){ctx.beginPath();ctx.moveTo(x+radius,y);ctx.lineTo(x+width-radius,y);ctx.quadraticCurveTo(x+width,y,x+width,y+radius);ctx.lineTo(x+width,y+height-radius);ctx.quadraticCurveTo(x+width,y+height,x+width-radius,y+height);ctx.lineTo(x+radius,y+height);ctx.quadraticCurveTo(x,y+height,x,y+height-radius);ctx.lineTo(x,y+radius);ctx.quadraticCurveTo(x,y,x+radius,y);ctx.closePath()};Chart.instances={};Chart.Type=function(data,options,chart){this.options=options;this.chart=chart;this.id=uid();Chart.instances[this.id]=this;if(options.responsive){this.resize()}this.initialize.call(this,data)};extend(Chart.Type.prototype,{initialize:function(){return this},clear:function(){clear(this.chart);return this},stop:function(){helpers.cancelAnimFrame.call(root,this.animationFrame);return this},resize:function(callback){this.stop();var canvas=this.chart.canvas,newWidth=getMaximumWidth(this.chart.canvas),newHeight=this.options.maintainAspectRatio?newWidth/this.chart.aspectRatio:getMaximumHeight(this.chart.canvas);canvas.width=this.chart.width=newWidth;canvas.height=this.chart.height=newHeight;retinaScale(this.chart);if(typeof callback==="function"){callback.apply(this,Array.prototype.slice.call(arguments,1))}return this},reflow:noop,render:function(reflow){if(reflow){this.reflow()}if(this.options.animation&&!reflow){helpers.animationLoop(this.draw,this.options.animationSteps,this.options.animationEasing,this.options.onAnimationProgress,this.options.onAnimationComplete,this)}else{this.draw();this.options.onAnimationComplete.call(this)}return this},generateLegend:function(){return template(this.options.legendTemplate,this)},destroy:function(){this.clear();unbindEvents(this,this.events);delete Chart.instances[this.id]},showTooltip:function(ChartElements,forceRedraw){if(typeof this.activeElements==="undefined")this.activeElements=[];var isChanged=function(Elements){var changed=false;if(Elements.length!==this.activeElements.length){changed=true;return changed}each(Elements,function(element,index){if(element!==this.activeElements[index]){changed=true}},this);return changed}.call(this,ChartElements);if(!isChanged&&!forceRedraw){return}else{this.activeElements=ChartElements}this.draw();if(ChartElements.length>0){if(this.datasets&&this.datasets.length>1){var dataArray,dataIndex;for(var i=this.datasets.length-1;i>=0;i--){dataArray=this.datasets[i].points||this.datasets[i].bars||this.datasets[i].segments;dataIndex=indexOf(dataArray,ChartElements[0]);if(dataIndex!==-1){break}}var tooltipLabels=[],tooltipColors=[],medianPosition=function(index){var Elements=[],dataCollection,xPositions=[],yPositions=[],xMax,yMax,xMin,yMin;helpers.each(this.datasets,function(dataset){dataCollection=dataset.points||dataset.bars||dataset.segments;if(dataCollection[dataIndex]&&dataCollection[dataIndex].hasValue()){Elements.push(dataCollection[dataIndex])}});helpers.each(Elements,function(element){xPositions.push(element.x);yPositions.push(element.y);tooltipLabels.push(helpers.template(this.options.multiTooltipTemplate,element));tooltipColors.push({fill:element._saved.fillColor||element.fillColor,stroke:element._saved.strokeColor||element.strokeColor})},this);yMin=min(yPositions);yMax=max(yPositions);xMin=min(xPositions);xMax=max(xPositions);return{x:xMin>this.chart.width/2?xMin:xMax,y:(yMin+yMax)/2}}.call(this,dataIndex);new Chart.MultiTooltip({x:medianPosition.x,y:medianPosition.y,xPadding:this.options.tooltipXPadding,yPadding:this.options.tooltipYPadding,xOffset:this.options.tooltipXOffset,fillColor:this.options.tooltipFillColor,textColor:this.options.tooltipFontColor,fontFamily:this.options.tooltipFontFamily,fontStyle:this.options.tooltipFontStyle,fontSize:this.options.tooltipFontSize,titleTextColor:this.options.tooltipTitleFontColor,titleFontFamily:this.options.tooltipTitleFontFamily,titleFontStyle:this.options.tooltipTitleFontStyle,titleFontSize:this.options.tooltipTitleFontSize,cornerRadius:this.options.tooltipCornerRadius,labels:tooltipLabels,legendColors:tooltipColors,legendColorBackground:this.options.multiTooltipKeyBackground,title:ChartElements[0].label,chart:this.chart,ctx:this.chart.ctx}).draw()}else{each(ChartElements,function(Element){var tooltipPosition=Element.tooltipPosition();new Chart.Tooltip({x:Math.round(tooltipPosition.x),y:Math.round(tooltipPosition.y),xPadding:this.options.tooltipXPadding,yPadding:this.options.tooltipYPadding,fillColor:this.options.tooltipFillColor,textColor:this.options.tooltipFontColor,fontFamily:this.options.tooltipFontFamily,fontStyle:this.options.tooltipFontStyle,fontSize:this.options.tooltipFontSize,caretHeight:this.options.tooltipCaretSize,cornerRadius:this.options.tooltipCornerRadius,text:template(this.options.tooltipTemplate,Element),chart:this.chart}).draw()},this)}}return this},toBase64Image:function(){return this.chart.canvas.toDataURL.apply(this.chart.canvas,arguments)}});Chart.Type.extend=function(extensions){var parent=this;var ChartType=function(){return parent.apply(this,arguments)};ChartType.prototype=clone(parent.prototype);extend(ChartType.prototype,extensions);ChartType.extend=Chart.Type.extend;if(extensions.name||parent.prototype.name){var chartName=extensions.name||parent.prototype.name;var baseDefaults=Chart.defaults[parent.prototype.name]?clone(Chart.defaults[parent.prototype.name]):{};Chart.defaults[chartName]=extend(baseDefaults,extensions.defaults);Chart.types[chartName]=ChartType;Chart.prototype[chartName]=function(data,options){var config=merge(Chart.defaults.global,Chart.defaults[chartName],options||{});return new ChartType(data,config,this)}}else{warn("Name not provided for this chart, so it hasn't been registered")}return parent};Chart.Element=function(configuration){extend(this,configuration);this.initialize.apply(this,arguments);this.save()};extend(Chart.Element.prototype,{initialize:function(){},restore:function(props){if(!props){extend(this,this._saved)}else{each(props,function(key){this[key]=this._saved[key]},this)}return this},save:function(){this._saved=clone(this);delete this._saved._saved;return this},update:function(newProps){each(newProps,function(value,key){this._saved[key]=this[key];this[key]=value},this);return this},transition:function(props,ease){each(props,function(value,key){this[key]=(value-this._saved[key])*ease+this._saved[key]},this);return this},tooltipPosition:function(){return{x:this.x,y:this.y}},hasValue:function(){return isNumber(this.value)}});Chart.Element.extend=inherits;Chart.Point=Chart.Element.extend({display:true,inRange:function(chartX,chartY){var hitDetectionRange=this.hitDetectionRadius+this.radius;return Math.pow(chartX-this.x,2)+Math.pow(chartY-this.y,2)<Math.pow(hitDetectionRange,2)},draw:function(){if(this.display){var ctx=this.ctx;ctx.beginPath();ctx.arc(this.x,this.y,this.radius,0,Math.PI*2);ctx.closePath();ctx.strokeStyle=this.strokeColor;ctx.lineWidth=this.strokeWidth;ctx.fillStyle=this.fillColor;ctx.fill();ctx.stroke()}}});Chart.Arc=Chart.Element.extend({inRange:function(chartX,chartY){var pointRelativePosition=helpers.getAngleFromPoint(this,{x:chartX,y:chartY});var betweenAngles=pointRelativePosition.angle>=this.startAngle&&pointRelativePosition.angle<=this.endAngle,withinRadius=pointRelativePosition.distance>=this.innerRadius&&pointRelativePosition.distance<=this.outerRadius;return betweenAngles&&withinRadius},tooltipPosition:function(){var centreAngle=this.startAngle+(this.endAngle-this.startAngle)/2,rangeFromCentre=(this.outerRadius-this.innerRadius)/2+this.innerRadius;return{x:this.x+Math.cos(centreAngle)*rangeFromCentre,y:this.y+Math.sin(centreAngle)*rangeFromCentre}},draw:function(animationPercent){var easingDecimal=animationPercent||1;var ctx=this.ctx;ctx.beginPath();ctx.arc(this.x,this.y,this.outerRadius,this.startAngle,this.endAngle);ctx.arc(this.x,this.y,this.innerRadius,this.endAngle,this.startAngle,true);ctx.closePath();ctx.strokeStyle=this.strokeColor;ctx.lineWidth=this.strokeWidth;ctx.fillStyle=this.fillColor;ctx.fill();ctx.lineJoin="bevel";if(this.showStroke){ctx.stroke()}}});Chart.Rectangle=Chart.Element.extend({draw:function(){var ctx=this.ctx,halfWidth=this.width/2,leftX=this.x-halfWidth,rightX=this.x+halfWidth,top=this.base-(this.base-this.y),halfStroke=this.strokeWidth/2;if(this.showStroke){leftX+=halfStroke;rightX-=halfStroke;top+=halfStroke}ctx.beginPath();ctx.fillStyle=this.fillColor;ctx.strokeStyle=this.strokeColor;ctx.lineWidth=this.strokeWidth;ctx.moveTo(leftX,this.base);ctx.lineTo(leftX,top);ctx.lineTo(rightX,top);ctx.lineTo(rightX,this.base);ctx.fill();if(this.showStroke){ctx.stroke()}},height:function(){return this.base-this.y},inRange:function(chartX,chartY){return chartX>=this.x-this.width/2&&chartX<=this.x+this.width/2&&(chartY>=this.y&&chartY<=this.base)}});Chart.Tooltip=Chart.Element.extend({draw:function(){var ctx=this.chart.ctx;ctx.font=fontString(this.fontSize,this.fontStyle,this.fontFamily);this.xAlign="center";this.yAlign="above";var caretPadding=2;var tooltipWidth=ctx.measureText(this.text).width+2*this.xPadding,tooltipRectHeight=this.fontSize+2*this.yPadding,tooltipHeight=tooltipRectHeight+this.caretHeight+caretPadding;if(this.x+tooltipWidth/2>this.chart.width){this.xAlign="left"}else if(this.x-tooltipWidth/2<0){this.xAlign="right"}if(this.y-tooltipHeight<0){this.yAlign="below"}var tooltipX=this.x-tooltipWidth/2,tooltipY=this.y-tooltipHeight;ctx.fillStyle=this.fillColor;switch(this.yAlign){case"above":ctx.beginPath();ctx.moveTo(this.x,this.y-caretPadding);ctx.lineTo(this.x+this.caretHeight,this.y-(caretPadding+this.caretHeight));ctx.lineTo(this.x-this.caretHeight,this.y-(caretPadding+this.caretHeight));ctx.closePath();ctx.fill();break;case"below":tooltipY=this.y+caretPadding+this.caretHeight;ctx.beginPath();ctx.moveTo(this.x,this.y+caretPadding);ctx.lineTo(this.x+this.caretHeight,this.y+caretPadding+this.caretHeight);ctx.lineTo(this.x-this.caretHeight,this.y+caretPadding+this.caretHeight);ctx.closePath();ctx.fill();break}switch(this.xAlign){case"left":tooltipX=this.x-tooltipWidth+(this.cornerRadius+this.caretHeight);break;case"right":tooltipX=this.x-(this.cornerRadius+this.caretHeight);break}drawRoundedRectangle(ctx,tooltipX,tooltipY,tooltipWidth,tooltipRectHeight,this.cornerRadius);ctx.fill();ctx.fillStyle=this.textColor;ctx.textAlign="center";ctx.textBaseline="middle";ctx.fillText(this.text,tooltipX+tooltipWidth/2,tooltipY+tooltipRectHeight/2)}});Chart.MultiTooltip=Chart.Element.extend({initialize:function(){this.font=fontString(this.fontSize,this.fontStyle,this.fontFamily);this.titleFont=fontString(this.titleFontSize,this.titleFontStyle,this.titleFontFamily);this.height=this.labels.length*this.fontSize+(this.labels.length-1)*(this.fontSize/2)+this.yPadding*2+this.titleFontSize*1.5;this.ctx.font=this.titleFont;var titleWidth=this.ctx.measureText(this.title).width,labelWidth=longestText(this.ctx,this.font,this.labels)+this.fontSize+3,longestTextWidth=max([labelWidth,titleWidth]);this.width=longestTextWidth+this.xPadding*2;var halfHeight=this.height/2;if(this.y-halfHeight<0){this.y=halfHeight}else if(this.y+halfHeight>this.chart.height){this.y=this.chart.height-halfHeight}if(this.x>this.chart.width/2){this.x-=this.xOffset+this.width}else{this.x+=this.xOffset}},getLineHeight:function(index){var baseLineHeight=this.y-this.height/2+this.yPadding,afterTitleIndex=index-1;if(index===0){return baseLineHeight+this.titleFontSize/2}else{return baseLineHeight+(this.fontSize*1.5*afterTitleIndex+this.fontSize/2)+this.titleFontSize*1.5}},draw:function(){drawRoundedRectangle(this.ctx,this.x,this.y-this.height/2,this.width,this.height,this.cornerRadius);var ctx=this.ctx;ctx.fillStyle=this.fillColor;ctx.fill();ctx.closePath();ctx.textAlign="left";ctx.textBaseline="middle";ctx.fillStyle=this.titleTextColor;ctx.font=this.titleFont;ctx.fillText(this.title,this.x+this.xPadding,this.getLineHeight(0));ctx.font=this.font;helpers.each(this.labels,function(label,index){ctx.fillStyle=this.textColor;ctx.fillText(label,this.x+this.xPadding+this.fontSize+3,this.getLineHeight(index+1));ctx.fillStyle=this.legendColorBackground;ctx.fillRect(this.x+this.xPadding,this.getLineHeight(index+1)-this.fontSize/2,this.fontSize,this.fontSize);ctx.fillStyle=this.legendColors[index].fill;ctx.fillRect(this.x+this.xPadding,this.getLineHeight(index+1)-this.fontSize/2,this.fontSize,this.fontSize)},this)}});Chart.Scale=Chart.Element.extend({initialize:function(){this.fit()},buildYLabels:function(){this.yLabels=[];var stepDecimalPlaces=getDecimalPlaces(this.stepValue);for(var i=0;i<=this.steps;i++){this.yLabels.push(template(this.templateString,{value:(this.min+i*this.stepValue).toFixed(stepDecimalPlaces)}))}this.yLabelWidth=this.display&&this.showLabels?longestText(this.ctx,this.font,this.yLabels):0},addXLabel:function(label){this.xLabels.push(label);this.valuesCount++;this.fit()},removeXLabel:function(){this.xLabels.shift();this.valuesCount--;this.fit()},fit:function(){this.startPoint=this.display?this.fontSize:0;this.endPoint=this.display?this.height-this.fontSize*1.5-5:this.height;this.startPoint+=this.padding;this.endPoint-=this.padding;var cachedHeight=this.endPoint-this.startPoint,cachedYLabelWidth;this.calculateYRange(cachedHeight);this.buildYLabels();this.calculateXLabelRotation();while(cachedHeight>this.endPoint-this.startPoint){cachedHeight=this.endPoint-this.startPoint;cachedYLabelWidth=this.yLabelWidth;this.calculateYRange(cachedHeight);this.buildYLabels();if(cachedYLabelWidth<this.yLabelWidth){this.calculateXLabelRotation()}}},calculateXLabelRotation:function(){this.ctx.font=this.font;var firstWidth=this.ctx.measureText(this.xLabels[0]).width,lastWidth=this.ctx.measureText(this.xLabels[this.xLabels.length-1]).width,firstRotated,lastRotated;this.xScalePaddingRight=lastWidth/2+3;this.xScalePaddingLeft=firstWidth/2>this.yLabelWidth+10?firstWidth/2:this.yLabelWidth+10;this.xLabelRotation=0;if(this.display){var originalLabelWidth=longestText(this.ctx,this.font,this.xLabels),cosRotation,firstRotatedWidth;this.xLabelWidth=originalLabelWidth;var xGridWidth=Math.floor(this.calculateX(1)-this.calculateX(0))-6;while(this.xLabelWidth>xGridWidth&&this.xLabelRotation===0||this.xLabelWidth>xGridWidth&&this.xLabelRotation<=90&&this.xLabelRotation>0){cosRotation=Math.cos(toRadians(this.xLabelRotation));firstRotated=cosRotation*firstWidth;lastRotated=cosRotation*lastWidth;if(firstRotated+this.fontSize/2>this.yLabelWidth+8){this.xScalePaddingLeft=firstRotated+this.fontSize/2}this.xScalePaddingRight=this.fontSize/2;this.xLabelRotation++;this.xLabelWidth=cosRotation*originalLabelWidth}if(this.xLabelRotation>0){this.endPoint-=Math.sin(toRadians(this.xLabelRotation))*originalLabelWidth+3}}else{this.xLabelWidth=0;this.xScalePaddingRight=this.padding;this.xScalePaddingLeft=this.padding}},calculateYRange:noop,drawingArea:function(){return this.startPoint-this.endPoint},calculateY:function(value){var scalingFactor=this.drawingArea()/(this.min-this.max);return this.endPoint-scalingFactor*(value-this.min)},calculateX:function(index){var isRotated=this.xLabelRotation>0,innerWidth=this.width-(this.xScalePaddingLeft+this.xScalePaddingRight),valueWidth=innerWidth/(this.valuesCount-(this.offsetGridLines?0:1)),valueOffset=valueWidth*index+this.xScalePaddingLeft;if(this.offsetGridLines){valueOffset+=valueWidth/2}return Math.round(valueOffset)},update:function(newProps){helpers.extend(this,newProps);this.fit()},draw:function(){var ctx=this.ctx,yLabelGap=(this.endPoint-this.startPoint)/this.steps,xStart=Math.round(this.xScalePaddingLeft);if(this.display){ctx.fillStyle=this.textColor;ctx.font=this.font;each(this.yLabels,function(labelString,index){var yLabelCenter=this.endPoint-yLabelGap*index,linePositionY=Math.round(yLabelCenter);ctx.textAlign="right";ctx.textBaseline="middle";if(this.showLabels){ctx.fillText(labelString,xStart-10,yLabelCenter)}ctx.beginPath();if(index>0){ctx.lineWidth=this.gridLineWidth;ctx.strokeStyle=this.gridLineColor}else{ctx.lineWidth=this.lineWidth;ctx.strokeStyle=this.lineColor}linePositionY+=helpers.aliasPixel(ctx.lineWidth);ctx.moveTo(xStart,linePositionY);ctx.lineTo(this.width,linePositionY);ctx.stroke();ctx.closePath();ctx.lineWidth=this.lineWidth;ctx.strokeStyle=this.lineColor;ctx.beginPath();ctx.moveTo(xStart-5,linePositionY);ctx.lineTo(xStart,linePositionY);ctx.stroke();ctx.closePath()},this);each(this.xLabels,function(label,index){var xPos=this.calculateX(index)+aliasPixel(this.lineWidth),linePos=this.calculateX(index-(this.offsetGridLines?.5:0))+aliasPixel(this.lineWidth),isRotated=this.xLabelRotation>0;ctx.beginPath();if(index>0){ctx.lineWidth=this.gridLineWidth;ctx.strokeStyle=this.gridLineColor}else{ctx.lineWidth=this.lineWidth;ctx.strokeStyle=this.lineColor}ctx.moveTo(linePos,this.endPoint);ctx.lineTo(linePos,this.startPoint-3);ctx.stroke();ctx.closePath();ctx.lineWidth=this.lineWidth;ctx.strokeStyle=this.lineColor;ctx.beginPath();ctx.moveTo(linePos,this.endPoint);ctx.lineTo(linePos,this.endPoint+5);ctx.stroke();ctx.closePath();ctx.save();
ctx.translate(xPos,isRotated?this.endPoint+12:this.endPoint+8);ctx.rotate(toRadians(this.xLabelRotation)*-1);ctx.font=this.font;ctx.textAlign=isRotated?"right":"center";ctx.textBaseline=isRotated?"middle":"top";ctx.fillText(label,0,0);ctx.restore()},this)}}});Chart.RadialScale=Chart.Element.extend({initialize:function(){this.size=min([this.height,this.width]);this.drawingArea=this.display?this.size/2-(this.fontSize/2+this.backdropPaddingY):this.size/2},calculateCenterOffset:function(value){var scalingFactor=this.drawingArea/(this.max-this.min);return(value-this.min)*scalingFactor},update:function(){if(!this.lineArc){this.setScaleSize()}else{this.drawingArea=this.display?this.size/2-(this.fontSize/2+this.backdropPaddingY):this.size/2}this.buildYLabels()},buildYLabels:function(){this.yLabels=[];var stepDecimalPlaces=getDecimalPlaces(this.stepValue);for(var i=0;i<=this.steps;i++){this.yLabels.push(template(this.templateString,{value:(this.min+i*this.stepValue).toFixed(stepDecimalPlaces)}))}},getCircumference:function(){return Math.PI*2/this.valuesCount},setScaleSize:function(){var largestPossibleRadius=min([this.height/2-this.pointLabelFontSize-5,this.width/2]),pointPosition,i,textWidth,halfTextWidth,furthestRight=this.width,furthestRightIndex,furthestRightAngle,furthestLeft=0,furthestLeftIndex,furthestLeftAngle,xProtrusionLeft,xProtrusionRight,radiusReductionRight,radiusReductionLeft,maxWidthRadius;this.ctx.font=fontString(this.pointLabelFontSize,this.pointLabelFontStyle,this.pointLabelFontFamily);for(i=0;i<this.valuesCount;i++){pointPosition=this.getPointPosition(i,largestPossibleRadius);textWidth=this.ctx.measureText(template(this.templateString,{value:this.labels[i]})).width+5;if(i===0||i===this.valuesCount/2){halfTextWidth=textWidth/2;if(pointPosition.x+halfTextWidth>furthestRight){furthestRight=pointPosition.x+halfTextWidth;furthestRightIndex=i}if(pointPosition.x-halfTextWidth<furthestLeft){furthestLeft=pointPosition.x-halfTextWidth;furthestLeftIndex=i}}else if(i<this.valuesCount/2){if(pointPosition.x+textWidth>furthestRight){furthestRight=pointPosition.x+textWidth;furthestRightIndex=i}}else if(i>this.valuesCount/2){if(pointPosition.x-textWidth<furthestLeft){furthestLeft=pointPosition.x-textWidth;furthestLeftIndex=i}}}xProtrusionLeft=furthestLeft;xProtrusionRight=Math.ceil(furthestRight-this.width);furthestRightAngle=this.getIndexAngle(furthestRightIndex);furthestLeftAngle=this.getIndexAngle(furthestLeftIndex);radiusReductionRight=xProtrusionRight/Math.sin(furthestRightAngle+Math.PI/2);radiusReductionLeft=xProtrusionLeft/Math.sin(furthestLeftAngle+Math.PI/2);radiusReductionRight=isNumber(radiusReductionRight)?radiusReductionRight:0;radiusReductionLeft=isNumber(radiusReductionLeft)?radiusReductionLeft:0;this.drawingArea=largestPossibleRadius-(radiusReductionLeft+radiusReductionRight)/2;this.setCenterPoint(radiusReductionLeft,radiusReductionRight)},setCenterPoint:function(leftMovement,rightMovement){var maxRight=this.width-rightMovement-this.drawingArea,maxLeft=leftMovement+this.drawingArea;this.xCenter=(maxLeft+maxRight)/2;this.yCenter=this.height/2},getIndexAngle:function(index){var angleMultiplier=Math.PI*2/this.valuesCount;return index*angleMultiplier-Math.PI/2},getPointPosition:function(index,distanceFromCenter){var thisAngle=this.getIndexAngle(index);return{x:Math.cos(thisAngle)*distanceFromCenter+this.xCenter,y:Math.sin(thisAngle)*distanceFromCenter+this.yCenter}},draw:function(){if(this.display){var ctx=this.ctx;each(this.yLabels,function(label,index){if(index>0){var yCenterOffset=index*(this.drawingArea/this.steps),yHeight=this.yCenter-yCenterOffset,pointPosition;if(this.lineWidth>0){ctx.strokeStyle=this.lineColor;ctx.lineWidth=this.lineWidth;if(this.lineArc){ctx.beginPath();ctx.arc(this.xCenter,this.yCenter,yCenterOffset,0,Math.PI*2);ctx.closePath();ctx.stroke()}else{ctx.beginPath();for(var i=0;i<this.valuesCount;i++){pointPosition=this.getPointPosition(i,this.calculateCenterOffset(this.min+index*this.stepValue));if(i===0){ctx.moveTo(pointPosition.x,pointPosition.y)}else{ctx.lineTo(pointPosition.x,pointPosition.y)}}ctx.closePath();ctx.stroke()}}if(this.showLabels){ctx.font=fontString(this.fontSize,this.fontStyle,this.fontFamily);if(this.showLabelBackdrop){var labelWidth=ctx.measureText(label).width;ctx.fillStyle=this.backdropColor;ctx.fillRect(this.xCenter-labelWidth/2-this.backdropPaddingX,yHeight-this.fontSize/2-this.backdropPaddingY,labelWidth+this.backdropPaddingX*2,this.fontSize+this.backdropPaddingY*2)}ctx.textAlign="center";ctx.textBaseline="middle";ctx.fillStyle=this.fontColor;ctx.fillText(label,this.xCenter,yHeight)}}},this);if(!this.lineArc){ctx.lineWidth=this.angleLineWidth;ctx.strokeStyle=this.angleLineColor;for(var i=this.valuesCount-1;i>=0;i--){if(this.angleLineWidth>0){var outerPosition=this.getPointPosition(i,this.calculateCenterOffset(this.max));ctx.beginPath();ctx.moveTo(this.xCenter,this.yCenter);ctx.lineTo(outerPosition.x,outerPosition.y);ctx.stroke();ctx.closePath()}var pointLabelPosition=this.getPointPosition(i,this.calculateCenterOffset(this.max)+5);ctx.font=fontString(this.pointLabelFontSize,this.pointLabelFontStyle,this.pointLabelFontFamily);ctx.fillStyle=this.pointLabelFontColor;var labelsCount=this.labels.length,halfLabelsCount=this.labels.length/2,quarterLabelsCount=halfLabelsCount/2,upperHalf=i<quarterLabelsCount||i>labelsCount-quarterLabelsCount,exactQuarter=i===quarterLabelsCount||i===labelsCount-quarterLabelsCount;if(i===0){ctx.textAlign="center"}else if(i===halfLabelsCount){ctx.textAlign="center"}else if(i<halfLabelsCount){ctx.textAlign="left"}else{ctx.textAlign="right"}if(exactQuarter){ctx.textBaseline="middle"}else if(upperHalf){ctx.textBaseline="bottom"}else{ctx.textBaseline="top"}ctx.fillText(this.labels[i],pointLabelPosition.x,pointLabelPosition.y)}}}}});helpers.addEvent(window,"resize",function(){var timeout;return function(){clearTimeout(timeout);timeout=setTimeout(function(){each(Chart.instances,function(instance){if(instance.options.responsive){instance.resize(instance.render,true)}})},50)}}());if(amd){define('lib/chart',[],function(){return Chart})}else if(typeof module==="object"&&module.exports){module.exports=Chart}root.Chart=Chart;Chart.noConflict=function(){root.Chart=previous;return Chart}}).call(this);(function(){var root=this,Chart=root.Chart,helpers=Chart.helpers;var defaultConfig={scaleBeginAtZero:true,scaleShowGridLines:true,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,barShowStroke:true,barStrokeWidth:2,barValueSpacing:5,barDatasetSpacing:1,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].fillColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>'};Chart.Type.extend({name:"Bar",defaults:defaultConfig,initialize:function(data){var options=this.options;this.ScaleClass=Chart.Scale.extend({offsetGridLines:true,calculateBarX:function(datasetCount,datasetIndex,barIndex){var xWidth=this.calculateBaseWidth(),xAbsolute=this.calculateX(barIndex)-xWidth/2,barWidth=this.calculateBarWidth(datasetCount);return xAbsolute+barWidth*datasetIndex+datasetIndex*options.barDatasetSpacing+barWidth/2},calculateBaseWidth:function(){return this.calculateX(1)-this.calculateX(0)-2*options.barValueSpacing},calculateBarWidth:function(datasetCount){var baseWidth=this.calculateBaseWidth()-(datasetCount-1)*options.barDatasetSpacing;return baseWidth/datasetCount}});this.datasets=[];if(this.options.showTooltips){helpers.bindEvents(this,this.options.tooltipEvents,function(evt){var activeBars=evt.type!=="mouseout"?this.getBarsAtEvent(evt):[];this.eachBars(function(bar){bar.restore(["fillColor","strokeColor"])});helpers.each(activeBars,function(activeBar){activeBar.fillColor=activeBar.highlightFill;activeBar.strokeColor=activeBar.highlightStroke});this.showTooltip(activeBars)})}this.BarClass=Chart.Rectangle.extend({strokeWidth:this.options.barStrokeWidth,showStroke:this.options.barShowStroke,ctx:this.chart.ctx});helpers.each(data.datasets,function(dataset,datasetIndex){var datasetObject={label:dataset.label||null,fillColor:dataset.fillColor,strokeColor:dataset.strokeColor,bars:[]};this.datasets.push(datasetObject);helpers.each(dataset.data,function(dataPoint,index){datasetObject.bars.push(new this.BarClass({value:dataPoint,label:data.labels[index],datasetLabel:dataset.label,strokeColor:dataset.strokeColor,fillColor:dataset.fillColor,highlightFill:dataset.highlightFill||dataset.fillColor,highlightStroke:dataset.highlightStroke||dataset.strokeColor}))},this)},this);this.buildScale(data.labels);this.BarClass.prototype.base=this.scale.endPoint;this.eachBars(function(bar,index,datasetIndex){helpers.extend(bar,{width:this.scale.calculateBarWidth(this.datasets.length),x:this.scale.calculateBarX(this.datasets.length,datasetIndex,index),y:this.scale.endPoint});bar.save()},this);this.render()},update:function(){this.scale.update();helpers.each(this.activeElements,function(activeElement){activeElement.restore(["fillColor","strokeColor"])});this.eachBars(function(bar){bar.save()});this.render()},eachBars:function(callback){helpers.each(this.datasets,function(dataset,datasetIndex){helpers.each(dataset.bars,callback,this,datasetIndex)},this)},getBarsAtEvent:function(e){var barsArray=[],eventPosition=helpers.getRelativePosition(e),datasetIterator=function(dataset){barsArray.push(dataset.bars[barIndex])},barIndex;for(var datasetIndex=0;datasetIndex<this.datasets.length;datasetIndex++){for(barIndex=0;barIndex<this.datasets[datasetIndex].bars.length;barIndex++){if(this.datasets[datasetIndex].bars[barIndex].inRange(eventPosition.x,eventPosition.y)){helpers.each(this.datasets,datasetIterator);return barsArray}}}return barsArray},buildScale:function(labels){var self=this;var dataTotal=function(){var values=[];self.eachBars(function(bar){values.push(bar.value)});return values};var scaleOptions={templateString:this.options.scaleLabel,height:this.chart.height,width:this.chart.width,ctx:this.chart.ctx,textColor:this.options.scaleFontColor,fontSize:this.options.scaleFontSize,fontStyle:this.options.scaleFontStyle,fontFamily:this.options.scaleFontFamily,valuesCount:labels.length,beginAtZero:this.options.scaleBeginAtZero,integersOnly:this.options.scaleIntegersOnly,calculateYRange:function(currentHeight){var updatedRanges=helpers.calculateScaleRange(dataTotal(),currentHeight,this.fontSize,this.beginAtZero,this.integersOnly);helpers.extend(this,updatedRanges)},xLabels:labels,font:helpers.fontString(this.options.scaleFontSize,this.options.scaleFontStyle,this.options.scaleFontFamily),lineWidth:this.options.scaleLineWidth,lineColor:this.options.scaleLineColor,gridLineWidth:this.options.scaleShowGridLines?this.options.scaleGridLineWidth:0,gridLineColor:this.options.scaleShowGridLines?this.options.scaleGridLineColor:"rgba(0,0,0,0)",padding:this.options.showScale?0:this.options.barShowStroke?this.options.barStrokeWidth:0,showLabels:this.options.scaleShowLabels,display:this.options.showScale};if(this.options.scaleOverride){helpers.extend(scaleOptions,{calculateYRange:helpers.noop,steps:this.options.scaleSteps,stepValue:this.options.scaleStepWidth,min:this.options.scaleStartValue,max:this.options.scaleStartValue+this.options.scaleSteps*this.options.scaleStepWidth})}this.scale=new this.ScaleClass(scaleOptions)},addData:function(valuesArray,label){helpers.each(valuesArray,function(value,datasetIndex){this.datasets[datasetIndex].bars.push(new this.BarClass({value:value,label:label,x:this.scale.calculateBarX(this.datasets.length,datasetIndex,this.scale.valuesCount+1),y:this.scale.endPoint,width:this.scale.calculateBarWidth(this.datasets.length),base:this.scale.endPoint,strokeColor:this.datasets[datasetIndex].strokeColor,fillColor:this.datasets[datasetIndex].fillColor}))},this);this.scale.addXLabel(label);this.update()},removeData:function(){this.scale.removeXLabel();helpers.each(this.datasets,function(dataset){dataset.bars.shift()},this);this.update()},reflow:function(){helpers.extend(this.BarClass.prototype,{y:this.scale.endPoint,base:this.scale.endPoint});var newScaleProps=helpers.extend({height:this.chart.height,width:this.chart.width});this.scale.update(newScaleProps)},draw:function(ease){var easingDecimal=ease||1;this.clear();var ctx=this.chart.ctx;this.scale.draw(easingDecimal);helpers.each(this.datasets,function(dataset,datasetIndex){helpers.each(dataset.bars,function(bar,index){if(bar.hasValue()){bar.base=this.scale.endPoint;bar.transition({x:this.scale.calculateBarX(this.datasets.length,datasetIndex,index),y:this.scale.calculateY(bar.value),width:this.scale.calculateBarWidth(this.datasets.length)},easingDecimal).draw()}},this)},this)}})}).call(this);(function(){var root=this,Chart=root.Chart,helpers=Chart.helpers;var defaultConfig={segmentShowStroke:true,segmentStrokeColor:"#fff",segmentStrokeWidth:2,percentageInnerCutout:50,animationSteps:100,animationEasing:"easeOutBounce",animateRotate:true,animateScale:false,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<segments.length; i++){%><li><span style="background-color:<%=segments[i].fillColor%>"></span><%if(segments[i].label){%><%=segments[i].label%><%}%></li><%}%></ul>'};Chart.Type.extend({name:"Doughnut",defaults:defaultConfig,initialize:function(data){this.segments=[];this.outerRadius=(helpers.min([this.chart.width,this.chart.height])-this.options.segmentStrokeWidth/2)/2;this.SegmentArc=Chart.Arc.extend({ctx:this.chart.ctx,x:this.chart.width/2,y:this.chart.height/2});if(this.options.showTooltips){helpers.bindEvents(this,this.options.tooltipEvents,function(evt){var activeSegments=evt.type!=="mouseout"?this.getSegmentsAtEvent(evt):[];helpers.each(this.segments,function(segment){segment.restore(["fillColor"])});helpers.each(activeSegments,function(activeSegment){activeSegment.fillColor=activeSegment.highlightColor});this.showTooltip(activeSegments)})}this.calculateTotal(data);helpers.each(data,function(datapoint,index){this.addData(datapoint,index,true)},this);this.render()},getSegmentsAtEvent:function(e){var segmentsArray=[];var location=helpers.getRelativePosition(e);helpers.each(this.segments,function(segment){if(segment.inRange(location.x,location.y))segmentsArray.push(segment)},this);return segmentsArray},addData:function(segment,atIndex,silent){var index=atIndex||this.segments.length;this.segments.splice(index,0,new this.SegmentArc({value:segment.value,outerRadius:this.options.animateScale?0:this.outerRadius,innerRadius:this.options.animateScale?0:this.outerRadius/100*this.options.percentageInnerCutout,fillColor:segment.color,highlightColor:segment.highlight||segment.color,showStroke:this.options.segmentShowStroke,strokeWidth:this.options.segmentStrokeWidth,strokeColor:this.options.segmentStrokeColor,startAngle:Math.PI*1.5,circumference:this.options.animateRotate?0:this.calculateCircumference(segment.value),label:segment.label}));if(!silent){this.reflow();this.update()}},calculateCircumference:function(value){return Math.PI*2*(value/this.total)},calculateTotal:function(data){this.total=0;helpers.each(data,function(segment){this.total+=segment.value},this)},update:function(){this.calculateTotal(this.segments);helpers.each(this.activeElements,function(activeElement){activeElement.restore(["fillColor"])});helpers.each(this.segments,function(segment){segment.save()});this.render()},removeData:function(atIndex){var indexToDelete=helpers.isNumber(atIndex)?atIndex:this.segments.length-1;this.segments.splice(indexToDelete,1);this.reflow();this.update()},reflow:function(){helpers.extend(this.SegmentArc.prototype,{x:this.chart.width/2,y:this.chart.height/2});this.outerRadius=(helpers.min([this.chart.width,this.chart.height])-this.options.segmentStrokeWidth/2)/2;helpers.each(this.segments,function(segment){segment.update({outerRadius:this.outerRadius,innerRadius:this.outerRadius/100*this.options.percentageInnerCutout})},this)},draw:function(easeDecimal){var animDecimal=easeDecimal?easeDecimal:1;this.clear();helpers.each(this.segments,function(segment,index){segment.transition({circumference:this.calculateCircumference(segment.value),outerRadius:this.outerRadius,innerRadius:this.outerRadius/100*this.options.percentageInnerCutout},animDecimal);segment.endAngle=segment.startAngle+segment.circumference;segment.draw();if(index===0){segment.startAngle=Math.PI*1.5}if(index<this.segments.length-1){this.segments[index+1].startAngle=segment.endAngle}},this)}});Chart.types.Doughnut.extend({name:"Pie",defaults:helpers.merge(defaultConfig,{percentageInnerCutout:0})})}).call(this);(function(){var root=this,Chart=root.Chart,helpers=Chart.helpers;var defaultConfig={scaleShowGridLines:true,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,bezierCurve:true,bezierCurveTension:.4,pointDot:true,pointDotRadius:4,pointDotStrokeWidth:1,pointHitDetectionRadius:20,datasetStroke:true,datasetStrokeWidth:2,datasetFill:true,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].strokeColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>'};Chart.Type.extend({name:"Line",defaults:defaultConfig,initialize:function(data){this.PointClass=Chart.Point.extend({strokeWidth:this.options.pointDotStrokeWidth,radius:this.options.pointDotRadius,display:this.options.pointDot,hitDetectionRadius:this.options.pointHitDetectionRadius,ctx:this.chart.ctx,inRange:function(mouseX){return Math.pow(mouseX-this.x,2)<Math.pow(this.radius+this.hitDetectionRadius,2)}});this.datasets=[];if(this.options.showTooltips){helpers.bindEvents(this,this.options.tooltipEvents,function(evt){var activePoints=evt.type!=="mouseout"?this.getPointsAtEvent(evt):[];this.eachPoints(function(point){point.restore(["fillColor","strokeColor"])});helpers.each(activePoints,function(activePoint){activePoint.fillColor=activePoint.highlightFill;activePoint.strokeColor=activePoint.highlightStroke});this.showTooltip(activePoints)})}helpers.each(data.datasets,function(dataset){var datasetObject={label:dataset.label||null,fillColor:dataset.fillColor,strokeColor:dataset.strokeColor,pointColor:dataset.pointColor,pointStrokeColor:dataset.pointStrokeColor,points:[]};this.datasets.push(datasetObject);helpers.each(dataset.data,function(dataPoint,index){datasetObject.points.push(new this.PointClass({value:dataPoint,label:data.labels[index],datasetLabel:dataset.label,strokeColor:dataset.pointStrokeColor,fillColor:dataset.pointColor,highlightFill:dataset.pointHighlightFill||dataset.pointColor,highlightStroke:dataset.pointHighlightStroke||dataset.pointStrokeColor}))},this);this.buildScale(data.labels);this.eachPoints(function(point,index){helpers.extend(point,{x:this.scale.calculateX(index),y:this.scale.endPoint});point.save()},this)},this);this.render()},update:function(){this.scale.update();helpers.each(this.activeElements,function(activeElement){activeElement.restore(["fillColor","strokeColor"])});this.eachPoints(function(point){point.save()});this.render()},eachPoints:function(callback){helpers.each(this.datasets,function(dataset){helpers.each(dataset.points,callback,this)},this)},getPointsAtEvent:function(e){var pointsArray=[],eventPosition=helpers.getRelativePosition(e);helpers.each(this.datasets,function(dataset){helpers.each(dataset.points,function(point){if(point.inRange(eventPosition.x,eventPosition.y))pointsArray.push(point)})},this);return pointsArray},buildScale:function(labels){var self=this;var dataTotal=function(){var values=[];self.eachPoints(function(point){values.push(point.value)});return values};var scaleOptions={templateString:this.options.scaleLabel,height:this.chart.height,width:this.chart.width,ctx:this.chart.ctx,textColor:this.options.scaleFontColor,fontSize:this.options.scaleFontSize,fontStyle:this.options.scaleFontStyle,fontFamily:this.options.scaleFontFamily,valuesCount:labels.length,beginAtZero:this.options.scaleBeginAtZero,integersOnly:this.options.scaleIntegersOnly,calculateYRange:function(currentHeight){var updatedRanges=helpers.calculateScaleRange(dataTotal(),currentHeight,this.fontSize,this.beginAtZero,this.integersOnly);helpers.extend(this,updatedRanges)},xLabels:labels,font:helpers.fontString(this.options.scaleFontSize,this.options.scaleFontStyle,this.options.scaleFontFamily),lineWidth:this.options.scaleLineWidth,lineColor:this.options.scaleLineColor,gridLineWidth:this.options.scaleShowGridLines?this.options.scaleGridLineWidth:0,gridLineColor:this.options.scaleShowGridLines?this.options.scaleGridLineColor:"rgba(0,0,0,0)",padding:this.options.showScale?0:this.options.pointDotRadius+this.options.pointDotStrokeWidth,showLabels:this.options.scaleShowLabels,display:this.options.showScale};if(this.options.scaleOverride){helpers.extend(scaleOptions,{calculateYRange:helpers.noop,steps:this.options.scaleSteps,stepValue:this.options.scaleStepWidth,min:this.options.scaleStartValue,max:this.options.scaleStartValue+this.options.scaleSteps*this.options.scaleStepWidth})}this.scale=new Chart.Scale(scaleOptions)},addData:function(valuesArray,label){helpers.each(valuesArray,function(value,datasetIndex){this.datasets[datasetIndex].points.push(new this.PointClass({value:value,label:label,x:this.scale.calculateX(this.scale.valuesCount+1),y:this.scale.endPoint,strokeColor:this.datasets[datasetIndex].pointStrokeColor,fillColor:this.datasets[datasetIndex].pointColor}))},this);this.scale.addXLabel(label);this.update()},removeData:function(){this.scale.removeXLabel();helpers.each(this.datasets,function(dataset){dataset.points.shift()},this);this.update()},reflow:function(){var newScaleProps=helpers.extend({height:this.chart.height,width:this.chart.width});this.scale.update(newScaleProps)},draw:function(ease){var easingDecimal=ease||1;this.clear();var ctx=this.chart.ctx;var hasValue=function(item){return item.value!==null},nextPoint=function(point,collection,index){return helpers.findNextWhere(collection,hasValue,index)||point},previousPoint=function(point,collection,index){return helpers.findPreviousWhere(collection,hasValue,index)||point};this.scale.draw(easingDecimal);helpers.each(this.datasets,function(dataset){var pointsWithValues=helpers.where(dataset.points,hasValue);helpers.each(dataset.points,function(point,index){if(point.hasValue()){point.transition({y:this.scale.calculateY(point.value),x:this.scale.calculateX(index)},easingDecimal)}},this);if(this.options.bezierCurve){helpers.each(pointsWithValues,function(point,index){var tension=index>0&&index<pointsWithValues.length-1?this.options.bezierCurveTension:0;point.controlPoints=helpers.splineCurve(previousPoint(point,pointsWithValues,index),point,nextPoint(point,pointsWithValues,index),tension);if(point.controlPoints.outer.y>this.scale.endPoint){point.controlPoints.outer.y=this.scale.endPoint}else if(point.controlPoints.outer.y<this.scale.startPoint){point.controlPoints.outer.y=this.scale.startPoint}if(point.controlPoints.inner.y>this.scale.endPoint){point.controlPoints.inner.y=this.scale.endPoint}else if(point.controlPoints.inner.y<this.scale.startPoint){point.controlPoints.inner.y=this.scale.startPoint}},this)}ctx.lineWidth=this.options.datasetStrokeWidth;ctx.strokeStyle=dataset.strokeColor;ctx.beginPath();helpers.each(pointsWithValues,function(point,index){if(index===0){ctx.moveTo(point.x,point.y)}else{if(this.options.bezierCurve){var previous=previousPoint(point,pointsWithValues,index);ctx.bezierCurveTo(previous.controlPoints.outer.x,previous.controlPoints.outer.y,point.controlPoints.inner.x,point.controlPoints.inner.y,point.x,point.y)}else{ctx.lineTo(point.x,point.y)}}},this);ctx.stroke();if(this.options.datasetFill&&pointsWithValues.length>0){ctx.lineTo(pointsWithValues[pointsWithValues.length-1].x,this.scale.endPoint);ctx.lineTo(pointsWithValues[0].x,this.scale.endPoint);ctx.fillStyle=dataset.fillColor;ctx.closePath();ctx.fill()}helpers.each(pointsWithValues,function(point){point.draw()})},this)}})}).call(this);(function(){var root=this,Chart=root.Chart,helpers=Chart.helpers;var defaultConfig={scaleShowLabelBackdrop:true,scaleBackdropColor:"rgba(255,255,255,0.75)",scaleBeginAtZero:true,scaleBackdropPaddingY:2,scaleBackdropPaddingX:2,scaleShowLine:true,segmentShowStroke:true,segmentStrokeColor:"#fff",segmentStrokeWidth:2,animationSteps:100,animationEasing:"easeOutBounce",animateRotate:true,animateScale:false,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<segments.length; i++){%><li><span style="background-color:<%=segments[i].fillColor%>"></span><%if(segments[i].label){%><%=segments[i].label%><%}%></li><%}%></ul>'};Chart.Type.extend({name:"PolarArea",defaults:defaultConfig,initialize:function(data){this.segments=[];this.SegmentArc=Chart.Arc.extend({showStroke:this.options.segmentShowStroke,strokeWidth:this.options.segmentStrokeWidth,strokeColor:this.options.segmentStrokeColor,ctx:this.chart.ctx,innerRadius:0,x:this.chart.width/2,y:this.chart.height/2});this.scale=new Chart.RadialScale({display:this.options.showScale,fontStyle:this.options.scaleFontStyle,fontSize:this.options.scaleFontSize,fontFamily:this.options.scaleFontFamily,fontColor:this.options.scaleFontColor,showLabels:this.options.scaleShowLabels,showLabelBackdrop:this.options.scaleShowLabelBackdrop,backdropColor:this.options.scaleBackdropColor,backdropPaddingY:this.options.scaleBackdropPaddingY,backdropPaddingX:this.options.scaleBackdropPaddingX,lineWidth:this.options.scaleShowLine?this.options.scaleLineWidth:0,lineColor:this.options.scaleLineColor,lineArc:true,width:this.chart.width,height:this.chart.height,xCenter:this.chart.width/2,yCenter:this.chart.height/2,ctx:this.chart.ctx,templateString:this.options.scaleLabel,valuesCount:data.length});this.updateScaleRange(data);this.scale.update();helpers.each(data,function(segment,index){this.addData(segment,index,true)},this);if(this.options.showTooltips){helpers.bindEvents(this,this.options.tooltipEvents,function(evt){var activeSegments=evt.type!=="mouseout"?this.getSegmentsAtEvent(evt):[];helpers.each(this.segments,function(segment){segment.restore(["fillColor"])});helpers.each(activeSegments,function(activeSegment){activeSegment.fillColor=activeSegment.highlightColor});this.showTooltip(activeSegments)})}this.render()},getSegmentsAtEvent:function(e){var segmentsArray=[];var location=helpers.getRelativePosition(e);helpers.each(this.segments,function(segment){if(segment.inRange(location.x,location.y))segmentsArray.push(segment)},this);return segmentsArray},addData:function(segment,atIndex,silent){var index=atIndex||this.segments.length;this.segments.splice(index,0,new this.SegmentArc({fillColor:segment.color,highlightColor:segment.highlight||segment.color,label:segment.label,value:segment.value,outerRadius:this.options.animateScale?0:this.scale.calculateCenterOffset(segment.value),circumference:this.options.animateRotate?0:this.scale.getCircumference(),startAngle:Math.PI*1.5}));if(!silent){this.reflow();this.update()}},removeData:function(atIndex){var indexToDelete=helpers.isNumber(atIndex)?atIndex:this.segments.length-1;this.segments.splice(indexToDelete,1);this.reflow();this.update()},calculateTotal:function(data){this.total=0;helpers.each(data,function(segment){this.total+=segment.value},this);this.scale.valuesCount=this.segments.length},updateScaleRange:function(datapoints){var valuesArray=[];helpers.each(datapoints,function(segment){valuesArray.push(segment.value)});var scaleSizes=this.options.scaleOverride?{steps:this.options.scaleSteps,stepValue:this.options.scaleStepWidth,min:this.options.scaleStartValue,max:this.options.scaleStartValue+this.options.scaleSteps*this.options.scaleStepWidth}:helpers.calculateScaleRange(valuesArray,helpers.min([this.chart.width,this.chart.height])/2,this.options.scaleFontSize,this.options.scaleBeginAtZero,this.options.scaleIntegersOnly);helpers.extend(this.scale,scaleSizes,{size:helpers.min([this.chart.width,this.chart.height]),xCenter:this.chart.width/2,yCenter:this.chart.height/2})},update:function(){this.calculateTotal(this.segments);helpers.each(this.segments,function(segment){segment.save()});this.render()},reflow:function(){helpers.extend(this.SegmentArc.prototype,{x:this.chart.width/2,y:this.chart.height/2});this.updateScaleRange(this.segments);this.scale.update();helpers.extend(this.scale,{xCenter:this.chart.width/2,yCenter:this.chart.height/2});helpers.each(this.segments,function(segment){segment.update({outerRadius:this.scale.calculateCenterOffset(segment.value)})},this)},draw:function(ease){var easingDecimal=ease||1;this.clear();helpers.each(this.segments,function(segment,index){segment.transition({circumference:this.scale.getCircumference(),outerRadius:this.scale.calculateCenterOffset(segment.value)},easingDecimal);segment.endAngle=segment.startAngle+segment.circumference;if(index===0){segment.startAngle=Math.PI*1.5}if(index<this.segments.length-1){this.segments[index+1].startAngle=segment.endAngle}segment.draw()},this);this.scale.draw()}})}).call(this);(function(){var root=this,Chart=root.Chart,helpers=Chart.helpers;Chart.Type.extend({name:"Radar",defaults:{scaleShowLine:true,angleShowLineOut:true,scaleShowLabels:false,scaleBeginAtZero:true,angleLineColor:"rgba(0,0,0,.1)",angleLineWidth:1,pointLabelFontFamily:"'Arial'",pointLabelFontStyle:"normal",pointLabelFontSize:10,pointLabelFontColor:"#666",pointDot:true,pointDotRadius:3,pointDotStrokeWidth:1,pointHitDetectionRadius:20,datasetStroke:true,datasetStrokeWidth:2,datasetFill:true,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].strokeColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>'},initialize:function(data){this.PointClass=Chart.Point.extend({strokeWidth:this.options.pointDotStrokeWidth,radius:this.options.pointDotRadius,display:this.options.pointDot,hitDetectionRadius:this.options.pointHitDetectionRadius,ctx:this.chart.ctx});this.datasets=[];this.buildScale(data);if(this.options.showTooltips){helpers.bindEvents(this,this.options.tooltipEvents,function(evt){var activePointsCollection=evt.type!=="mouseout"?this.getPointsAtEvent(evt):[];this.eachPoints(function(point){point.restore(["fillColor","strokeColor"])});helpers.each(activePointsCollection,function(activePoint){activePoint.fillColor=activePoint.highlightFill;activePoint.strokeColor=activePoint.highlightStroke});this.showTooltip(activePointsCollection)})}helpers.each(data.datasets,function(dataset){var datasetObject={label:dataset.label||null,fillColor:dataset.fillColor,strokeColor:dataset.strokeColor,pointColor:dataset.pointColor,pointStrokeColor:dataset.pointStrokeColor,points:[]};this.datasets.push(datasetObject);helpers.each(dataset.data,function(dataPoint,index){var pointPosition;if(!this.scale.animation){pointPosition=this.scale.getPointPosition(index,this.scale.calculateCenterOffset(dataPoint))}datasetObject.points.push(new this.PointClass({value:dataPoint,label:data.labels[index],datasetLabel:dataset.label,x:this.options.animation?this.scale.xCenter:pointPosition.x,y:this.options.animation?this.scale.yCenter:pointPosition.y,strokeColor:dataset.pointStrokeColor,fillColor:dataset.pointColor,highlightFill:dataset.pointHighlightFill||dataset.pointColor,highlightStroke:dataset.pointHighlightStroke||dataset.pointStrokeColor}))},this)},this);this.render()},eachPoints:function(callback){helpers.each(this.datasets,function(dataset){helpers.each(dataset.points,callback,this)},this)},getPointsAtEvent:function(evt){var mousePosition=helpers.getRelativePosition(evt),fromCenter=helpers.getAngleFromPoint({x:this.scale.xCenter,y:this.scale.yCenter},mousePosition);var anglePerIndex=Math.PI*2/this.scale.valuesCount,pointIndex=Math.round((fromCenter.angle-Math.PI*1.5)/anglePerIndex),activePointsCollection=[];if(pointIndex>=this.scale.valuesCount||pointIndex<0){pointIndex=0}if(fromCenter.distance<=this.scale.drawingArea){
helpers.each(this.datasets,function(dataset){activePointsCollection.push(dataset.points[pointIndex])})}return activePointsCollection},buildScale:function(data){this.scale=new Chart.RadialScale({display:this.options.showScale,fontStyle:this.options.scaleFontStyle,fontSize:this.options.scaleFontSize,fontFamily:this.options.scaleFontFamily,fontColor:this.options.scaleFontColor,showLabels:this.options.scaleShowLabels,showLabelBackdrop:this.options.scaleShowLabelBackdrop,backdropColor:this.options.scaleBackdropColor,backdropPaddingY:this.options.scaleBackdropPaddingY,backdropPaddingX:this.options.scaleBackdropPaddingX,lineWidth:this.options.scaleShowLine?this.options.scaleLineWidth:0,lineColor:this.options.scaleLineColor,angleLineColor:this.options.angleLineColor,angleLineWidth:this.options.angleShowLineOut?this.options.angleLineWidth:0,pointLabelFontColor:this.options.pointLabelFontColor,pointLabelFontSize:this.options.pointLabelFontSize,pointLabelFontFamily:this.options.pointLabelFontFamily,pointLabelFontStyle:this.options.pointLabelFontStyle,height:this.chart.height,width:this.chart.width,xCenter:this.chart.width/2,yCenter:this.chart.height/2,ctx:this.chart.ctx,templateString:this.options.scaleLabel,labels:data.labels,valuesCount:data.datasets[0].data.length});this.scale.setScaleSize();this.updateScaleRange(data.datasets);this.scale.buildYLabels()},updateScaleRange:function(datasets){var valuesArray=function(){var totalDataArray=[];helpers.each(datasets,function(dataset){if(dataset.data){totalDataArray=totalDataArray.concat(dataset.data)}else{helpers.each(dataset.points,function(point){totalDataArray.push(point.value)})}});return totalDataArray}();var scaleSizes=this.options.scaleOverride?{steps:this.options.scaleSteps,stepValue:this.options.scaleStepWidth,min:this.options.scaleStartValue,max:this.options.scaleStartValue+this.options.scaleSteps*this.options.scaleStepWidth}:helpers.calculateScaleRange(valuesArray,helpers.min([this.chart.width,this.chart.height])/2,this.options.scaleFontSize,this.options.scaleBeginAtZero,this.options.scaleIntegersOnly);helpers.extend(this.scale,scaleSizes)},addData:function(valuesArray,label){this.scale.valuesCount++;helpers.each(valuesArray,function(value,datasetIndex){var pointPosition=this.scale.getPointPosition(this.scale.valuesCount,this.scale.calculateCenterOffset(value));this.datasets[datasetIndex].points.push(new this.PointClass({value:value,label:label,x:pointPosition.x,y:pointPosition.y,strokeColor:this.datasets[datasetIndex].pointStrokeColor,fillColor:this.datasets[datasetIndex].pointColor}))},this);this.scale.labels.push(label);this.reflow();this.update()},removeData:function(){this.scale.valuesCount--;this.scale.labels.shift();helpers.each(this.datasets,function(dataset){dataset.points.shift()},this);this.reflow();this.update()},update:function(){this.eachPoints(function(point){point.save()});this.reflow();this.render()},reflow:function(){helpers.extend(this.scale,{width:this.chart.width,height:this.chart.height,size:helpers.min([this.chart.width,this.chart.height]),xCenter:this.chart.width/2,yCenter:this.chart.height/2});this.updateScaleRange(this.datasets);this.scale.setScaleSize();this.scale.buildYLabels()},draw:function(ease){var easeDecimal=ease||1,ctx=this.chart.ctx;this.clear();this.scale.draw();helpers.each(this.datasets,function(dataset){helpers.each(dataset.points,function(point,index){if(point.hasValue()){point.transition(this.scale.getPointPosition(index,this.scale.calculateCenterOffset(point.value)),easeDecimal)}},this);ctx.lineWidth=this.options.datasetStrokeWidth;ctx.strokeStyle=dataset.strokeColor;ctx.beginPath();helpers.each(dataset.points,function(point,index){if(index===0){ctx.moveTo(point.x,point.y)}else{ctx.lineTo(point.x,point.y)}},this);ctx.closePath();ctx.stroke();ctx.fillStyle=dataset.fillColor;ctx.fill();helpers.each(dataset.points,function(point){if(point.hasValue()){point.draw()}})},this)}})}).call(this);
define('tpl!modals/request_review_modal', function() {return {"request_review":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class="request-review-modal modal"> <div class="modal-header"> <h3>'+((__t=(i18n("")))==null?'':_.escape(__t))+'</h3> </div> <div class="modal-body"> '+((__t=(i18n(" ")))==null?'':_.escape(__t))+' '+((__t=(i18n(" ")))==null?'':_.escape(__t))+' <a href="http://merchantfaq./hc/en-us/articles/205211777-What-is-prohibited-to-sell-on-Wish-" target="_blank"> '+((__t=(i18n(" ")))==null?'':_.escape(__t))+' </a> <br/> <br/> '+((__t=(i18n(",")))==null?'':_.escape(__t))+' </div> <div class="modal-footer"> <button class="close-btn btn">'+((__t=(i18n("")))==null?'':_.escape(__t))+'</button> </div> </div> ';}return __p;}};});

define('view/modal/RequestReviewModal',["underscore","core/bb","core/api","view/modal/BaseModal","tpl!modals/request_review_modal"],function(_,bb,api,BaseModalView,tpl){var RequestReviewModalView=BaseModalView.extend({initialize:function(options){this.template=this.buildTpl(tpl.request_review)},render:function(){var view_el=this.template({});this.launchModal(view_el);return this},events:{"click .close-btn":"closeClicked"},closeClicked:function(){this.closeModal()}});return RequestReviewModalView});
require(["underscore","base_page","core/api","core/i18n","lib/date","view/modal/ReleaseNotesModal","view/modal/AnnouncementModal","view/modal/MerchantExtraInfoModal","view/modal/ConfirmationModal","lib/chart","view/modal/RequestReviewModal","view/OnboardingChecklist"],function(_,base_page,api,i18nModule,dateModule,ReleaseNotesModal,AnnouncementModal,MerchantExtraInfoModal,ConfirmationModal,Chart,RequestReviewModal,OnboardingChecklistView,OnboardingChecklistModal){var i18n=i18nModule.i18n;var stats_ready=function(resp){var dates=[];var fulfillment_dates=[];var shipping_dates=[];var wishes_series=[];var impression_series=[];var num_sold_series=[];var fulfillment_series=[];var fulfillment_series_marker=[];var shiptime_series=[];var shiptime_series_marker=[];var total_wishes=resp.data.total_wishes;var total_impressions=resp.data.total_impressions;var total_emails_sent=resp.data.total_emails_sent;var total_sold=resp.data.total_sold;var acceptable_fulfillment=4*24;var acceptable_shipment=14;if(resp.data.total_sold_num>10){$(".old-merchant").show();$(".new-merchant").hide()}else{$("#payment-amount").css({"margin-left":"0px"});$(".old-merchant").hide();$(".new-merchant").show()}$(".all-merchant").show();$("#loading-content-loader").fadeOut("fast",function(){$("#loading-content").show();if(resp.data.total_sold_num>10){$(".total-wishes").html('<div class="data-pt">'+total_wishes+"</div>");$(".total-impressions").html('<div class="data-pt">'+total_impressions+"</div>");$(".total-sold").html('<div class="data-pt">'+total_sold+"</div>");$(".weekly-impressions").html('<div class="data-pt">'+resp.data.impression_weekly+"</div>");$(".weekly-sales").html('<div class="data-pt">'+resp.data.sales_weekly+"</div>");var msg=i18n("%1$s ",resp.data.fulfillment_avg);$("#fulfillment-avg").text(msg);msg=i18n("%1$s ",resp.data.shiptime_avg);$("#shiptime-avg").text(msg);$("#deliver-confirmed").text(resp.data.deliver_confirmed+"%");$("#tracking-confirmed").text(resp.data.tracking_confirmed+"%");$(".fulfillment-series").text(resp.data.fulfillment_series_start_date+" - "+resp.data.fulfillment_series_end_date);$(".shiptime-series").text(resp.data.shipment_start_date+" - "+resp.data.shipment_end_date);$(".tracking-series").text(resp.data.tracking_confirmed_start_date+" - "+resp.data.tracking_confirmed_end_date);$(".delivered-series").text(resp.data.deliver_confirmed_start_date+" - "+resp.data.deliver_confirmed_end_date);$(".total-series").text(resp.data.total_series_start_date+" - "+resp.data.total_series_end_date);var avg_fulfillment_percentile=Math.round(resp.data.avg_fulfillment_percentile);if(avg_fulfillment_percentile!=0){var afp_div=$(".fulfillment-percentile");var msg=i18n("");afp_div.text(msg)}var avg_shiptime_percentile=Math.round(resp.data.avg_shiptime_percentile);if(avg_shiptime_percentile!=0){var afp_div=$(".shiptime-percentile");if(avg_shiptime_percentile>50){var msg=i18n("%1$s%% ",avg_shiptime_percentile);afp_div.text(msg);afp_div.addClass("red")}else{var msg=i18n(" Wish  %1$s%% ",100-avg_shiptime_percentile);afp_div.text(msg);afp_div.addClass("green")}}var num_valid_fulfillment_points=0;_.each(resp.data.fulfillment_series,function(data_pt){if(data_pt.fulfillment_pt>0)num_valid_fulfillment_points++});var show_fulfillment=num_valid_fulfillment_points>1?true:false;_.each(resp.data.fulfillment_series,function(data_pt){data_pt.x=new Date(data_pt.x*1e3).toString("MMM d");if(data_pt.fulfillment_pt>0){data_pt.fulfillment_pt=Math.round(data_pt.fulfillment_pt);fulfillment_dates.push(data_pt.x);fulfillment_series.push(data_pt.fulfillment_pt);fulfillment_series_marker.push(acceptable_fulfillment)}});_.each(resp.data.total_series,function(data_pt){data_pt.x=new Date(data_pt.x*1e3).toString("MMM d");dates.push(data_pt.x);wishes_series.push(resp.data.wish_base+data_pt.wishes);impression_series.push(resp.data.impr_base+data_pt.impressions);num_sold_series.push(resp.data.sold_base+data_pt.num_sold)});var num_valid_shipping_points=0;_.each(resp.data.shiptime_series,function(data_pt){if(data_pt.shiptime_pt>0)num_valid_shipping_points++});var show_shiptime=num_valid_shipping_points>1?true:false;_.each(resp.data.shiptime_series,function(data_pt){data_pt.x=new Date(data_pt.x*1e3).toString("MMM d");if(data_pt.shiptime_pt>0){data_pt.shiptime_pt=Math.round(data_pt.shiptime_pt);shipping_dates.push(data_pt.x);shiptime_series.push(data_pt.shiptime_pt);shiptime_series_marker.push(acceptable_shipment)}});if(show_fulfillment){var fulfillment_time_chart_ctx=document.getElementById("fulfillment-graph").getContext("2d");var fulfillment_time_chart_data={labels:fulfillment_dates,datasets:[{label:i18n(""),fillColor:"rgba(0, 0, 0, 0)",strokeColor:"rgba(0, 255, 0, 1)",pointColor:"rgba(0, 255, 0, 1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(0, 255, 0, 1)",data:fulfillment_series_marker},{label:i18n(""),fillColor:"rgba(0, 0, 0, 0)",strokeColor:"rgba(0, 0, 255, 1)",pointColor:"rgba(0, 0, 255, 1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(0, 0, 255, 1)",data:fulfillment_series}]};var fulfillmentTimeChart=new Chart(fulfillment_time_chart_ctx).Line(fulfillment_time_chart_data,{responsive:true,maintainAspectRatio:true,animation:false,tooltipTitleFontStyle:"regular",multiTooltipTemplate:i18n("%1$s ","<%= value %>")})}else{$(".fulfillment-avg").hide();$(".fulfillment-graph").hide();$(".shiptime-avg").css({"margin-left":"0px"});$(".shipping-graph").css({"margin-left":"0px"})}if(show_shiptime){var shipping_time_chart_ctx=document.getElementById("shipping-graph").getContext("2d");var shipping_time_chart_data={labels:shipping_dates,datasets:[{label:i18n(""),fillColor:"rgba(0, 0, 0, 0)",strokeColor:"rgba(0, 255, 0, 1)",pointColor:"rgba(0, 255, 0, 1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(0,255,0,1)",data:shiptime_series_marker},{label:i18n(""),fillColor:"rgba(0, 0, 0, 0)",strokeColor:"rgba(0, 0, 255, 1)",pointColor:"rgba(0, 0, 255, 1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(0,0,255,1)",data:shiptime_series}]};var shippingTimeChart=new Chart(shipping_time_chart_ctx).Line(shipping_time_chart_data,{responsive:true,maintainAspectRatio:true,animation:false,tooltipTitleFontStyle:"regular",multiTooltipTemplate:i18n("%1$s ","<%= value %>")})}else{$(".shiptime-avg").hide();$(".shipping-graph").hide()}if(show_fulfillment==false&&show_shiptime==false){$(".ship-fullfillment-avg").hide();$(".ship-fullfillment-graph").hide()}var total_impressions_chart_ctx=document.getElementById("total-impressions-chart").getContext("2d");var total_impressions_chart_data={labels:dates,datasets:[{label:i18n(""),fillColor:"rgba(0, 0, 0, 0)",strokeColor:"#3366FF",pointColor:"#3366FF",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"#3366FF",data:impression_series}]};var totalImpressionsChart=new Chart(total_impressions_chart_ctx).Line(total_impressions_chart_data,{responsive:true,maintainAspectRatio:true,animation:false,tooltipTitleFontStyle:"regular",tooltipTemplate:i18n("%1$s","<%= value %>")});var total_sales_chart_ctx=document.getElementById("total-sales-chart").getContext("2d");var total_sales_chart_data={labels:dates,datasets:[{label:i18n(""),fillColor:"rgba(0, 0, 0, 0)",strokeColor:"#009999",pointColor:"#009999",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"#009999",data:num_sold_series}]};var totalSalesChart=new Chart(total_sales_chart_ctx).Line(total_sales_chart_data,{responsive:true,maintainAspectRatio:true,animation:false,tooltipTitleFontStyle:"regular",tooltipTemplate:i18n("%1$s","<%= value %>")});var total_wishes_chart_ctx=document.getElementById("total-wishes-chart").getContext("2d");var total_wishes_chart_data={labels:dates,datasets:[{label:i18n("Wish "),fillColor:"rgba(0, 0, 0, 0)",strokeColor:"#CC0099",pointColor:"#CC0099",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"#CC0099",data:wishes_series}]};var totalWishesChart=new Chart(total_wishes_chart_ctx).Line(total_wishes_chart_data,{responsive:true,maintainAspectRatio:true,animation:false,tooltipTitleFontStyle:"regular",tooltipTemplate:i18n("%1$s","<%= value %>")})}})};var launchReleaseModal=function(release){var modal=new ReleaseNotesModal({release:release});modal.render()};var launchAnnouncementModal=function(announcement,delay){var modal=new AnnouncementModal({announcement:announcement});if(delay){modal.render_delay()}else{modal.render()}};var launchReviewModal=function(){var modal=new RequestReviewModal({});modal.render()};var popoverShow=function(evt){evt.preventDefault();var target=$(evt.currentTarget);api.launchInfoModal(target.attr("data-content"),target.attr("data-title"))};var init_onboarding=function(){var $el=$("#new-merchant-lead-box");if($el.length){var merchant=window.pageParams.merchant_user;var step_dict=window.pageParams.onboarding_step_dict;var view=new OnboardingChecklistView({merchant:merchant,step_dict:step_dict,el:$el,title:i18n("")});view.render();$el.closest(".section").removeClass("hide")}};var init_page=function(){var total_wishes=window.pageParams.total_wishes;var total_impressions=window.pageParams.total_impressions;var total_emails_sent=window.pageParams.total_emails_sent;var total_sold=window.pageParams.total_sold;init_onboarding();if(window.pageParams.modal_release){launchReleaseModal(window.pageParams.modal_release)}if(window.pageParams.announcement_viewed){launchAnnouncementModal(window.pageParams.announcement,true)}$(".announcement-link").click(function(evt){launchAnnouncementModal(window.pageParams.announcement,false)});$(".question-sign").click(function(evt){popoverShow(evt)});$(".review-question-sign").click(function(evt){launchReviewModal()});$(".verify-btn").click(function(evt){evt.preventDefault();var modal=new ConfirmationModal(i18n(""),i18n("%1$s",window.pageParams.next_retry_wait_time)+"\n\n"+i18n("")+"\n"+"1. "+i18n("")+"\n"+"2. "+i18n("")+"\n"+"3. "+i18n("")+"\n"+"4. "+i18n(""),"Cancel","Continue",undefined,undefined,false);modal.on("confirm",_.bind(function(){window.location="/brand-authorization/education-current?trusted-review=true"},this));modal.render()});$(".request-btn").click(function(evt){evt.preventDefault();window.location="/brand-authorization/education"});$(".extra-info").click(function(evt){if(window.pageParams.merchant_user.missing_extra_info&&window.pageParams.merchant_user.missing_info_state==3){window.location="/merchants-review/"+window.pageParams.merchant_user.id}else{evt.preventDefault();var infoModal=new MerchantExtraInfoModal(window.pageParams.merchant_user);infoModal.on("infoProvided",function(){$("#extra-info-box").hide();window.location.reload()});infoModal.render()}});api.call("stats/merchants-graph",{total_wishes:total_wishes,total_impressions:total_impressions,total_emails_sent:total_emails_sent,total_sold:total_sold},_.bind(stats_ready,this))};base_page.onDomReady(init_page)});
define("page/home_page", function(){});
